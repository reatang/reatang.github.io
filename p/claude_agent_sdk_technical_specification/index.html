<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜ ç‰ˆæœ¬ï¼š 1.0.0\nåè®®ç‰ˆæœ¬ï¼š 2024-11-05\næœ€åæ›´æ–°ï¼š 2026-01-10\nåŸæ–‡ï¼š Claude Agent SDK Technical Specification\n1. æ¦‚è§ˆ Claude Agent SDK ä¸º Claude Code çš„æ™ºèƒ½ä½“èƒ½åŠ›æä¾›å¯ç¼–ç¨‹è®¿é—®æ–¹å¼ã€‚å®ƒä½¿åº”ç”¨èƒ½å¤Ÿï¼š\nä½¿ç”¨ Claude æ‰§è¡Œè‡ªç„¶è¯­è¨€æç¤º ä»¥é€ token æˆ–é€æ¶ˆæ¯çš„æ–¹å¼æµå¼è¾“å‡ºå“åº” ä½¿ç”¨å†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶æ“ä½œã€Shell å‘½ä»¤ã€Web è®¿é—®ï¼‰ é€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®šä¹‰è‡ªå®šä¹‰å·¥å…· é€šè¿‡ä¼šè¯æŒä¹…åŒ–ç®¡ç†å¤šè½®å¯¹è¯ æ§åˆ¶æƒé™ä¸æ²™ç®±è¡Œä¸º 1.1 æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ æè¿° Queryï¼ˆæŸ¥è¯¢ï¼‰ ä¸€æ¬¡æç¤ºæ‰§è¡Œï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ª turn Turnï¼ˆè½®æ¬¡ï¼‰ ä¸€æ¬¡è¯·æ±‚-å“åº”å¾ªç¯ï¼Œå¯èƒ½åŒ…å«å·¥å…·è°ƒç”¨ Messageï¼ˆæ¶ˆæ¯ï¼‰ ä¸€æ®µç¦»æ•£çš„é€šä¿¡å•å…ƒï¼ˆsystemã€assistantã€userã€resultï¼‰ Toolï¼ˆå·¥å…·ï¼‰ Claude å¯è°ƒç”¨çš„èƒ½åŠ›ï¼ˆReadã€Writeã€Bashã€è‡ªå®šä¹‰ MCP å·¥å…·ç­‰ï¼‰ Sessionï¼ˆä¼šè¯ï¼‰ ç”± UUID æ ‡è¯†çš„æŒä¹…åŒ–å¯¹è¯ä¸Šä¸‹æ–‡ 1.2 äº¤äº’æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”‚ Claude Code â”‚ â”‚ (SDK) â”‚ â”‚ CLI â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ ä½¿ç”¨å‚æ•°å¯åŠ¨å­è¿›ç¨‹ â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚ â”‚ â”‚ stdoutï¼šJSON æ¶ˆæ¯ï¼ˆæµå¼ï¼‰ â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ â”‚ [è¿›ç¨‹é€€å‡º] â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ 2. æ¶æ„ 2.1 ç»„ä»¶å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Query â”‚ â”‚ Options â”‚ â”‚ Message Parser â”‚ â”‚ â”‚ â”‚ Builder â”‚ â”‚ Config â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Process Spawn â”‚ â”‚ â”‚ â”‚ (stdio) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Claude Code CLI â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Claude â”‚ â”‚ Tools â”‚ â”‚ MCP â”‚ â”‚ Session â”‚ â”‚ â”‚ â”‚ API â”‚ â”‚ Engine â”‚ â”‚ Client â”‚ â”‚ Manager â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ MCP Serversï¼ˆå¯é€‰ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ stdio server â”‚ â”‚ HTTP server â”‚ â”‚ SSE server â”‚ â”‚ â”‚ â”‚ ï¼ˆä½ çš„å·¥å…·ï¼‰ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 2.2 æ•°æ®æµ åº”ç”¨ç¨‹åºï¼šä½¿ç”¨ prompt ä¸ options æ„å»º query SDKï¼šä»¥å­è¿›ç¨‹æ–¹å¼å¯åŠ¨ Claude Code CLI CLIï¼šå‘ stdout ä»¥æµå¼æ–¹å¼è¾“å‡º JSON æ¶ˆæ¯ SDKï¼šè§£æ JSON è¡Œå¹¶äº§å‡ºå¼ºç±»å‹æ¶ˆæ¯ åº”ç”¨ç¨‹åºï¼šå¤„ç†æ¶ˆæ¯ï¼ˆå±•ç¤ºã€æ—¥å¿—ç­‰ï¼‰ CLIï¼šå½“ query å®Œæˆæˆ–å‘ç”Ÿé”™è¯¯æ—¶é€€å‡º 3. CLI æ¥å£ SDK é€šè¿‡ Claude Code çš„å‘½ä»¤è¡Œæ¥å£ä¸å…¶é€šä¿¡ã€‚\n"><title>ã€AIã€‘è½¬è½½ Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜</title><link rel=canonical href=https://reatang.com/p/claude_agent_sdk_technical_specification/><link rel=stylesheet href=/scss/style.min.cf5dae57fc42bf54f3120704a96c585c765945e8243e3c42af42bf5d64111fb3.css><meta property='og:title' content="ã€AIã€‘è½¬è½½ Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜"><meta property='og:description' content="Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜ ç‰ˆæœ¬ï¼š 1.0.0\nåè®®ç‰ˆæœ¬ï¼š 2024-11-05\næœ€åæ›´æ–°ï¼š 2026-01-10\nåŸæ–‡ï¼š Claude Agent SDK Technical Specification\n1. æ¦‚è§ˆ Claude Agent SDK ä¸º Claude Code çš„æ™ºèƒ½ä½“èƒ½åŠ›æä¾›å¯ç¼–ç¨‹è®¿é—®æ–¹å¼ã€‚å®ƒä½¿åº”ç”¨èƒ½å¤Ÿï¼š\nä½¿ç”¨ Claude æ‰§è¡Œè‡ªç„¶è¯­è¨€æç¤º ä»¥é€ token æˆ–é€æ¶ˆæ¯çš„æ–¹å¼æµå¼è¾“å‡ºå“åº” ä½¿ç”¨å†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶æ“ä½œã€Shell å‘½ä»¤ã€Web è®¿é—®ï¼‰ é€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®šä¹‰è‡ªå®šä¹‰å·¥å…· é€šè¿‡ä¼šè¯æŒä¹…åŒ–ç®¡ç†å¤šè½®å¯¹è¯ æ§åˆ¶æƒé™ä¸æ²™ç®±è¡Œä¸º 1.1 æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ æè¿° Queryï¼ˆæŸ¥è¯¢ï¼‰ ä¸€æ¬¡æç¤ºæ‰§è¡Œï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ª turn Turnï¼ˆè½®æ¬¡ï¼‰ ä¸€æ¬¡è¯·æ±‚-å“åº”å¾ªç¯ï¼Œå¯èƒ½åŒ…å«å·¥å…·è°ƒç”¨ Messageï¼ˆæ¶ˆæ¯ï¼‰ ä¸€æ®µç¦»æ•£çš„é€šä¿¡å•å…ƒï¼ˆsystemã€assistantã€userã€resultï¼‰ Toolï¼ˆå·¥å…·ï¼‰ Claude å¯è°ƒç”¨çš„èƒ½åŠ›ï¼ˆReadã€Writeã€Bashã€è‡ªå®šä¹‰ MCP å·¥å…·ç­‰ï¼‰ Sessionï¼ˆä¼šè¯ï¼‰ ç”± UUID æ ‡è¯†çš„æŒä¹…åŒ–å¯¹è¯ä¸Šä¸‹æ–‡ 1.2 äº¤äº’æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”‚ Claude Code â”‚ â”‚ (SDK) â”‚ â”‚ CLI â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ ä½¿ç”¨å‚æ•°å¯åŠ¨å­è¿›ç¨‹ â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚ â”‚ â”‚ stdoutï¼šJSON æ¶ˆæ¯ï¼ˆæµå¼ï¼‰ â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ â”‚ [è¿›ç¨‹é€€å‡º] â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ 2. æ¶æ„ 2.1 ç»„ä»¶å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Query â”‚ â”‚ Options â”‚ â”‚ Message Parser â”‚ â”‚ â”‚ â”‚ Builder â”‚ â”‚ Config â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Process Spawn â”‚ â”‚ â”‚ â”‚ (stdio) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Claude Code CLI â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Claude â”‚ â”‚ Tools â”‚ â”‚ MCP â”‚ â”‚ Session â”‚ â”‚ â”‚ â”‚ API â”‚ â”‚ Engine â”‚ â”‚ Client â”‚ â”‚ Manager â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ MCP Serversï¼ˆå¯é€‰ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ stdio server â”‚ â”‚ HTTP server â”‚ â”‚ SSE server â”‚ â”‚ â”‚ â”‚ ï¼ˆä½ çš„å·¥å…·ï¼‰ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 2.2 æ•°æ®æµ åº”ç”¨ç¨‹åºï¼šä½¿ç”¨ prompt ä¸ options æ„å»º query SDKï¼šä»¥å­è¿›ç¨‹æ–¹å¼å¯åŠ¨ Claude Code CLI CLIï¼šå‘ stdout ä»¥æµå¼æ–¹å¼è¾“å‡º JSON æ¶ˆæ¯ SDKï¼šè§£æ JSON è¡Œå¹¶äº§å‡ºå¼ºç±»å‹æ¶ˆæ¯ åº”ç”¨ç¨‹åºï¼šå¤„ç†æ¶ˆæ¯ï¼ˆå±•ç¤ºã€æ—¥å¿—ç­‰ï¼‰ CLIï¼šå½“ query å®Œæˆæˆ–å‘ç”Ÿé”™è¯¯æ—¶é€€å‡º 3. CLI æ¥å£ SDK é€šè¿‡ Claude Code çš„å‘½ä»¤è¡Œæ¥å£ä¸å…¶é€šä¿¡ã€‚\n"><meta property='og:url' content='https://reatang.com/p/claude_agent_sdk_technical_specification/'><meta property='og:site_name' content='é›¨çš„å‘³é“'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='æŠ€æœ¯æ–‡æ¡£'><meta property='article:published_time' content='2026-01-15T12:08:22+08:00'><meta property='article:modified_time' content='2026-01-15T12:08:22+08:00'><meta name=twitter:title content="ã€AIã€‘è½¬è½½ Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜"><meta name=twitter:description content="Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜ ç‰ˆæœ¬ï¼š 1.0.0\nåè®®ç‰ˆæœ¬ï¼š 2024-11-05\næœ€åæ›´æ–°ï¼š 2026-01-10\nåŸæ–‡ï¼š Claude Agent SDK Technical Specification\n1. æ¦‚è§ˆ Claude Agent SDK ä¸º Claude Code çš„æ™ºèƒ½ä½“èƒ½åŠ›æä¾›å¯ç¼–ç¨‹è®¿é—®æ–¹å¼ã€‚å®ƒä½¿åº”ç”¨èƒ½å¤Ÿï¼š\nä½¿ç”¨ Claude æ‰§è¡Œè‡ªç„¶è¯­è¨€æç¤º ä»¥é€ token æˆ–é€æ¶ˆæ¯çš„æ–¹å¼æµå¼è¾“å‡ºå“åº” ä½¿ç”¨å†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶æ“ä½œã€Shell å‘½ä»¤ã€Web è®¿é—®ï¼‰ é€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®šä¹‰è‡ªå®šä¹‰å·¥å…· é€šè¿‡ä¼šè¯æŒä¹…åŒ–ç®¡ç†å¤šè½®å¯¹è¯ æ§åˆ¶æƒé™ä¸æ²™ç®±è¡Œä¸º 1.1 æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ æè¿° Queryï¼ˆæŸ¥è¯¢ï¼‰ ä¸€æ¬¡æç¤ºæ‰§è¡Œï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ª turn Turnï¼ˆè½®æ¬¡ï¼‰ ä¸€æ¬¡è¯·æ±‚-å“åº”å¾ªç¯ï¼Œå¯èƒ½åŒ…å«å·¥å…·è°ƒç”¨ Messageï¼ˆæ¶ˆæ¯ï¼‰ ä¸€æ®µç¦»æ•£çš„é€šä¿¡å•å…ƒï¼ˆsystemã€assistantã€userã€resultï¼‰ Toolï¼ˆå·¥å…·ï¼‰ Claude å¯è°ƒç”¨çš„èƒ½åŠ›ï¼ˆReadã€Writeã€Bashã€è‡ªå®šä¹‰ MCP å·¥å…·ç­‰ï¼‰ Sessionï¼ˆä¼šè¯ï¼‰ ç”± UUID æ ‡è¯†çš„æŒä¹…åŒ–å¯¹è¯ä¸Šä¸‹æ–‡ 1.2 äº¤äº’æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”‚ Claude Code â”‚ â”‚ (SDK) â”‚ â”‚ CLI â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ ä½¿ç”¨å‚æ•°å¯åŠ¨å­è¿›ç¨‹ â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚ â”‚ â”‚ stdoutï¼šJSON æ¶ˆæ¯ï¼ˆæµå¼ï¼‰ â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ â”‚ [è¿›ç¨‹é€€å‡º] â”‚ â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ 2. æ¶æ„ 2.1 ç»„ä»¶å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ä½ çš„åº”ç”¨ç¨‹åº â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Query â”‚ â”‚ Options â”‚ â”‚ Message Parser â”‚ â”‚ â”‚ â”‚ Builder â”‚ â”‚ Config â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Process Spawn â”‚ â”‚ â”‚ â”‚ (stdio) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Claude Code CLI â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Claude â”‚ â”‚ Tools â”‚ â”‚ MCP â”‚ â”‚ Session â”‚ â”‚ â”‚ â”‚ API â”‚ â”‚ Engine â”‚ â”‚ Client â”‚ â”‚ Manager â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ MCP Serversï¼ˆå¯é€‰ï¼‰ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ stdio server â”‚ â”‚ HTTP server â”‚ â”‚ SSE server â”‚ â”‚ â”‚ â”‚ ï¼ˆä½ çš„å·¥å…·ï¼‰ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 2.2 æ•°æ®æµ åº”ç”¨ç¨‹åºï¼šä½¿ç”¨ prompt ä¸ options æ„å»º query SDKï¼šä»¥å­è¿›ç¨‹æ–¹å¼å¯åŠ¨ Claude Code CLI CLIï¼šå‘ stdout ä»¥æµå¼æ–¹å¼è¾“å‡º JSON æ¶ˆæ¯ SDKï¼šè§£æ JSON è¡Œå¹¶äº§å‡ºå¼ºç±»å‹æ¶ˆæ¯ åº”ç”¨ç¨‹åºï¼šå¤„ç†æ¶ˆæ¯ï¼ˆå±•ç¤ºã€æ—¥å¿—ç­‰ï¼‰ CLIï¼šå½“ query å®Œæˆæˆ–å‘ç”Ÿé”™è¯¯æ—¶é€€å‡º 3. CLI æ¥å£ SDK é€šè¿‡ Claude Code çš„å‘½ä»¤è¡Œæ¥å£ä¸å…¶é€šä¿¡ã€‚\n"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_2084c374a505adef.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ“š</span></figure><div class=site-meta><h1 class=site-name><a href=/>é›¨çš„å‘³é“</a></h1><h2 class=site-description>åªæ˜¯é’»ç ”äº†ä¸€äº›æŠ€æœ¯.</h2></div></header><ol class=menu-social><li><a href=https://github.com/reatang target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://weibo.com/reatang target=_blank title=Weibo rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"/><path d="M15 4h1a5 5 0 015 5v1"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/single-pages/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notebook"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4h11a2 2 0 012 2v12a2 2 0 01-2 2H6a1 1 0 01-1-1V5a1 1 0 011-1m3 0v18"/><path d="M13 8h2"/><path d="M13 12h2"/></svg>
<span>å•é¡µçŸ¥è¯†</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£æ–‡ç« </span></a></li><li><a href=/good-package/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-books"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4m0 1a1 1 0 011-1h2a1 1 0 011 1v14a1 1 0 01-1 1H6a1 1 0 01-1-1z"/><path d="M9 4m0 1a1 1 0 011-1h2a1 1 0 011 1v14a1 1 0 01-1 1h-2a1 1 0 01-1-1z"/><path d="M5 8h4"/><path d="M9 16h4"/><path d="M13.803 4.56l2.184-.53c.562-.135 1.133.19 1.282.732l3.695 13.418a1.02 1.02.0 01-.634 1.219l-.133.041-2.184.53c-.562.135-1.133-.19-1.282-.732L13.036 5.82a1.02 1.02.0 01.634-1.219l.133-.041z"/><path d="M14 9l4-1"/><path d="M16 16l3.923-.98"/></svg>
<span>å¥½ä¸œè¥¿ä¼ é€é—¨</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E%E6%88%91/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>å…³äºæˆ‘</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#1-æ¦‚è§ˆ>1. æ¦‚è§ˆ</a><ol><li><a href=#11-æ ¸å¿ƒæ¦‚å¿µ>1.1 æ ¸å¿ƒæ¦‚å¿µ</a></li><li><a href=#12-äº¤äº’æ¨¡å‹>1.2 äº¤äº’æ¨¡å‹</a></li></ol></li><li><a href=#2-æ¶æ„>2. æ¶æ„</a><ol><li><a href=#21-ç»„ä»¶å›¾>2.1 ç»„ä»¶å›¾</a></li><li><a href=#22-æ•°æ®æµ>2.2 æ•°æ®æµ</a></li></ol></li><li><a href=#3-cli-æ¥å£>3. CLI æ¥å£</a><ol><li><a href=#31-åŸºç¡€å‘½ä»¤>3.1 åŸºç¡€å‘½ä»¤</a></li><li><a href=#32-å¿…éœ€å‚æ•°>3.2 å¿…éœ€å‚æ•°</a></li><li><a href=#33-å¯é€‰å‚æ•°>3.3 å¯é€‰å‚æ•°</a></li><li><a href=#34-è¾“å‡ºæ ¼å¼>3.4 è¾“å‡ºæ ¼å¼</a></li></ol></li><li><a href=#4-æ¶ˆæ¯åè®®>4. æ¶ˆæ¯åè®®</a><ol><li><a href=#41-æ¶ˆæ¯ç±»å‹>4.1 æ¶ˆæ¯ç±»å‹</a></li><li><a href=#42-system-æ¶ˆæ¯>4.2 System æ¶ˆæ¯</a><ol><li><a href=#system-æ¶ˆæ¯å­—æ®µ>System æ¶ˆæ¯å­—æ®µ</a></li><li><a href=#api-key-source-å–å€¼>API Key Source å–å€¼</a></li></ol></li><li><a href=#43-assistant-æ¶ˆæ¯>4.3 Assistant æ¶ˆæ¯</a><ol><li><a href=#content-block-ç±»å‹>Content block ç±»å‹</a></li></ol></li><li><a href=#44-user-æ¶ˆæ¯>4.4 User æ¶ˆæ¯</a></li><li><a href=#45-result-æ¶ˆæ¯>4.5 Result æ¶ˆæ¯</a><ol><li><a href=#result-subtype>Result subtype</a></li><li><a href=#result-å­—æ®µ>Result å­—æ®µ</a></li></ol></li><li><a href=#46-stream-event-æ¶ˆæ¯>4.6 Stream event æ¶ˆæ¯</a><ol><li><a href=#stream-event-ç±»å‹>Stream event ç±»å‹</a></li></ol></li></ol></li><li><a href=#5-æµå¼æ¨¡å¼>5. æµå¼æ¨¡å¼</a><ol><li><a href=#51-æ¶ˆæ¯çº§æµå¼é»˜è®¤>5.1 æ¶ˆæ¯çº§æµå¼ï¼ˆé»˜è®¤ï¼‰</a></li><li><a href=#52-token-çº§æµå¼>5.2 Token çº§æµå¼</a></li><li><a href=#53-æŠ½å–æµå¼æ–‡æœ¬>5.3 æŠ½å–æµå¼æ–‡æœ¬</a></li></ol></li><li><a href=#6-å·¥å…·ç³»ç»Ÿ>6. å·¥å…·ç³»ç»Ÿ</a><ol><li><a href=#61-å†…ç½®å·¥å…·>6.1 å†…ç½®å·¥å…·</a></li><li><a href=#62-å·¥å…·è¾“å…¥-schema>6.2 å·¥å…·è¾“å…¥ Schema</a></li><li><a href=#63-å·¥å…·è¿‡æ»¤>6.3 å·¥å…·è¿‡æ»¤</a></li></ol></li><li><a href=#7-mcp-é›†æˆ>7. MCP é›†æˆ</a><ol><li><a href=#71-mcp-server-ç±»å‹>7.1 MCP Server ç±»å‹</a></li><li><a href=#72-mcp-é…ç½®æ–‡ä»¶>7.2 MCP é…ç½®æ–‡ä»¶</a></li><li><a href=#73-mcp-å·¥å…·å‘½å>7.3 MCP å·¥å…·å‘½å</a></li><li><a href=#74-mcp-server-åè®®stdio>7.4 MCP Server åè®®ï¼ˆstdioï¼‰</a><ol><li><a href=#initialize-æ¡æ‰‹>Initialize æ¡æ‰‹</a></li><li><a href=#åˆ—å‡ºå·¥å…·list-tools>åˆ—å‡ºå·¥å…·ï¼ˆList Toolsï¼‰</a></li><li><a href=#è°ƒç”¨å·¥å…·call-tool>è°ƒç”¨å·¥å…·ï¼ˆCall Toolï¼‰</a></li></ol></li><li><a href=#75-å®ç°ä¸€ä¸ª-mcp-server>7.5 å®ç°ä¸€ä¸ª MCP Server</a></li></ol></li><li><a href=#8-ä¼šè¯ç®¡ç†>8. ä¼šè¯ç®¡ç†</a><ol><li><a href=#81-ä¼šè¯ç”Ÿå‘½å‘¨æœŸ>8.1 ä¼šè¯ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#82-å¯åŠ¨æ–°ä¼šè¯>8.2 å¯åŠ¨æ–°ä¼šè¯</a></li><li><a href=#83-æ¢å¤ä¼šè¯>8.3 æ¢å¤ä¼šè¯</a></li><li><a href=#84-ä¼šè¯å­˜å‚¨>8.4 ä¼šè¯å­˜å‚¨</a></li></ol></li><li><a href=#9-æƒé™ç³»ç»Ÿ>9. æƒé™ç³»ç»Ÿ</a><ol><li><a href=#91-æƒé™æ¨¡å¼>9.1 æƒé™æ¨¡å¼</a></li><li><a href=#92-ä½¿ç”¨æƒé™æ¨¡å¼>9.2 ä½¿ç”¨æƒé™æ¨¡å¼</a></li><li><a href=#93-æƒé™æ‹’ç»permission-denials>9.3 æƒé™æ‹’ç»ï¼ˆPermission Denialsï¼‰</a></li></ol></li><li><a href=#10-é…ç½®é€‰é¡¹>10. é…ç½®é€‰é¡¹</a><ol><li><a href=#101-å®Œæ•´é€‰é¡¹å‚è€ƒ>10.1 å®Œæ•´é€‰é¡¹å‚è€ƒ</a></li><li><a href=#102-æ¨¡å‹é€‰æ‹©>10.2 æ¨¡å‹é€‰æ‹©</a></li><li><a href=#103-system-prompt-é€‰é¡¹>10.3 System prompt é€‰é¡¹</a></li></ol></li><li><a href=#11-é”™è¯¯å¤„ç†>11. é”™è¯¯å¤„ç†</a><ol><li><a href=#111-é”™è¯¯-result-ç±»å‹>11.1 é”™è¯¯ result ç±»å‹</a></li><li><a href=#112-é”™è¯¯å“åº”ç¤ºä¾‹>11.2 é”™è¯¯å“åº”ç¤ºä¾‹</a></li><li><a href=#113-json-rpc-é”™è¯¯mcp>11.3 JSON-RPC é”™è¯¯ï¼ˆMCPï¼‰</a></li></ol></li><li><a href=#12-å®ç°æŒ‡å—>12. å®ç°æŒ‡å—</a><ol><li><a href=#121-æœ€å°å®¢æˆ·ç«¯ä¼ªä»£ç >12.1 æœ€å°å®¢æˆ·ç«¯ï¼ˆä¼ªä»£ç ï¼‰</a></li><li><a href=#122-æ¶ˆæ¯å¤„ç†å™¨æ¨¡å¼>12.2 æ¶ˆæ¯å¤„ç†å™¨æ¨¡å¼</a></li><li><a href=#123-mcp-server-æ¨¡æ¿>12.3 MCP Server æ¨¡æ¿</a></li><li><a href=#124-token-æˆæœ¬è®¡ç®—>12.4 Token æˆæœ¬è®¡ç®—</a></li></ol></li><li><a href=#é™„å½•-açœŸå®ä¸–ç•Œ-json-ç¤ºä¾‹>é™„å½• Aï¼šçœŸå®ä¸–ç•Œ JSON ç¤ºä¾‹</a><ol><li><a href=#a1-å®é™…-system-æ¶ˆæ¯>A.1 å®é™… System æ¶ˆæ¯</a></li><li><a href=#a2-å®é™…åŒ…å«å·¥å…·è°ƒç”¨çš„-assistant-æ¶ˆæ¯>A.2 å®é™…åŒ…å«å·¥å…·è°ƒç”¨çš„ Assistant æ¶ˆæ¯</a></li><li><a href=#a3-å®é™…å·¥å…·ç»“æœtool-resultæ¶ˆæ¯>A.3 å®é™…å·¥å…·ç»“æœï¼ˆTool Resultï¼‰æ¶ˆæ¯</a></li><li><a href=#a4-å®é™…-result-æ¶ˆæ¯>A.4 å®é™… Result æ¶ˆæ¯</a></li><li><a href=#a5-å®é™…-stream-eventtoken-delta>A.5 å®é™… Stream eventï¼ˆToken deltaï¼‰</a></li></ol></li><li><a href=#é™„å½•-bå®Œæ•´æ¶ˆæ¯æµç¤ºä¾‹>é™„å½• Bï¼šå®Œæ•´æ¶ˆæ¯æµç¤ºä¾‹</a></li><li><a href=#é™„å½•-bç»­token-æµå¼è¾“å‡ºæµç¨‹ç¤ºä¾‹>é™„å½• Bï¼ˆç»­ï¼‰ï¼šToken æµå¼è¾“å‡ºæµç¨‹ç¤ºä¾‹</a></li><li><a href=#é™„å½•-cå‚è€ƒèµ„æ–™>é™„å½• Cï¼šå‚è€ƒèµ„æ–™</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ai/>AI
</a><a href=/categories/agent%E5%BC%80%E5%8F%91/>Agentå¼€å‘</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/claude_agent_sdk_technical_specification/>ã€AIã€‘è½¬è½½ Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-01-15T12:08:22+08:00>2026-01-15</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 13 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=claude-agent-sdk-æŠ€æœ¯è§„æ ¼è¯´æ˜>Claude Agent SDK æŠ€æœ¯è§„æ ¼è¯´æ˜</h1><p><strong>ç‰ˆæœ¬ï¼š</strong> 1.0.0<br><strong>åè®®ç‰ˆæœ¬ï¼š</strong> 2024-11-05<br><strong>æœ€åæ›´æ–°ï¼š</strong> 2026-01-10<br><strong>åŸæ–‡ï¼š</strong> <a class=link href=https://gist.github.com/SamSaffron/603648958a8c18ceae34939a8951d417 target=_blank rel=noopener>Claude Agent SDK Technical Specification</a></p><h2 id=1-æ¦‚è§ˆ>1. æ¦‚è§ˆ</h2><p>Claude Agent SDK ä¸º Claude Code çš„æ™ºèƒ½ä½“èƒ½åŠ›æä¾›å¯ç¼–ç¨‹è®¿é—®æ–¹å¼ã€‚å®ƒä½¿åº”ç”¨èƒ½å¤Ÿï¼š</p><ul><li>ä½¿ç”¨ Claude æ‰§è¡Œè‡ªç„¶è¯­è¨€æç¤º</li><li>ä»¥é€ token æˆ–é€æ¶ˆæ¯çš„æ–¹å¼æµå¼è¾“å‡ºå“åº”</li><li>ä½¿ç”¨å†…ç½®å·¥å…·ï¼ˆæ–‡ä»¶æ“ä½œã€Shell å‘½ä»¤ã€Web è®¿é—®ï¼‰</li><li>é€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰å®šä¹‰è‡ªå®šä¹‰å·¥å…·</li><li>é€šè¿‡ä¼šè¯æŒä¹…åŒ–ç®¡ç†å¤šè½®å¯¹è¯</li><li>æ§åˆ¶æƒé™ä¸æ²™ç®±è¡Œä¸º</li></ul><h3 id=11-æ ¸å¿ƒæ¦‚å¿µ>1.1 æ ¸å¿ƒæ¦‚å¿µ</h3><div class=table-wrapper><table><thead><tr><th>æ¦‚å¿µ</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>Queryï¼ˆæŸ¥è¯¢ï¼‰</strong></td><td>ä¸€æ¬¡æç¤ºæ‰§è¡Œï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ª turn</td></tr><tr><td><strong>Turnï¼ˆè½®æ¬¡ï¼‰</strong></td><td>ä¸€æ¬¡è¯·æ±‚-å“åº”å¾ªç¯ï¼Œå¯èƒ½åŒ…å«å·¥å…·è°ƒç”¨</td></tr><tr><td><strong>Messageï¼ˆæ¶ˆæ¯ï¼‰</strong></td><td>ä¸€æ®µç¦»æ•£çš„é€šä¿¡å•å…ƒï¼ˆsystemã€assistantã€userã€resultï¼‰</td></tr><tr><td><strong>Toolï¼ˆå·¥å…·ï¼‰</strong></td><td>Claude å¯è°ƒç”¨çš„èƒ½åŠ›ï¼ˆReadã€Writeã€Bashã€è‡ªå®šä¹‰ MCP å·¥å…·ç­‰ï¼‰</td></tr><tr><td><strong>Sessionï¼ˆä¼šè¯ï¼‰</strong></td><td>ç”± UUID æ ‡è¯†çš„æŒä¹…åŒ–å¯¹è¯ä¸Šä¸‹æ–‡</td></tr></tbody></table></div><h3 id=12-äº¤äº’æ¨¡å‹>1.2 äº¤äº’æ¨¡å‹</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚  ä½ çš„åº”ç”¨ç¨‹åº     â”‚                      â”‚   Claude Code    â”‚
</span></span><span class=line><span class=cl>â”‚     (SDK)       â”‚                      â”‚      CLI         â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>         â”‚                                        â”‚
</span></span><span class=line><span class=cl>         â”‚     ä½¿ç”¨å‚æ•°å¯åŠ¨å­è¿›ç¨‹                    â”‚
</span></span><span class=line><span class=cl>         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
</span></span><span class=line><span class=cl>         â”‚                                        â”‚
</span></span><span class=line><span class=cl>         â”‚     stdoutï¼šJSON æ¶ˆæ¯ï¼ˆæµå¼ï¼‰            â”‚
</span></span><span class=line><span class=cl>         â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
</span></span><span class=line><span class=cl>         â”‚                                        â”‚
</span></span><span class=line><span class=cl>         â”‚     [è¿›ç¨‹é€€å‡º]                          â”‚
</span></span><span class=line><span class=cl>         â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
</span></span><span class=line><span class=cl>         â”‚                                        â”‚
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=2-æ¶æ„>2. æ¶æ„</h2><h3 id=21-ç»„ä»¶å›¾>2.1 ç»„ä»¶å›¾</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚                          ä½ çš„åº”ç”¨ç¨‹åº                             â”‚
</span></span><span class=line><span class=cl>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class=line><span class=cl>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚   Query     â”‚  â”‚   Options   â”‚  â”‚    Message Parser       â”‚  â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚   Builder   â”‚  â”‚   Config    â”‚  â”‚                         â”‚  â”‚
</span></span><span class=line><span class=cl>â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span class=line><span class=cl>â”‚         â”‚                â”‚                      â”‚               â”‚
</span></span><span class=line><span class=cl>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
</span></span><span class=line><span class=cl>â”‚                          â”‚                                      â”‚
</span></span><span class=line><span class=cl>â”‚                          â–¼                                      â”‚
</span></span><span class=line><span class=cl>â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
</span></span><span class=line><span class=cl>â”‚                 â”‚  Process Spawn  â”‚                             â”‚
</span></span><span class=line><span class=cl>â”‚                 â”‚   (stdio)       â”‚                             â”‚
</span></span><span class=line><span class=cl>â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>                           â”‚
</span></span><span class=line><span class=cl>                           â–¼
</span></span><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚                       Claude Code CLI                            â”‚
</span></span><span class=line><span class=cl>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span><span class=line><span class=cl>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  Claude  â”‚  â”‚  Tools   â”‚  â”‚  MCP     â”‚  â”‚  Session         â”‚  â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  API     â”‚  â”‚  Engine  â”‚  â”‚  Client  â”‚  â”‚  Manager         â”‚  â”‚
</span></span><span class=line><span class=cl>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>                           â”‚
</span></span><span class=line><span class=cl>                           â–¼
</span></span><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚                     MCP Serversï¼ˆå¯é€‰ï¼‰                           â”‚
</span></span><span class=line><span class=cl>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  stdio server   â”‚  â”‚  HTTP server    â”‚  â”‚  SSE server     â”‚   â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  ï¼ˆä½ çš„å·¥å…·ï¼‰     â”‚  â”‚                 â”‚  â”‚                 â”‚   â”‚
</span></span><span class=line><span class=cl>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table></div></div><h3 id=22-æ•°æ®æµ>2.2 æ•°æ®æµ</h3><ol><li><strong>åº”ç”¨ç¨‹åº</strong>ï¼šä½¿ç”¨ prompt ä¸ options æ„å»º query</li><li><strong>SDK</strong>ï¼šä»¥å­è¿›ç¨‹æ–¹å¼å¯åŠ¨ Claude Code CLI</li><li><strong>CLI</strong>ï¼šå‘ stdout ä»¥æµå¼æ–¹å¼è¾“å‡º JSON æ¶ˆæ¯</li><li><strong>SDK</strong>ï¼šè§£æ JSON è¡Œå¹¶äº§å‡ºå¼ºç±»å‹æ¶ˆæ¯</li><li><strong>åº”ç”¨ç¨‹åº</strong>ï¼šå¤„ç†æ¶ˆæ¯ï¼ˆå±•ç¤ºã€æ—¥å¿—ç­‰ï¼‰</li><li><strong>CLI</strong>ï¼šå½“ query å®Œæˆæˆ–å‘ç”Ÿé”™è¯¯æ—¶é€€å‡º</li></ol><hr><h2 id=3-cli-æ¥å£>3. CLI æ¥å£</h2><p>SDK é€šè¿‡ Claude Code çš„å‘½ä»¤è¡Œæ¥å£ä¸å…¶é€šä¿¡ã€‚</p><h3 id=31-åŸºç¡€å‘½ä»¤>3.1 åŸºç¡€å‘½ä»¤</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude --print --output-format stream-json --verbose <span class=o>[</span>OPTIONS<span class=o>]</span> -- <span class=s2>&#34;prompt&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=32-å¿…éœ€å‚æ•°>3.2 å¿…éœ€å‚æ•°</h3><div class=table-wrapper><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>--print</code> / <code>-p</code></td><td>éäº¤äº’æ¨¡å¼ï¼Œè¾“å‡ºåˆ° stdout</td></tr><tr><td><code>--output-format stream-json</code></td><td>è¾“å‡ºæ¢è¡Œåˆ†éš”çš„ JSON æ¶ˆæ¯</td></tr><tr><td><code>--verbose</code></td><td><code>stream-json</code> æ ¼å¼è¦æ±‚å¿…é¡»å¼€å¯</td></tr><tr><td><code>--</code></td><td>é€‰é¡¹ä¸ prompt ä¹‹é—´çš„åˆ†éš”ç¬¦</td></tr></tbody></table></div><h3 id=33-å¯é€‰å‚æ•°>3.3 å¯é€‰å‚æ•°</h3><div class=table-wrapper><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>--model &lt;model></code></td><td>string</td><td>æ¨¡å‹åˆ«åï¼ˆ<code>opus</code>ã€<code>sonnet</code>ã€<code>haiku</code>ï¼‰æˆ–å®Œæ•´åç§°</td></tr><tr><td><code>--max-turns &lt;n></code></td><td>integer</td><td>æœ€å¤§å¯¹è¯è½®æ¬¡æ•°</td></tr><tr><td><code>--max-budget-usd &lt;n></code></td><td>float</td><td>æœ€å¤§é¢„ç®—ï¼ˆUSDï¼‰</td></tr><tr><td><code>--system-prompt &lt;text></code></td><td>string</td><td>è‡ªå®šä¹‰ system promptï¼ˆæ›¿æ¢é»˜è®¤ï¼‰</td></tr><tr><td><code>--append-system-prompt &lt;text></code></td><td>string</td><td>è¿½åŠ åˆ°é»˜è®¤ system prompt</td></tr><tr><td><code>--allowed-tools &lt;tools></code></td><td>string</td><td>å·¥å…·ç™½åå•ï¼ˆé€—å·åˆ†éš”ï¼‰</td></tr><tr><td><code>--disallowed-tools &lt;tools></code></td><td>string</td><td>å·¥å…·é»‘åå•ï¼ˆé€—å·åˆ†éš”ï¼‰</td></tr><tr><td><code>--mcp-config &lt;path></code></td><td>string</td><td>MCP server é…ç½® JSON è·¯å¾„</td></tr><tr><td><code>--include-partial-messages</code></td><td>boolean</td><td>å¼€å¯ token çº§æµå¼è¾“å‡º</td></tr><tr><td><code>--dangerously-skip-permissions</code></td><td>boolean</td><td>è·³è¿‡æƒé™æ£€æŸ¥</td></tr><tr><td><code>--resume &lt;session-id></code></td><td>string</td><td>æ¢å¤æŒ‡å®šä¼šè¯</td></tr><tr><td><code>--continue</code></td><td>boolean</td><td>ç»§ç»­æœ€è¿‘ä¸€æ¬¡ä¼šè¯</td></tr></tbody></table></div><h3 id=34-è¾“å‡ºæ ¼å¼>3.4 è¾“å‡ºæ ¼å¼</h3><div class=table-wrapper><table><thead><tr><th>æ ¼å¼</th><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>Text</td><td><code>--output-format text</code></td><td>äººç±»å¯è¯»æ–‡æœ¬è¾“å‡ºï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td>JSON</td><td><code>--output-format json</code></td><td>å®Œæˆæ—¶è¾“å‡ºå•ä¸ª JSON å¯¹è±¡</td></tr><tr><td>Stream JSON</td><td><code>--output-format stream-json</code></td><td>é€è¡Œè¾“å‡º JSON æ¶ˆæ¯</td></tr></tbody></table></div><hr><h2 id=4-æ¶ˆæ¯åè®®>4. æ¶ˆæ¯åè®®</h2><p>æ‰€æœ‰æ¶ˆæ¯å‡ä¸ºå¸¦ <code>type</code> å­—æ®µçš„ JSON å¯¹è±¡ã€‚æ¶ˆæ¯ä»¥æ¢è¡Œåˆ†éš” JSONï¼ˆNDJSONï¼‰å½¢å¼è¾“å‡ºã€‚</p><h3 id=41-æ¶ˆæ¯ç±»å‹>4.1 æ¶ˆæ¯ç±»å‹</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>MessageType = &#34;system&#34; | &#34;assistant&#34; | &#34;user&#34; | &#34;result&#34; | &#34;stream_event&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=42-system-æ¶ˆæ¯>4.2 System æ¶ˆæ¯</h3><p>åœ¨ä¼šè¯å¼€å§‹æ—¶åªå‘é€ä¸€æ¬¡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subtype&#34;</span><span class=p>:</span> <span class=s2>&#34;init&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cwd&#34;</span><span class=p>:</span> <span class=s2>&#34;/path/to/working/directory&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;model&#34;</span><span class=p>:</span> <span class=s2>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tools&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Task&#34;</span><span class=p>,</span> <span class=s2>&#34;Bash&#34;</span><span class=p>,</span> <span class=s2>&#34;Glob&#34;</span><span class=p>,</span> <span class=s2>&#34;Grep&#34;</span><span class=p>,</span> <span class=s2>&#34;Read&#34;</span><span class=p>,</span> <span class=s2>&#34;Edit&#34;</span><span class=p>,</span> <span class=s2>&#34;Write&#34;</span><span class=p>,</span> <span class=err>...</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;mcp_servers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ruby-tools&#34;</span><span class=p>,</span> <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;connected&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permissionMode&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apiKeySource&#34;</span><span class=p>:</span> <span class=s2>&#34;none&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;slash_commands&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;compact&#34;</span><span class=p>,</span> <span class=s2>&#34;context&#34;</span><span class=p>,</span> <span class=s2>&#34;cost&#34;</span><span class=p>,</span> <span class=err>...</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;agents&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Bash&#34;</span><span class=p>,</span> <span class=s2>&#34;general-purpose&#34;</span><span class=p>,</span> <span class=s2>&#34;Explore&#34;</span><span class=p>,</span> <span class=s2>&#34;Plan&#34;</span><span class=p>,</span> <span class=err>...</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;claude_code_version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.1.3&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=system-æ¶ˆæ¯å­—æ®µ>System æ¶ˆæ¯å­—æ®µ</h4><div class=table-wrapper><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>subtype</code></td><td><code>"init"</code></td><td>ä¼šè¯å¼€å§‹æ—¶å›ºå®šä¸º &ldquo;init&rdquo;</td></tr><tr><td><code>uuid</code></td><td>string</td><td>æ¶ˆæ¯å”¯ä¸€æ ‡è¯†</td></tr><tr><td><code>session_id</code></td><td>string</td><td>ä¼šè¯æ ‡è¯†ï¼ˆUUIDï¼‰</td></tr><tr><td><code>cwd</code></td><td>string</td><td>å·¥ä½œç›®å½•</td></tr><tr><td><code>model</code></td><td>string</td><td>å½“å‰æ¨¡å‹åç§°</td></tr><tr><td><code>tools</code></td><td>string[]</td><td>å¯ç”¨çš„å†…ç½®å·¥å…·</td></tr><tr><td><code>mcp_servers</code></td><td>object[]</td><td>å·²è¿æ¥çš„ MCP servers åŠå…¶çŠ¶æ€</td></tr><tr><td><code>permissionMode</code></td><td>string</td><td>å½“å‰æƒé™æ¨¡å¼</td></tr><tr><td><code>apiKeySource</code></td><td>string</td><td>è®¤è¯æ¥æºï¼ˆè§ä¸‹ï¼‰</td></tr><tr><td><code>slash_commands</code></td><td>string[]</td><td>å¯ç”¨çš„æ–œæ å‘½ä»¤</td></tr><tr><td><code>agents</code></td><td>string[]</td><td>å¯ç”¨å­æ™ºèƒ½ä½“ç±»å‹</td></tr><tr><td><code>claude_code_version</code></td><td>string</td><td>CLI ç‰ˆæœ¬</td></tr></tbody></table></div><h4 id=api-key-source-å–å€¼>API Key Source å–å€¼</h4><div class=table-wrapper><table><thead><tr><th>å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>ANTHROPIC_API_KEY</code></td><td>ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ API Key</td></tr><tr><td><code>none</code></td><td>ä½¿ç”¨ OAuth è®¤è¯ï¼ˆé€šè¿‡ <code>claude login</code> ç™»å½•ï¼‰</td></tr><tr><td><code>config</code></td><td>ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ API Key</td></tr></tbody></table></div><p><strong>æ³¨æ„ï¼š</strong> å½“ <code>apiKeySource</code> ä¸º <code>"none"</code> æ—¶ï¼ŒClaude Code ä¼šä½¿ç”¨å…ˆå‰ <code>claude login</code> ä¿å­˜çš„ OAuth token è¿›è¡Œè®¤è¯ï¼Œä»è€Œæ— éœ€æš´éœ² API Keyã€‚</p><h3 id=43-assistant-æ¶ˆæ¯>4.3 Assistant æ¶ˆæ¯</h3><p>Claude çš„å“åº”ï¼Œå¯èƒ½åŒ…å«æ–‡æœ¬ä¸/æˆ–å·¥å…·è°ƒç”¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;assistant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440002&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;model&#34;</span><span class=p>:</span> <span class=s2>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;msg_01ABC123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;assistant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;ll help you with that.&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_use&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_01XYZ789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Glob&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;input&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;**/*.rb&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stop_reason&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;usage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;input_tokens&#34;</span><span class=p>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;output_tokens&#34;</span><span class=p>:</span> <span class=mi>42</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cache_creation_input_tokens&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cache_read_input_tokens&#34;</span><span class=p>:</span> <span class=mi>12000</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=content-block-ç±»å‹>Content block ç±»å‹</h4><p><strong>Text blockï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;The response text...&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Tool use blockï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_use&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_01XYZ789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ToolName&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;input&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=err>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=44-user-æ¶ˆæ¯>4.4 User æ¶ˆæ¯</h3><p>è¿”å›ç»™ Claude çš„å·¥å…·ç»“æœã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440003&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tool_use_id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_01XYZ789&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;/path/to/file1.rb\n/path/to/file2.rb&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tool_use_result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filenames&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;/path/to/file1.rb&#34;</span><span class=p>,</span> <span class=s2>&#34;/path/to/file2.rb&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;durationMs&#34;</span><span class=p>:</span> <span class=mi>45</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numFiles&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;truncated&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=45-result-æ¶ˆæ¯>4.5 Result æ¶ˆæ¯</h3><p>æŒ‡ç¤ºä¸€æ¬¡ query å®Œæˆçš„æœ€ç»ˆæ¶ˆæ¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subtype&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440004&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;is_error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_ms&#34;</span><span class=p>:</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_api_ms&#34;</span><span class=p>:</span> <span class=mi>12000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;num_turns&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;I found 3 Ruby files in the directory...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;total_cost_usd&#34;</span><span class=p>:</span> <span class=mf>0.0234</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;usage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;input_tokens&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;output_tokens&#34;</span><span class=p>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cache_creation_input_tokens&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cache_read_input_tokens&#34;</span><span class=p>:</span> <span class=mi>15000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server_tool_use&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;web_search_requests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;web_fetch_requests&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;modelUsage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;inputTokens&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;outputTokens&#34;</span><span class=p>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheReadInputTokens&#34;</span><span class=p>:</span> <span class=mi>15000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheCreationInputTokens&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;webSearchRequests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;costUSD&#34;</span><span class=p>:</span> <span class=mf>0.0234</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;contextWindow&#34;</span><span class=p>:</span> <span class=mi>200000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;maxOutputTokens&#34;</span><span class=p>:</span> <span class=mi>64000</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permission_denials&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=result-subtype>Result subtype</h4><div class=table-wrapper><table><thead><tr><th>Subtype</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>success</code></td><td>Query æˆåŠŸå®Œæˆ</td></tr><tr><td><code>error_max_turns</code></td><td>è¶…è¿‡æœ€å¤§è½®æ¬¡é™åˆ¶</td></tr><tr><td><code>error_during_execution</code></td><td>æ‰§è¡ŒæœŸé—´å‘ç”Ÿè¿è¡Œæ—¶é”™è¯¯</td></tr><tr><td><code>error_max_budget_usd</code></td><td>è¶…è¿‡é¢„ç®—ä¸Šé™</td></tr></tbody></table></div><h4 id=result-å­—æ®µ>Result å­—æ®µ</h4><div class=table-wrapper><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>is_error</code></td><td>boolean</td><td>Query æ˜¯å¦ä»¥é”™è¯¯ç»“æŸ</td></tr><tr><td><code>duration_ms</code></td><td>integer</td><td>æ€»å¢™é’Ÿæ—¶é—´</td></tr><tr><td><code>duration_api_ms</code></td><td>integer</td><td>API è°ƒç”¨è€—æ—¶</td></tr><tr><td><code>num_turns</code></td><td>integer</td><td>å¯¹è¯è½®æ¬¡æ•°</td></tr><tr><td><code>result</code></td><td>string</td><td>æœ€ç»ˆæ–‡æœ¬ç»“æœ</td></tr><tr><td><code>total_cost_usd</code></td><td>float</td><td>æ€»èŠ±è´¹ï¼ˆUSDï¼‰</td></tr><tr><td><code>usage</code></td><td>object</td><td>èšåˆ token ç”¨é‡</td></tr><tr><td><code>modelUsage</code></td><td>object</td><td>æŒ‰æ¨¡å‹æ‹†åˆ†çš„ç”¨é‡</td></tr><tr><td><code>permission_denials</code></td><td>array</td><td>è¢«æ‹’ç»çš„å·¥å…·è°ƒç”¨åˆ—è¡¨</td></tr><tr><td><code>structured_output</code></td><td>any</td><td>è‹¥å¯ç”¨ç»“æ„åŒ–è¾“å‡ºåˆ™ä¸ºè§£æåçš„ JSON</td></tr><tr><td><code>errors</code></td><td>string[]</td><td>é”™è¯¯ä¿¡æ¯åˆ—è¡¨ï¼ˆå½“ <code>is_error: true</code>ï¼‰</td></tr></tbody></table></div><h3 id=46-stream-event-æ¶ˆæ¯>4.6 Stream event æ¶ˆæ¯</h3><p>Token çº§æµå¼è¾“å‡ºï¼ˆéœ€ <code>--include-partial-messages</code>ï¼‰ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;stream_event&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440005&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;content_block_delta&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;delta&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text_delta&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=stream-event-ç±»å‹>Stream event ç±»å‹</h4><div class=table-wrapper><table><thead><tr><th>Event Type</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>message_start</code></td><td>Assistant æ¶ˆæ¯å¼€å§‹</td></tr><tr><td><code>content_block_start</code></td><td>Content block å¼€å§‹</td></tr><tr><td><code>content_block_delta</code></td><td>Content å¢é‡æ›´æ–°</td></tr><tr><td><code>content_block_stop</code></td><td>Content block ç»“æŸ</td></tr><tr><td><code>message_delta</code></td><td>æ¶ˆæ¯å…ƒæ•°æ®æ›´æ–°</td></tr><tr><td><code>message_stop</code></td><td>Assistant æ¶ˆæ¯ç»“æŸ</td></tr></tbody></table></div><hr><h2 id=5-æµå¼æ¨¡å¼>5. æµå¼æ¨¡å¼</h2><h3 id=51-æ¶ˆæ¯çº§æµå¼é»˜è®¤>5.1 æ¶ˆæ¯çº§æµå¼ï¼ˆé»˜è®¤ï¼‰</h3><p>æœªå¯ç”¨ <code>--include-partial-messages</code> æ—¶ï¼Œæ¶ˆæ¯ä»¥å®Œæ•´å½¢å¼é€è¾¾ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>system â†’ assistant â†’ user â†’ assistant â†’ user â†’ assistant â†’ result
</span></span></code></pre></td></tr></table></div></div><p><strong>æ¶ˆæ¯åºåˆ—ç¤ºä¾‹ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#34;type&#34;:&#34;system&#34;,&#34;subtype&#34;:&#34;init&#34;,...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;assistant&#34;,&#34;message&#34;:{&#34;content&#34;:[{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;Full response here&#34;}]},...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;result&#34;,&#34;subtype&#34;:&#34;success&#34;,...}
</span></span></code></pre></td></tr></table></div></div><h3 id=52-token-çº§æµå¼>5.2 Token çº§æµå¼</h3><p>å¯ç”¨ <code>--include-partial-messages</code> åï¼Œtoken å°†å®æ—¶æµå‡ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>system â†’ stream_event* â†’ assistant â†’ stream_event* â†’ assistant â†’ result
</span></span></code></pre></td></tr></table></div></div><p><strong>Token åºåˆ—ç¤ºä¾‹ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#34;type&#34;:&#34;system&#34;,&#34;subtype&#34;:&#34;init&#34;,...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;message_start&#34;,...}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:0,&#34;content_block&#34;:{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_delta&#34;,&#34;delta&#34;:{&#34;text&#34;:&#34;Hello&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_delta&#34;,&#34;delta&#34;:{&#34;text&#34;:&#34; world&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_stop&#34;,...}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;assistant&#34;,&#34;message&#34;:{&#34;content&#34;:[{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;Hello world&#34;}]},...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;result&#34;,&#34;subtype&#34;:&#34;success&#34;,...}
</span></span></code></pre></td></tr></table></div></div><h3 id=53-æŠ½å–æµå¼æ–‡æœ¬>5.3 æŠ½å–æµå¼æ–‡æœ¬</h3><p>å®æ—¶å±•ç¤ºæ–‡æœ¬çš„ä¼ªä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>for each message in stream:
</span></span><span class=line><span class=cl>    if message.type == &#34;stream_event&#34;:
</span></span><span class=line><span class=cl>        event = message.event
</span></span><span class=line><span class=cl>        if event.type == &#34;content_block_delta&#34;:
</span></span><span class=line><span class=cl>            if event.delta.type == &#34;text_delta&#34;:
</span></span><span class=line><span class=cl>                print(event.delta.text)  // ä¸æ¢è¡Œï¼Œè¿½åŠ åˆ°è¾“å‡º
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=6-å·¥å…·ç³»ç»Ÿ>6. å·¥å…·ç³»ç»Ÿ</h2><h3 id=61-å†…ç½®å·¥å…·>6.1 å†…ç½®å·¥å…·</h3><div class=table-wrapper><table><thead><tr><th>å·¥å…·</th><th>æè¿°</th><th>å…³é”®å‚æ•°</th></tr></thead><tbody><tr><td><code>Read</code></td><td>è¯»å–æ–‡ä»¶å†…å®¹</td><td><code>file_path</code>, <code>offset</code>, <code>limit</code></td></tr><tr><td><code>Write</code></td><td>åˆ›å»º/è¦†ç›–æ–‡ä»¶</td><td><code>file_path</code>, <code>content</code></td></tr><tr><td><code>Edit</code></td><td>æ–‡ä»¶å†…æŸ¥æ‰¾æ›¿æ¢</td><td><code>file_path</code>, <code>old_string</code>, <code>new_string</code></td></tr><tr><td><code>Glob</code></td><td>æ–‡ä»¶æ¨¡å¼åŒ¹é…</td><td><code>pattern</code>, <code>path</code></td></tr><tr><td><code>Grep</code></td><td>æœç´¢æ–‡ä»¶å†…å®¹</td><td><code>pattern</code>, <code>path</code>, <code>output_mode</code></td></tr><tr><td><code>Bash</code></td><td>æ‰§è¡Œ shell å‘½ä»¤</td><td><code>command</code>, <code>timeout</code></td></tr><tr><td><code>WebFetch</code></td><td>æ‹‰å– URL å†…å®¹</td><td><code>url</code>, <code>prompt</code></td></tr><tr><td><code>WebSearch</code></td><td>Web æœç´¢</td><td><code>query</code></td></tr><tr><td><code>Task</code></td><td>å¯åŠ¨å­æ™ºèƒ½ä½“</td><td><code>prompt</code>, <code>subagent_type</code></td></tr><tr><td><code>TodoWrite</code></td><td>ç®¡ç†ä»»åŠ¡åˆ—è¡¨</td><td><code>todos</code></td></tr></tbody></table></div><h3 id=62-å·¥å…·è¾“å…¥-schema>6.2 å·¥å…·è¾“å…¥ Schema</h3><p><strong>Read å·¥å…·ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;file_path&#34;</span><span class=p>:</span> <span class=s2>&#34;/absolute/path/to/file&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;offset&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;limit&#34;</span><span class=p>:</span> <span class=mi>2000</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Edit å·¥å…·ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;file_path&#34;</span><span class=p>:</span> <span class=s2>&#34;/absolute/path/to/file&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;old_string&#34;</span><span class=p>:</span> <span class=s2>&#34;text to find&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;new_string&#34;</span><span class=p>:</span> <span class=s2>&#34;replacement text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;replace_all&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Bash å·¥å…·ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;ls -la&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timeout&#34;</span><span class=p>:</span> <span class=mi>120000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;List directory contents&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;run_in_background&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Glob å·¥å…·ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;**/*.rb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/search/directory&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Grep å·¥å…·ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;function\\s+\\w+&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/search/path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;glob&#34;</span><span class=p>:</span> <span class=s2>&#34;*.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;output_mode&#34;</span><span class=p>:</span> <span class=s2>&#34;content&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;-i&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;-n&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;-C&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;head_limit&#34;</span><span class=p>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=63-å·¥å…·è¿‡æ»¤>6.3 å·¥å…·è¿‡æ»¤</h3><p><strong>ç™½åå•ï¼ˆä»…è¿™äº›å·¥å…·å¯ç”¨ï¼‰ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --allowed-tools <span class=s2>&#34;Read,Glob,Grep&#34;</span> -- <span class=s2>&#34;Find files&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>é»‘åå•ï¼ˆè¿™äº›å·¥å…·ä¸å¯ç”¨ï¼‰ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --disallowed-tools <span class=s2>&#34;Bash,Write,Edit&#34;</span> -- <span class=s2>&#34;Analyze code&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=7-mcp-é›†æˆ>7. MCP é›†æˆ</h2><p>Model Context Protocolï¼ˆMCPï¼‰ç”¨äºæ¥å…¥è‡ªå®šä¹‰å·¥å…·ã€‚</p><h3 id=71-mcp-server-ç±»å‹>7.1 MCP Server ç±»å‹</h3><div class=table-wrapper><table><thead><tr><th>ç±»å‹</th><th>ä¼ è¾“æ–¹å¼</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>stdio</code></td><td>stdin/stdout</td><td>æœ¬åœ°è¿›ç¨‹ï¼Œè‡ªå®šä¹‰å·¥å…·</td></tr><tr><td><code>sse</code></td><td>Server-Sent Events</td><td>è¿œç¨‹æµå¼ server</td></tr><tr><td><code>http</code></td><td>HTTP POST</td><td>è¿œç¨‹è¯·æ±‚-å“åº” server</td></tr></tbody></table></div><h3 id=72-mcp-é…ç½®æ–‡ä»¶>7.2 MCP é…ç½®æ–‡ä»¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;mcpServers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;my-tools&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;mcp_server.py&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;env&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;API_KEY&#34;</span><span class=p>:</span> <span class=s2>&#34;secret&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;remote-tools&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;sse&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://mcp.example.com/sse&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;headers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Authorization&#34;</span><span class=p>:</span> <span class=s2>&#34;Bearer token&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>ç”¨æ³•ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --mcp-config /path/to/config.json -- <span class=s2>&#34;Use my custom tools&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=73-mcp-å·¥å…·å‘½å>7.3 MCP å·¥å…·å‘½å</h3><p>MCP å·¥å…·é‡‡ç”¨å‘½åç©ºé—´å½¢å¼ï¼š<code>mcp__&lt;server>__&lt;tool></code></p><p>ç¤ºä¾‹ï¼š<code>mcp__ruby-tools__calculator</code></p><h3 id=74-mcp-server-åè®®stdio>7.4 MCP Server åè®®ï¼ˆstdioï¼‰</h3><p>MCP server é€šè¿‡ stdin/stdout ä»¥ JSON-RPC 2.0 é€šä¿¡ã€‚</p><h4 id=initialize-æ¡æ‰‹>Initialize æ¡æ‰‹</h4><p><strong>å®¢æˆ·ç«¯è¯·æ±‚ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;initialize&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;clientInfo&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;claude-code&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.1.3&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æœåŠ¡ç«¯å“åº”ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;protocolVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-11-05&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;serverInfo&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my-tools&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;capabilities&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tools&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;listChanged&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=åˆ—å‡ºå·¥å…·list-tools>åˆ—å‡ºå·¥å…·ï¼ˆList Toolsï¼‰</h4><p><strong>è¯·æ±‚ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;tools/list&#34;</span><span class=p>,</span> <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{}}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å“åº”ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tools&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;calculator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Performs arithmetic operations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;inputSchema&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;operation&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=nt>&#34;enum&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;add&#34;</span><span class=p>,</span> <span class=s2>&#34;subtract&#34;</span><span class=p>,</span> <span class=s2>&#34;multiply&#34;</span><span class=p>,</span> <span class=s2>&#34;divide&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;a&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;number&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;b&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;number&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;operation&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è°ƒç”¨å·¥å…·call-tool>è°ƒç”¨å·¥å…·ï¼ˆCall Toolï¼‰</h4><p><strong>è¯·æ±‚ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;tools/call&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;calculator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;arguments&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;operation&#34;</span><span class=p>:</span> <span class=s2>&#34;multiply&#34;</span><span class=p>,</span> <span class=nt>&#34;a&#34;</span><span class=p>:</span> <span class=mi>7</span><span class=p>,</span> <span class=nt>&#34;b&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å“åº”ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;7 multiply 6 = 42&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=75-å®ç°ä¸€ä¸ª-mcp-server>7.5 å®ç°ä¸€ä¸ª MCP Server</h3><p>æœ€å° stdio MCP server çš„ä¼ªä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>function</span> <span class=n>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>line</span> <span class=o>=</span> <span class=n>read_stdin</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span> <span class=o>=</span> <span class=n>json_parse</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>handle_request</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>write_stdout</span><span class=p>(</span><span class=n>json_stringify</span><span class=p>(</span><span class=n>response</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>handle_request</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>match</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s2>&#34;initialize&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>protocolVersion</span><span class=p>:</span> <span class=s2>&#34;2024-11-05&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>serverInfo</span><span class=p>:</span> <span class=p>{</span><span class=n>name</span><span class=p>:</span> <span class=s2>&#34;my-server&#34;</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=n>capabilities</span><span class=p>:</span> <span class=p>{</span><span class=n>tools</span><span class=p>:</span> <span class=p>{</span><span class=n>listChanged</span><span class=p>:</span> <span class=bp>false</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s2>&#34;initialized&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>null</span>  <span class=o>//</span> <span class=err>é€šçŸ¥ï¼ˆ</span><span class=n>notification</span><span class=err>ï¼‰ï¼Œæ— éœ€å“åº”</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s2>&#34;tools/list&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span><span class=n>tools</span><span class=p>:</span> <span class=n>get_tool_definitions</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s2>&#34;tools/call&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>call_tool</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>params</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>params</span><span class=o>.</span><span class=n>arguments</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span><span class=n>content</span><span class=p>:</span> <span class=p>[{</span><span class=n>type</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=n>result</span><span class=p>}]}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=8-ä¼šè¯ç®¡ç†>8. ä¼šè¯ç®¡ç†</h2><h3 id=81-ä¼šè¯ç”Ÿå‘½å‘¨æœŸ>8.1 ä¼šè¯ç”Ÿå‘½å‘¨æœŸ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚    å¼€å§‹      â”‚â”€â”€â”€â”€&gt;â”‚    æ´»è·ƒ      â”‚â”€â”€â”€â”€&gt;â”‚    ç»“æŸ      â”‚
</span></span><span class=line><span class=cl>â”‚ ï¼ˆæ–° UUIDï¼‰  â”‚     â”‚  ï¼ˆqueriesï¼‰ â”‚     â”‚  ï¼ˆå·²å­˜å‚¨ï¼‰   â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>                           â”‚                   â”‚
</span></span><span class=line><span class=cl>                           â”‚    resume/        â”‚
</span></span><span class=line><span class=cl>                           â”‚    continue       â”‚
</span></span><span class=line><span class=cl>                           â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table></div></div><h3 id=82-å¯åŠ¨æ–°ä¼šè¯>8.2 å¯åŠ¨æ–°ä¼šè¯</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --output-format stream-json --verbose -- <span class=s2>&#34;Hello&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>system</code> æ¶ˆæ¯å°†åŒ…å«æ–°çš„ <code>session_id</code>ã€‚</p><h3 id=83-æ¢å¤ä¼šè¯>8.3 æ¢å¤ä¼šè¯</h3><p><strong>é€šè¿‡ Session IDï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --resume <span class=s2>&#34;550e8400-e29b-41d4-a716-446655440001&#34;</span> -- <span class=s2>&#34;Continue our work&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æœ€è¿‘ä¸€æ¬¡ä¼šè¯ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --continue -- <span class=s2>&#34;Continue where we left off&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=84-ä¼šè¯å­˜å‚¨>8.4 ä¼šè¯å­˜å‚¨</h3><p>ä¼šè¯æœ¬åœ°å­˜å‚¨è·¯å¾„ï¼š</p><ul><li><strong>macOS/Linuxï¼š</strong> <code>~/.claude/sessions/</code></li><li><strong>Windowsï¼š</strong> <code>%USERPROFILE%\.claude\sessions\</code></li></ul><hr><h2 id=9-æƒé™ç³»ç»Ÿ>9. æƒé™ç³»ç»Ÿ</h2><h3 id=91-æƒé™æ¨¡å¼>9.1 æƒé™æ¨¡å¼</h3><div class=table-wrapper><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>default</code></td><td>å¯¹æ•æ„Ÿæ“ä½œè¿›è¡Œæç¤ºç¡®è®¤</td></tr><tr><td><code>acceptEdits</code></td><td>è‡ªåŠ¨æ‰¹å‡†æ–‡ä»¶ç¼–è¾‘</td></tr><tr><td><code>bypassPermissions</code></td><td>è·³è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥</td></tr><tr><td><code>plan</code></td><td>è§„åˆ’æ¨¡å¼ï¼Œä¸æ‰§è¡Œ</td></tr></tbody></table></div><h3 id=92-ä½¿ç”¨æƒé™æ¨¡å¼>9.2 ä½¿ç”¨æƒé™æ¨¡å¼</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># è·³è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥ï¼ˆä»…å»ºè®®åœ¨æ²™ç®±ç¯å¢ƒä½¿ç”¨ï¼‰</span>
</span></span><span class=line><span class=cl>claude -p --dangerously-skip-permissions -- <span class=s2>&#34;Do something&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è‡ªåŠ¨æ¥å—ç¼–è¾‘</span>
</span></span><span class=line><span class=cl>claude -p --permission-mode acceptEdits -- <span class=s2>&#34;Refactor code&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=93-æƒé™æ‹’ç»permission-denials>9.3 æƒé™æ‹’ç»ï¼ˆPermission Denialsï¼‰</h3><p>å½“å·¥å…·è¢«æ‹’ç»æ—¶ï¼Œä¼šåœ¨ result ä¸­ä½“ç°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permission_denials&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tool_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Bash&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tool_use_id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_01ABC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tool_input&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;rm -rf /&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=10-é…ç½®é€‰é¡¹>10. é…ç½®é€‰é¡¹</h2><h3 id=101-å®Œæ•´é€‰é¡¹å‚è€ƒ>10.1 å®Œæ•´é€‰é¡¹å‚è€ƒ</h3><div class=table-wrapper><table><thead><tr><th>é€‰é¡¹</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>CLI å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>model</code></td><td>string</td><td>auto</td><td><code>--model</code></td><td>ä½¿ç”¨çš„æ¨¡å‹</td></tr><tr><td><code>max_turns</code></td><td>integer</td><td>unlimited</td><td><code>--max-turns</code></td><td>æœ€å¤§å¯¹è¯è½®æ¬¡æ•°</td></tr><tr><td><code>max_budget_usd</code></td><td>float</td><td>unlimited</td><td><code>--max-budget-usd</code></td><td>æœ€å¤§èŠ±è´¹</td></tr><tr><td><code>system_prompt</code></td><td>string</td><td>built-in</td><td><code>--system-prompt</code></td><td>è‡ªå®šä¹‰ system prompt</td></tr><tr><td><code>allowed_tools</code></td><td>string[]</td><td>all</td><td><code>--allowed-tools</code></td><td>å·¥å…·ç™½åå•</td></tr><tr><td><code>disallowed_tools</code></td><td>string[]</td><td>none</td><td><code>--disallowed-tools</code></td><td>å·¥å…·é»‘åå•</td></tr><tr><td><code>permission_mode</code></td><td>string</td><td>&ldquo;default&rdquo;</td><td><code>--permission-mode</code></td><td>æƒé™æ¨¡å¼</td></tr><tr><td><code>mcp_servers</code></td><td>object</td><td>{}</td><td><code>--mcp-config</code></td><td>MCP server é…ç½®</td></tr><tr><td><code>include_partial_messages</code></td><td>boolean</td><td>false</td><td><code>--include-partial-messages</code></td><td>token æµå¼</td></tr><tr><td><code>resume</code></td><td>string</td><td>null</td><td><code>--resume</code></td><td>æ¢å¤ä¼šè¯ ID</td></tr><tr><td><code>continue_session</code></td><td>boolean</td><td>false</td><td><code>--continue</code></td><td>ç»§ç»­æœ€è¿‘ä¸€æ¬¡ä¼šè¯</td></tr><tr><td><code>cwd</code></td><td>string</td><td>process cwd</td><td>(process cwd)</td><td>å·¥ä½œç›®å½•</td></tr></tbody></table></div><h3 id=102-æ¨¡å‹é€‰æ‹©>10.2 æ¨¡å‹é€‰æ‹©</h3><div class=table-wrapper><table><thead><tr><th>åˆ«å</th><th>å®Œæ•´åç§°</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td><code>opus</code></td><td>claude-opus-4-5-20251101</td><td>èƒ½åŠ›æœ€å¼ºï¼Œæˆæœ¬æœ€é«˜</td></tr><tr><td><code>sonnet</code></td><td>claude-sonnet-4-5-20250929</td><td>æ€§èƒ½/æˆæœ¬å¹³è¡¡</td></tr><tr><td><code>haiku</code></td><td>claude-haiku-4-5-20251001</td><td>æœ€å¿«ï¼Œæˆæœ¬æœ€ä½</td></tr></tbody></table></div><h3 id=103-system-prompt-é€‰é¡¹>10.3 System prompt é€‰é¡¹</h3><p><strong>æ›¿æ¢é»˜è®¤ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --system-prompt <span class=s2>&#34;You are a helpful assistant&#34;</span> -- <span class=s2>&#34;Hello&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>è¿½åŠ åˆ°é»˜è®¤ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>claude -p --append-system-prompt <span class=s2>&#34;Focus on Ruby code&#34;</span> -- <span class=s2>&#34;Hello&#34;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=11-é”™è¯¯å¤„ç†>11. é”™è¯¯å¤„ç†</h2><h3 id=111-é”™è¯¯-result-ç±»å‹>11.1 é”™è¯¯ result ç±»å‹</h3><div class=table-wrapper><table><thead><tr><th>Subtype</th><th>åŸå› </th><th>æ¢å¤æ–¹å¼</th></tr></thead><tbody><tr><td><code>error_max_turns</code></td><td>è¾¾åˆ°è½®æ¬¡ä¸Šé™</td><td>å¢åŠ  <code>max_turns</code></td></tr><tr><td><code>error_max_budget_usd</code></td><td>é¢„ç®—è€—å°½</td><td>å¢åŠ é¢„ç®—</td></tr><tr><td><code>error_during_execution</code></td><td>è¿è¡Œæ—¶å¤±è´¥</td><td>æ£€æŸ¥ <code>errors</code> å­—æ®µ</td></tr></tbody></table></div><h3 id=112-é”™è¯¯å“åº”ç¤ºä¾‹>11.2 é”™è¯¯å“åº”ç¤ºä¾‹</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subtype&#34;</span><span class=p>:</span> <span class=s2>&#34;error_during_execution&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;is_error&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;errors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Failed to connect to MCP server: connection refused&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;total_cost_usd&#34;</span><span class=p>:</span> <span class=mf>0.001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;num_turns&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=113-json-rpc-é”™è¯¯mcp>11.3 JSON-RPC é”™è¯¯ï¼ˆMCPï¼‰</h3><div class=table-wrapper><table><thead><tr><th>Code</th><th>Message</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-32700</td><td>Parse error</td><td>JSON æ— æ³•è§£æ</td></tr><tr><td>-32600</td><td>Invalid Request</td><td>è¯·æ±‚æ ¼å¼ä¸æ­£ç¡®</td></tr><tr><td>-32601</td><td>Method not found</td><td>æ–¹æ³•ä¸å­˜åœ¨</td></tr><tr><td>-32602</td><td>Invalid params</td><td>å‚æ•°ä¸åˆæ³•</td></tr><tr><td>-32603</td><td>Internal error</td><td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</td></tr></tbody></table></div><hr><h2 id=12-å®ç°æŒ‡å—>12. å®ç°æŒ‡å—</h2><h3 id=121-æœ€å°å®¢æˆ·ç«¯ä¼ªä»£ç >12.1 æœ€å°å®¢æˆ·ç«¯ï¼ˆä¼ªä»£ç ï¼‰</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>function query(prompt, options):
</span></span><span class=line><span class=cl>    cmd = build_command(prompt, options)
</span></span><span class=line><span class=cl>    process = spawn(cmd)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    for line in process.stdout:
</span></span><span class=line><span class=cl>        if line is empty:
</span></span><span class=line><span class=cl>            continue
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        message = json_parse(line)
</span></span><span class=line><span class=cl>        yield message
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        if message.type == &#34;result&#34;:
</span></span><span class=line><span class=cl>            break
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function build_command(prompt, options):
</span></span><span class=line><span class=cl>    cmd = [&#34;claude&#34;, &#34;--print&#34;, &#34;--output-format&#34;, &#34;stream-json&#34;, &#34;--verbose&#34;]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.model:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--model&#34;, options.model)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.max_turns:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--max-turns&#34;, string(options.max_turns))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.system_prompt:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--system-prompt&#34;, options.system_prompt)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.include_partial_messages:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--include-partial-messages&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.permission_mode == &#34;bypassPermissions&#34;:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--dangerously-skip-permissions&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if options.mcp_config_path:
</span></span><span class=line><span class=cl>        cmd.append(&#34;--mcp-config&#34;, options.mcp_config_path)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    cmd.append(&#34;--&#34;)
</span></span><span class=line><span class=cl>    cmd.append(prompt)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return cmd
</span></span></code></pre></td></tr></table></div></div><h3 id=122-æ¶ˆæ¯å¤„ç†å™¨æ¨¡å¼>12.2 æ¶ˆæ¯å¤„ç†å™¨æ¨¡å¼</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>function</span> <span class=n>handle_messages</span><span class=p>(</span><span class=n>stream</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>session_id</span> <span class=o>=</span> <span class=n>null</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>stream</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>match</span> <span class=n>message</span><span class=o>.</span><span class=n>type</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;system&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>session_id</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>session_id</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Session started:&#34;</span><span class=p>,</span> <span class=n>session_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Model:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Tools:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>tools</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;assistant&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>message</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;text&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>block</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=n>block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;tool_use&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;[Tool:&#34;</span><span class=p>,</span> <span class=n>block</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=s2>&#34;]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;user&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>message</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;tool_result&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;[Result received]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;stream_event&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>event</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;content_block_delta&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>delta</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;text_delta&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>print_no_newline</span><span class=p>(</span><span class=n>event</span><span class=o>.</span><span class=n>delta</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;result&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Completed:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>subtype</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Turns:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>num_turns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>log</span><span class=p>(</span><span class=s2>&#34;Cost: $&#34;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>total_cost_usd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>message</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=123-mcp-server-æ¨¡æ¿>12.3 MCP Server æ¨¡æ¿</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>class</span> <span class=n>MCPServer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>register_tool</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>schema</span><span class=p>,</span> <span class=n>handler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>description</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>schema</span><span class=p>:</span> <span class=n>schema</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>handler</span><span class=p>:</span> <span class=n>handler</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>run</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>line</span> <span class=o>=</span> <span class=n>stdin</span><span class=o>.</span><span class=n>readline</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>request</span> <span class=o>=</span> <span class=n>json_parse</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>dispatch</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>stdout</span><span class=o>.</span><span class=n>writeline</span><span class=p>(</span><span class=n>json_stringify</span><span class=p>(</span><span class=n>response</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>dispatch</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>match</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;initialize&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>init_response</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;initialized&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>null</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;tools/list&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>list_tools_response</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;tools/call&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>call_tool_response</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>error_response</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=o>-</span><span class=mi>32601</span><span class=p>,</span> <span class=s2>&#34;Method not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>init_response</span><span class=p>(</span><span class=n>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>id</span><span class=p>:</span> <span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>protocolVersion</span><span class=p>:</span> <span class=s2>&#34;2024-11-05&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>serverInfo</span><span class=p>:</span> <span class=p>{</span><span class=n>name</span><span class=p>:</span> <span class=s2>&#34;server&#34;</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>capabilities</span><span class=p>:</span> <span class=p>{</span><span class=n>tools</span><span class=p>:</span> <span class=p>{</span><span class=n>listChanged</span><span class=p>:</span> <span class=bp>false</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>list_tools_response</span><span class=p>(</span><span class=n>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tool_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=k>tool</span> <span class=ow>in</span> <span class=n>tools</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tool_list</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span><span class=p>:</span> <span class=k>tool</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>description</span><span class=p>:</span> <span class=k>tool</span><span class=o>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>inputSchema</span><span class=p>:</span> <span class=k>tool</span><span class=o>.</span><span class=n>schema</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span> <span class=n>id</span><span class=p>:</span> <span class=n>id</span><span class=p>,</span> <span class=n>result</span><span class=p>:</span> <span class=p>{</span><span class=n>tools</span><span class=p>:</span> <span class=n>tool_list</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>call_tool_response</span><span class=p>(</span><span class=n>id</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>tool</span> <span class=o>=</span> <span class=n>tools</span><span class=p>[</span><span class=n>params</span><span class=o>.</span><span class=n>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=k>tool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>content</span><span class=p>:</span> <span class=p>[{</span><span class=n>type</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=s2>&#34;Unknown tool&#34;</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>                    <span class=n>isError</span><span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=k>tool</span><span class=o>.</span><span class=n>handler</span><span class=p>(</span><span class=n>params</span><span class=o>.</span><span class=n>arguments</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>content</span><span class=p>:</span> <span class=p>[{</span><span class=n>type</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=n>string</span><span class=p>(</span><span class=n>result</span><span class=p>)}]</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>catch</span> <span class=n>error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>jsonrpc</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=p>:</span> <span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>content</span><span class=p>:</span> <span class=p>[{</span><span class=n>type</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=n>error</span><span class=o>.</span><span class=n>message</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>                    <span class=n>isError</span><span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=124-token-æˆæœ¬è®¡ç®—>12.4 Token æˆæœ¬è®¡ç®—</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>function calculate_cost(usage, model):
</span></span><span class=line><span class=cl>    // æ¯ç™¾ä¸‡ token çš„ä»·æ ¼ï¼ˆç¤ºä¾‹è´¹ç‡ï¼‰
</span></span><span class=line><span class=cl>    rates = {
</span></span><span class=line><span class=cl>        &#34;claude-opus-4-5&#34;: {input: 15.00, output: 75.00},
</span></span><span class=line><span class=cl>        &#34;claude-sonnet-4-5&#34;: {input: 3.00, output: 15.00},
</span></span><span class=line><span class=cl>        &#34;claude-haiku-4-5&#34;: {input: 0.80, output: 4.00}
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    rate = rates[model]
</span></span><span class=line><span class=cl>    input_cost = (usage.input_tokens / 1_000_000) * rate.input
</span></span><span class=line><span class=cl>    output_cost = (usage.output_tokens / 1_000_000) * rate.output
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Cache read é€šå¸¸æ›´ä¾¿å®œï¼ˆä¸€èˆ¬æ˜¯ input æˆæœ¬çš„ 10%ï¼‰
</span></span><span class=line><span class=cl>    cache_read_cost = (usage.cache_read_input_tokens / 1_000_000) * (rate.input * 0.1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Cache creation çš„æˆæœ¬ä¸ input ç›¸åŒ
</span></span><span class=line><span class=cl>    cache_create_cost = (usage.cache_creation_input_tokens / 1_000_000) * rate.input
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return input_cost + output_cost + cache_read_cost + cache_create_cost
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=é™„å½•-açœŸå®ä¸–ç•Œ-json-ç¤ºä¾‹>é™„å½• Aï¼šçœŸå®ä¸–ç•Œ JSON ç¤ºä¾‹</h2><h3 id=a1-å®é™…-system-æ¶ˆæ¯>A.1 å®é™… System æ¶ˆæ¯</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subtype&#34;</span><span class=p>:</span> <span class=s2>&#34;init&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cwd&#34;</span><span class=p>:</span> <span class=s2>&#34;/private/tmp/playing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;5620625c-b4c7-4185-9b2b-8de430dd2184&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tools&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Task&#34;</span><span class=p>,</span> <span class=s2>&#34;TaskOutput&#34;</span><span class=p>,</span> <span class=s2>&#34;Bash&#34;</span><span class=p>,</span> <span class=s2>&#34;Glob&#34;</span><span class=p>,</span> <span class=s2>&#34;Grep&#34;</span><span class=p>,</span> <span class=s2>&#34;ExitPlanMode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Read&#34;</span><span class=p>,</span> <span class=s2>&#34;Edit&#34;</span><span class=p>,</span> <span class=s2>&#34;Write&#34;</span><span class=p>,</span> <span class=s2>&#34;NotebookEdit&#34;</span><span class=p>,</span> <span class=s2>&#34;WebFetch&#34;</span><span class=p>,</span> <span class=s2>&#34;TodoWrite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;WebSearch&#34;</span><span class=p>,</span> <span class=s2>&#34;KillShell&#34;</span><span class=p>,</span> <span class=s2>&#34;AskUserQuestion&#34;</span><span class=p>,</span> <span class=s2>&#34;Skill&#34;</span><span class=p>,</span> <span class=s2>&#34;EnterPlanMode&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;mcp_servers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ruby-tools&#34;</span><span class=p>,</span> <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;connected&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;model&#34;</span><span class=p>:</span> <span class=s2>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permissionMode&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;slash_commands&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;compact&#34;</span><span class=p>,</span> <span class=s2>&#34;context&#34;</span><span class=p>,</span> <span class=s2>&#34;cost&#34;</span><span class=p>,</span> <span class=s2>&#34;init&#34;</span><span class=p>,</span> <span class=s2>&#34;pr-comments&#34;</span><span class=p>,</span> <span class=s2>&#34;release-notes&#34;</span><span class=p>,</span> <span class=s2>&#34;review&#34;</span><span class=p>,</span> <span class=s2>&#34;security-review&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apiKeySource&#34;</span><span class=p>:</span> <span class=s2>&#34;ANTHROPIC_API_KEY&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;claude_code_version&#34;</span><span class=p>:</span> <span class=s2>&#34;2.1.3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;output_style&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;agents&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Bash&#34;</span><span class=p>,</span> <span class=s2>&#34;general-purpose&#34;</span><span class=p>,</span> <span class=s2>&#34;statusline-setup&#34;</span><span class=p>,</span> <span class=s2>&#34;Explore&#34;</span><span class=p>,</span> <span class=s2>&#34;Plan&#34;</span><span class=p>,</span> <span class=s2>&#34;claude-code-guide&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;skills&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;plugins&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;gopls-lsp&#34;</span><span class=p>,</span> <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/Users/sam/.claude/plugins/cache/claude-plugins-official/gopls-lsp/1.0.0&#34;</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;95625b7e-3117-483b-95c9-47e54bb9ec70&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=a2-å®é™…åŒ…å«å·¥å…·è°ƒç”¨çš„-assistant-æ¶ˆæ¯>A.2 å®é™…åŒ…å«å·¥å…·è°ƒç”¨çš„ Assistant æ¶ˆæ¯</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;assistant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;model&#34;</span><span class=p>:</span> <span class=s2>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;msg_01Rf5Yc8FdberfJBxNjTNk3W&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;assistant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;ll use the ruby-tools MCP server to get the current time and generate a random number.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_use&#34;</span><span class=p>,</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_017K5vf&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;mcp__ruby-tools__current_time&#34;</span><span class=p>,</span> <span class=nt>&#34;input&#34;</span><span class=p>:</span> <span class=p>{}},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_use&#34;</span><span class=p>,</span> <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_018ABC&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;mcp__ruby-tools__random_number&#34;</span><span class=p>,</span> <span class=nt>&#34;input&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;min&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nt>&#34;max&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stop_reason&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stop_sequence&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;usage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;input_tokens&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cache_creation_input_tokens&#34;</span><span class=p>:</span> <span class=mi>4722</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cache_read_input_tokens&#34;</span><span class=p>:</span> <span class=mi>13367</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cache_creation&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;ephemeral_5m_input_tokens&#34;</span><span class=p>:</span> <span class=mi>4722</span><span class=p>,</span> <span class=nt>&#34;ephemeral_1h_input_tokens&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;output_tokens&#34;</span><span class=p>:</span> <span class=mi>28</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;service_tier&#34;</span><span class=p>:</span> <span class=s2>&#34;standard&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;context_management&#34;</span><span class=p>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;5620625c-b4c7-4185-9b2b-8de430dd2184&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;eda52225-597f-4a1f-8ca6-a6bcd94934ac&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=a3-å®é™…å·¥å…·ç»“æœtool-resultæ¶ˆæ¯>A.3 å®é™…å·¥å…·ç»“æœï¼ˆTool Resultï¼‰æ¶ˆæ¯</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;tool_use_id&#34;</span><span class=p>:</span> <span class=s2>&#34;toolu_01LsrzxpC42FnYPxepJfr9pg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;/private/tmp/playing/quick_start.rb\n/private/tmp/playing/advanced_examples.rb\n/private/tmp/playing/claude_agent_sdk_demo.rb&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;c8775347-af93-45c7-b9bf-a6e009483fa5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;4ffd3635-d0fb-4057-85e2-0f0a4c302fec&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;tool_use_result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filenames&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/private/tmp/playing/quick_start.rb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/private/tmp/playing/advanced_examples.rb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/private/tmp/playing/claude_agent_sdk_demo.rb&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;durationMs&#34;</span><span class=p>:</span> <span class=mi>345</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numFiles&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;truncated&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=a4-å®é™…-result-æ¶ˆæ¯>A.4 å®é™… Result æ¶ˆæ¯</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;result&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subtype&#34;</span><span class=p>:</span> <span class=s2>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;is_error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_ms&#34;</span><span class=p>:</span> <span class=mi>7040</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;duration_api_ms&#34;</span><span class=p>:</span> <span class=mi>12311</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;num_turns&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;I found 3 Ruby files in the directory:\n\n1. `quick_start.rb`\n2. `advanced_examples.rb`\n3. `claude_agent_sdk_demo.rb`&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;c8775347-af93-45c7-b9bf-a6e009483fa5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;total_cost_usd&#34;</span><span class=p>:</span> <span class=mf>0.0186724</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;usage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;input_tokens&#34;</span><span class=p>:</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cache_creation_input_tokens&#34;</span><span class=p>:</span> <span class=mi>440</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cache_read_input_tokens&#34;</span><span class=p>:</span> <span class=mi>35858</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;output_tokens&#34;</span><span class=p>:</span> <span class=mi>114</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server_tool_use&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;web_search_requests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;web_fetch_requests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;service_tier&#34;</span><span class=p>:</span> <span class=s2>&#34;standard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cache_creation&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;ephemeral_1h_input_tokens&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;ephemeral_5m_input_tokens&#34;</span><span class=p>:</span> <span class=mi>440</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;modelUsage&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;claude-haiku-4-5-20251001&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;inputTokens&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;outputTokens&#34;</span><span class=p>:</span> <span class=mi>170</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheReadInputTokens&#34;</span><span class=p>:</span> <span class=mi>10531</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheCreationInputTokens&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;webSearchRequests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;costUSD&#34;</span><span class=p>:</span> <span class=mf>0.0019051</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;contextWindow&#34;</span><span class=p>:</span> <span class=mi>200000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;maxOutputTokens&#34;</span><span class=p>:</span> <span class=mi>64000</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;inputTokens&#34;</span><span class=p>:</span> <span class=mi>9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;outputTokens&#34;</span><span class=p>:</span> <span class=mi>143</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheReadInputTokens&#34;</span><span class=p>:</span> <span class=mi>39900</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cacheCreationInputTokens&#34;</span><span class=p>:</span> <span class=mi>439</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;webSearchRequests&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;costUSD&#34;</span><span class=p>:</span> <span class=mf>0.0157882</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;contextWindow&#34;</span><span class=p>:</span> <span class=mi>200000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;maxOutputTokens&#34;</span><span class=p>:</span> <span class=mi>64000</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permission_denials&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;34cf1a3e-8b9f-481e-ba6f-c9e934b09424&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=a5-å®é™…-stream-eventtoken-delta>A.5 å®é™… Stream eventï¼ˆToken deltaï¼‰</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;stream_event&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;content_block_delta&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;delta&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;text_delta&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Dogs are loyal&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;4a7c99c6-e08a-4e3c-b6ce-17c33ae8bb92&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent_tool_use_id&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;2bc3e3c8-d9f2-48e8-bd72-b828bbbf3732&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=é™„å½•-bå®Œæ•´æ¶ˆæ¯æµç¤ºä¾‹>é™„å½• Bï¼šå®Œæ•´æ¶ˆæ¯æµç¤ºä¾‹</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># Query: &#34;List Ruby files and count them&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. System init</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;system&#34;</span><span class=p>,</span><span class=s2>&#34;subtype&#34;</span><span class=p>:</span><span class=s2>&#34;init&#34;</span><span class=p>,</span><span class=s2>&#34;session_id&#34;</span><span class=p>:</span><span class=s2>&#34;abc-123&#34;</span><span class=p>,</span><span class=s2>&#34;model&#34;</span><span class=p>:</span><span class=s2>&#34;claude-sonnet-4-5-20250929&#34;</span><span class=p>,</span><span class=s2>&#34;tools&#34;</span><span class=p>:[</span><span class=s2>&#34;Glob&#34;</span><span class=p>,</span><span class=s2>&#34;Bash&#34;</span><span class=p>,</span><span class=o>...</span><span class=p>],</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. Claude responds with tool use</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;assistant&#34;</span><span class=p>,</span><span class=s2>&#34;message&#34;</span><span class=p>:{</span><span class=s2>&#34;content&#34;</span><span class=p>:[{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;text&#34;</span><span class=p>,</span><span class=s2>&#34;text&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;ll find the Ruby files.&#34;</span><span class=p>},{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;tool_use&#34;</span><span class=p>,</span><span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;toolu_1&#34;</span><span class=p>,</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Glob&#34;</span><span class=p>,</span><span class=s2>&#34;input&#34;</span><span class=p>:{</span><span class=s2>&#34;pattern&#34;</span><span class=p>:</span><span class=s2>&#34;**/*.rb&#34;</span><span class=p>}}]},</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. Tool result</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>,</span><span class=s2>&#34;message&#34;</span><span class=p>:{</span><span class=s2>&#34;content&#34;</span><span class=p>:[{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;tool_result&#34;</span><span class=p>,</span><span class=s2>&#34;tool_use_id&#34;</span><span class=p>:</span><span class=s2>&#34;toolu_1&#34;</span><span class=p>,</span><span class=s2>&#34;content&#34;</span><span class=p>:</span><span class=s2>&#34;file1.rb</span><span class=se>\n</span><span class=s2>file2.rb</span><span class=se>\n</span><span class=s2>file3.rb&#34;</span><span class=p>}]},</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. Claude&#39;s final response</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;assistant&#34;</span><span class=p>,</span><span class=s2>&#34;message&#34;</span><span class=p>:{</span><span class=s2>&#34;content&#34;</span><span class=p>:[{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;text&#34;</span><span class=p>,</span><span class=s2>&#34;text&#34;</span><span class=p>:</span><span class=s2>&#34;I found 3 Ruby files:</span><span class=se>\n</span><span class=s2>1. file1.rb</span><span class=se>\n</span><span class=s2>2. file2.rb</span><span class=se>\n</span><span class=s2>3. file3.rb&#34;</span><span class=p>}]},</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. Query complete</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;result&#34;</span><span class=p>,</span><span class=s2>&#34;subtype&#34;</span><span class=p>:</span><span class=s2>&#34;success&#34;</span><span class=p>,</span><span class=s2>&#34;num_turns&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=s2>&#34;result&#34;</span><span class=p>:</span><span class=s2>&#34;I found 3 Ruby files...&#34;</span><span class=p>,</span><span class=s2>&#34;total_cost_usd&#34;</span><span class=p>:</span><span class=mf>0.0156</span><span class=p>,</span><span class=o>...</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=é™„å½•-bç»­token-æµå¼è¾“å‡ºæµç¨‹ç¤ºä¾‹>é™„å½• Bï¼ˆç»­ï¼‰ï¼šToken æµå¼è¾“å‡ºæµç¨‹ç¤ºä¾‹</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># With --include-partial-messages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;system&#34;,&#34;subtype&#34;:&#34;init&#34;,...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;message_start&#34;,&#34;message&#34;:{&#34;model&#34;:&#34;claude-sonnet-4-5-20250929&#34;,...}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:0,&#34;content_block&#34;:{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;Hello&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; world&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;!&#34;}}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:0}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;message_delta&#34;,&#34;delta&#34;:{&#34;stop_reason&#34;:&#34;end_turn&#34;},...}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;stream_event&#34;,&#34;event&#34;:{&#34;type&#34;:&#34;message_stop&#34;}}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;assistant&#34;,&#34;message&#34;:{&#34;content&#34;:[{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;Hello world!&#34;}]},...}
</span></span><span class=line><span class=cl>{&#34;type&#34;:&#34;result&#34;,&#34;subtype&#34;:&#34;success&#34;,...}
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=é™„å½•-cå‚è€ƒèµ„æ–™>é™„å½• Cï¼šå‚è€ƒèµ„æ–™</h2><ul><li><a class=link href=https://github.com/anthropics/claude-agent-sdk-typescript target=_blank rel=noopener>Claude Agent SDK TypeScript</a></li><li><a class=link href=https://docs.anthropic.com/claude-code target=_blank rel=noopener>Claude Code Documentation</a></li><li><a class=link href=https://modelcontextprotocol.io target=_blank rel=noopener>Model Context Protocol</a></li><li><a class=link href=https://www.jsonrpc.org/specification target=_blank rel=noopener>JSON-RPC 2.0 Specification</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/>æŠ€æœ¯æ–‡æ¡£</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/langchian-deepseek-v3-2-error/><div class=article-details><h2 class=article-title>Langchian Deepseek ä¸æ”¯æŒæœ€æ–°ç‰ˆ V3.2 æ€è€ƒæ¨¡å‹çš„è§£å†³æ–¹æ¡ˆ</h2></div></a></article><article><a href=/p/human-ai-collaborative-programming-paradigm/><div class=article-details><h2 class=article-title>ã€AIç¼–ç¨‹ã€‘äººä¸AIåä½œç¼–ç¨‹èŒƒå¼</h2></div></a></article><article><a href=/p/openai-use-opentelemetry/><div class=article-details><h2 class=article-title>ã€AIã€‘OpenAI ä½¿ç”¨ Opentelemetry è¿›è¡Œé“¾è·¯ç›‘æ§</h2></div></a></article><article><a href=/p/26-key-points-for-developing-agents/><div class=article-details><h2 class=article-title>[AI Agent]å¼€å‘æ™ºèƒ½ä½“çš„26ä¸ªå…³é”®è¦ç‚¹</h2></div></a></article><article><a href=/p/analysis-system-business/><div class=article-details><h2 class=article-title>[Prompt]ä½¿ç”¨AIåˆ†æç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘å’Œæ¶æ„</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2017 -
2026 é›¨çš„å‘³é“</section><section class=powerby><a style=display:none href=https://beian.miit.gov.cn/ target=_blank>æ™‹ICPå¤‡15000230å·-1</a><br>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>