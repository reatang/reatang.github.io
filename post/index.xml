<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on 雨的味道</title><link>https://reatang.com/post/</link><description>Recent content in Posts on 雨的味道</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 19 Jun 2025 20:21:43 +0800</lastBuildDate><atom:link href="https://reatang.com/post/index.xml" rel="self" type="application/rss+xml"/><item><title>庆祝博客又又又一次复活了</title><link>https://reatang.com/p/hello-world/</link><pubDate>Sun, 07 Jul 2024 00:00:00 +0000</pubDate><guid>https://reatang.com/p/hello-world/</guid><description>&lt;img src="https://reatang.com/p/hello-world/cover.jpg" alt="Featured image of post 庆祝博客又又又一次复活了" />&lt;p>博客挂了两年，终于是在Github上复活了&lt;/p>
&lt;blockquote>
&lt;p>Photo by &lt;a class="link" href="https://unsplash.com/@pawel_czerwinski" target="_blank" rel="noopener"
>Pawel Czerwinski&lt;/a> on &lt;a class="link" href="https://unsplash.com/" target="_blank" rel="noopener"
>Unsplash&lt;/a>&lt;/p>&lt;/blockquote></description></item><item><title>【PHP】在MAC OSX系统中无法找到C或者C++库的文件方案</title><link>https://reatang.com/p/php-ext-fix-homebrew-include/</link><pubDate>Thu, 19 Jun 2025 20:21:43 +0800</pubDate><guid>https://reatang.com/p/php-ext-fix-homebrew-include/</guid><description>&lt;p>今天在安装 &lt;code>ext-grpc&lt;/code> 和 &lt;code>ext-rdkafka&lt;/code> 库的时候遇到了无法找到C库头文件的问题。&lt;/p>
&lt;p>解决方案，将如下配置添加到 &lt;code>.zshrc&lt;/code> 或者 &lt;code>.bashrc&lt;/code> 中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">CFLAGS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-I/opt/homebrew/include -I$(xcrun --show-sdk-path)/usr/include&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">CPPFLAGS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-I/opt/homebrew/include -I$(xcrun --show-sdk-path)/usr/include/c++/v1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">LDFLAGS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-L/opt/homebrew/lib -L$(xcrun --show-sdk-path)/usr/lib&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>手工引导编译器查找 &lt;code>xcode-tools库&lt;/code> 和 &lt;code>homebrew库&lt;/code>&lt;/p>
&lt;p>另，记录一下php使用pecl安装指定版本的扩展方法。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">pecl install grpc-1.60.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【杂谈】从泡泡玛特重新审视商品和商品的价值</title><link>https://reatang.com/p/goods-and-their-value/</link><pubDate>Wed, 11 Jun 2025 15:01:27 +0800</pubDate><guid>https://reatang.com/p/goods-and-their-value/</guid><description>&lt;h3 id="一传统价值属性基于马克思的商品理论">一、传统价值属性（基于马克思的商品理论）
&lt;/h3>&lt;p>这些价值主要基于马克思的《资本论》，反映商品在生产和交换中的核心属性。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>使用价值（Use Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品满足人类物质或功能需求的实用性，基于其物理或功能属性。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：马克思认为使用价值是商品存在的基础，与具体需求相关，独立于交换过程。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：一双鞋的保暖和保护功能；一瓶水的解渴作用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>交换价值（Exchange Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品在市场上与其他商品交换的比例，通常以价格体现，基于社会必要劳动时间决定的内在价值。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：马克思的劳动价值论强调交换价值反映生产中的劳动投入，是资本主义经济的核心。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：一双鞋的价格由制鞋所需的社会平均劳动时间决定；一瓶水的市场价格反映其生产成本。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="二消费社会中的新兴价值属性">二、消费社会中的新兴价值属性
&lt;/h3>&lt;p>随着消费社会、品牌文化和数字经济的兴起，商品被赋予了超越传统功能和经济属性的新价值。&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>&lt;strong>符号价值（Symbolic Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过文化、社会或心理象征意义（如身份、地位、潮流）吸引消费者，超越其实际功能。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：由鲍德里亚等后现代理论家提出，反映消费社会中广告、媒体和品牌对商品意义的重新塑造。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：Gucci手提包象征时尚与财富；Supreme T恤代表街头文化归属感。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>体验价值（Experiential Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过提供独特的情感、感官或沉浸式体验创造价值，强调消费者与商品互动的主观感受。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：体验经济的兴起和数字技术（如VR/AR）推动消费者追求个性化、沉浸式体验。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：元宇宙中的数字服装（如虚拟Nike鞋）提供虚拟社交体验；VR旅游套装带来沉浸式旅行感受。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>生态价值（Ecological Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品因其对环境可持续性或社会责任的贡献而具有价值，吸引注重绿色生活的消费者。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：气候变化和环保意识增强使消费者更关注商品的环境影响。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：Patagonia的环保服装因可持续生产而增值；碳抵消服务支持环保事业。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>数据价值（Data Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过收集、生成或提供数据的能力创造价值，可用于优化用户体验或商业决策。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：数据驱动经济和物联网（IoT）使数据成为商品价值的新维度。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：Fitbit手环生成用户健康数据；智能音箱收集行为数据用于个性化服务。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>社区价值（Community Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过促进社会连接、群体认同或社区参与而获得价值。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：社交媒体和Web3平台（如DAO）强调社群归属感和集体文化。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：Bored Ape Yacht Club NFT提供独家社区会员资格；众筹艺术品增强社区文化支持。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>时间价值（Temporal Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过节省时间、提高效率或提供即时满足感而具有价值。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：快节奏生活和自动化技术使时间成为稀缺资源，消费者愿意为效率支付溢价。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：无人机即时配送服务；AI生成工具（如MidJourney）节省创作时间。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>伦理价值（Ethical Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品因符合道德标准（如公平贸易、反剥削）而增值，吸引注重社会正义的消费者。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：消费者对生产伦理的关注推动了道德消费的兴起。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：公平贸易咖啡支持小农；TOMS鞋的“买一捐一”模式体现慈善价值。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="三国际对抗背景下的隐秘价值属性">三、国际对抗背景下的隐秘价值属性
&lt;/h3>&lt;p>在当前地缘政治、技术竞争和供应链紧张的背景下，某些商品因其战略重要性被赋予隐秘价值，这些价值通常仅在私域信息（如政府报告、行业分析）中讨论。&lt;/p>
&lt;ol start="10">
&lt;li>
&lt;p>&lt;strong>地缘政治杠杆价值（Geopolitical Leverage Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过控制其供给或分配影响国际关系或谈判，成为地缘政治博弈的筹码。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：国际对抗（如中美科技战、俄乌冲突）使资源控制成为外交工具。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：中国对稀土元素的出口限制影响美国高科技产业；乌克兰粮食出口操控影响全球粮食安全。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>供应链瓶颈价值（Supply Chain Bottleneck Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品因处于全球供应链关键节点而具有价值，控制其生产可影响整个产业链。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：供应链重组和“去全球化”趋势凸显关键材料的战略重要性。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：光刻胶（半导体制造关键材料）由日本和韩国垄断；石墨供应影响电动车电池生产。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>技术锁定价值（Technological Lock-in Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过技术标准、专利或生态系统锁定用户或国家，增强长期控制力。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：技术竞争（如5G、AI）使专利和标准成为战略工具。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：华为5G设备的专利锁定客户国家；TensorFlow等AI框架锁定开发者生态。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>信息控制价值（Information Control Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过数据收集或传输能力控制信息流动，涉及网络安全或数据主权。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：数据驱动经济和网络安全问题使信息控制成为战略焦点。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：智能家居设备（如Alexa）收集用户数据；Starlink卫星模块可能用于通信监控。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>文化渗透价值（Cultural Penetration Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品通过文化输出或意识形态传播增强软实力，影响他国社会观念。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：文化产品在全球化的同时成为地缘政治工具。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：Netflix影视内容传播西方价值观；《原神》游戏输出中国文化元素。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="四未来可能的价值属性">四、未来可能的价值属性
&lt;/h3>&lt;p>随着技术进步和社会变迁，商品可能被赋予新的价值维度，这些维度尚在萌芽阶段或仅在特定领域讨论。&lt;/p>
&lt;ol start="15">
&lt;li>
&lt;p>&lt;strong>生命价值（Biocentric Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品因提升生命质量（如延长寿命、优化健康）而具有价值。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：生物技术和健康科技（如基因编辑）推动了对生命相关商品的需求。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：基因编辑服务（如CRISPR疗法）；定制化健康监测设备。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>跨维度价值（Transdimensional Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品跨越物理、虚拟和意识领域，通过增强认知或情感体验创造价值。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：脑机接口和元宇宙技术模糊了现实与虚拟的界限。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：脑机接口设备提升认知能力；虚拟地产提供跨维度社交体验。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>文化遗产价值（Cultural Heritage Value）&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：商品因承载历史、文化或集体记忆而具有价值，连接过去与未来。&lt;/li>
&lt;li>&lt;strong>背景&lt;/strong>：数字化和AI技术使文化遗产的保存和传播成为可能。&lt;/li>
&lt;li>&lt;strong>示例&lt;/strong>：数字化文物NFT；AI复原的传统文化体验产品。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="五总结表格">五、总结表格
&lt;/h3>&lt;p>以下表格总结了商品的各类价值属性，便于对比其定义、背景和示例：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>价值属性&lt;/strong>&lt;/th>
&lt;th>&lt;strong>定义&lt;/strong>&lt;/th>
&lt;th>&lt;strong>背景&lt;/strong>&lt;/th>
&lt;th>&lt;strong>示例&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>使用价值&lt;/strong>&lt;/td>
&lt;td>满足物质或功能需求的实用性&lt;/td>
&lt;td>马克思的商品理论，工业社会基础&lt;/td>
&lt;td>鞋的保暖功能；水的解渴作用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>交换价值&lt;/strong>&lt;/td>
&lt;td>基于劳动价值的交换比例（价格）&lt;/td>
&lt;td>马克思的劳动价值论，资本主义经济核心&lt;/td>
&lt;td>鞋的价格反映生产劳动；水的市场价格&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>符号价值&lt;/strong>&lt;/td>
&lt;td>文化、社会或心理象征意义（如身份、地位）&lt;/td>
&lt;td>消费社会，广告与品牌文化&lt;/td>
&lt;td>Gucci包象征财富；Supreme T恤代表潮流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>体验价值&lt;/strong>&lt;/td>
&lt;td>提供情感、感官或沉浸式体验&lt;/td>
&lt;td>体验经济，VR/AR技术发展&lt;/td>
&lt;td>元宇宙数字服装；VR旅游套装&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>生态价值&lt;/strong>&lt;/td>
&lt;td>对环境可持续性或社会责任的贡献&lt;/td>
&lt;td>气候变化，环保意识增强&lt;/td>
&lt;td>Patagonia环保服装；碳抵消服务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>数据价值&lt;/strong>&lt;/td>
&lt;td>通过数据收集或生成提供附加价值&lt;/td>
&lt;td>数据驱动经济，物联网兴起&lt;/td>
&lt;td>Fitbit健康数据；智能音箱行为数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>社区价值&lt;/strong>&lt;/td>
&lt;td>促进社会连接或群体认同&lt;/td>
&lt;td>社交媒体，Web3社区文化&lt;/td>
&lt;td>Bored Ape NFT会员资格；众筹艺术品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>时间价值&lt;/strong>&lt;/td>
&lt;td>节省时间或提供即时满足感&lt;/td>
&lt;td>快节奏生活，自动化技术&lt;/td>
&lt;td>无人机配送；AI生成工具&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>伦理价值&lt;/strong>&lt;/td>
&lt;td>符合道德标准（如公平贸易）&lt;/td>
&lt;td>道德消费，社会正义关注&lt;/td>
&lt;td>公平贸易咖啡；TOMS“买一捐一”鞋&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>地缘政治杠杆价值&lt;/strong>&lt;/td>
&lt;td>通过控制供给影响国际关系&lt;/td>
&lt;td>国际对抗，资源争夺&lt;/td>
&lt;td>稀土出口限制；乌克兰粮食出口操控&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>供应链瓶颈价值&lt;/strong>&lt;/td>
&lt;td>处于供应链关键节点，影响产业链&lt;/td>
&lt;td>供应链重组，去全球化趋势&lt;/td>
&lt;td>光刻胶垄断；石墨供应影响电池生产&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>技术锁定价值&lt;/strong>&lt;/td>
&lt;td>通过技术标准或专利锁定用户&lt;/td>
&lt;td>技术竞争，专利战&lt;/td>
&lt;td>华为5G设备；TensorFlow锁定AI开发者&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>信息控制价值&lt;/strong>&lt;/td>
&lt;td>控制数据流动或隐私，涉及网络安全&lt;/td>
&lt;td>数据主权，网络安全&lt;/td>
&lt;td>智能家居设备数据；Starlink通信监控&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>文化渗透价值&lt;/strong>&lt;/td>
&lt;td>通过文化输出增强软实力&lt;/td>
&lt;td>文化外交，全球化&lt;/td>
&lt;td>Netflix传播西方价值观；《原神》输出文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>生命价值&lt;/strong>&lt;/td>
&lt;td>提升生命质量（如健康、寿命）&lt;/td>
&lt;td>生物技术，健康科技&lt;/td>
&lt;td>基因编辑疗法；定制化健康设备&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>跨维度价值&lt;/strong>&lt;/td>
&lt;td>跨越物理、虚拟、意识领域，增强体验&lt;/td>
&lt;td>脑机接口，元宇宙&lt;/td>
&lt;td>脑机接口设备；虚拟地产&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>文化遗产价值&lt;/strong>&lt;/td>
&lt;td>承载历史或文化记忆，连接过去与未来&lt;/td>
&lt;td>数字化技术，文化保存&lt;/td>
&lt;td>文物NFT；AI复原传统文化体验&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="六总结与洞察">六、总结与洞察
&lt;/h3>&lt;p>商品的价值属性从马克思的传统&lt;strong>使用价值&lt;/strong>和&lt;strong>交换价值&lt;/strong>，扩展到消费社会的&lt;strong>符号价值&lt;/strong>、&lt;strong>体验价值&lt;/strong>等，再到国际对抗背景下的&lt;strong>地缘政治杠杆价值&lt;/strong>、&lt;strong>技术锁定价值&lt;/strong>等隐秘维度，反映了社会、技术和政治环境的变迁。未来，随着AI、生物技术、元宇宙和全球化的深入，&lt;strong>生命价值&lt;/strong>、&lt;strong>跨维度价值&lt;/strong>等新兴维度可能进一步丰富商品的意义。&lt;/p>
&lt;p>这些价值属性并非孤立存在，而是相互交织。例如，一款智能设备可能同时具有使用价值（功能）、数据价值（用户数据）、技术锁定价值（生态依赖）和信息控制价值（数据隐私）。在国际对抗中，隐秘价值如地缘政治杠杆和供应链瓶颈尤其关键，因其涉及国家安全和全球竞争，信息多限于私域。&lt;/p></description></item><item><title>[AI Agent]开发智能体的26个关键要点</title><link>https://reatang.com/p/26-key-points-for-developing-agents/</link><pubDate>Wed, 07 May 2025 16:42:08 +0800</pubDate><guid>https://reatang.com/p/26-key-points-for-developing-agents/</guid><description>&lt;h2 id="第一部分观念转变与认知升级">第一部分：观念转变与认知升级
&lt;/h2>&lt;ul>
&lt;li>1） AI Agent不是员工，而是 SOP (标准作业程序) 的延伸： 不要将 AI Agent视为自动化的替代品或员工的复制品。它们更多的是流程的具象化，每个Agent负责执行一个或少数几个 SOP。&lt;/li>
&lt;li>2） 从良好的文档化流程 (SOP) 开始： 训练Agent之前，先梳理并优化现有的 SOP。清晰的 SOP 是训练Agent的基础，能显著提高训练效率和Agent的可靠性。&lt;/li>
&lt;li>3） 企业主应委托 AI Agent开发者，而非亲自构建： 即使未来出现“一键生成Agent”的工具，专业的 AI Agent开发者仍然不可或缺。他们能够确定构建哪些Agent，并能最大化Agent的价值，正如无代码工具普及后，反而涌现了大量的自动化工程师一样。&lt;/li>
&lt;li>4） 咨询的重要性：了解客户真正的需求： 企业主可能对 AI Agent有自己的想法，但这些想法未必是最优的。通过咨询，深入了解客户的业务流程和痛点，才能找到更有价值的自动化机会。通过客户旅程绘制，可以更有效地识别潜在的自动化机会，选择更适合的Agent构建目标。&lt;/li>
&lt;li>5） Agent数量不宜过多，精简至上： 过多的Agent会增加系统的复杂性，导致维护困难、调试困难、成本上升和响应时间延长。优先构建一个能尽快交付价值的最简化Agent，逐步迭代和扩展。&lt;/li>
&lt;/ul>
&lt;h2 id="第二部分数据提示工程与集成">第二部分：数据、提示工程与集成
&lt;/h2>&lt;ul>
&lt;li>6） 数据驱动，更要将数据与行动相结合： 数据科学的 “GIGO”（garbage in, garbage out）原则同样适用于 AI Agent。更重要的是，将数据与相关行动结合，例如将知识库与 Facebook API 相结合，可以产生更大的价值。同时，要确保收集内外部数据以提升Agent性能。&lt;/li>
&lt;li>7） 提示工程是一门艺术，示例、顺序、迭代至关重要： 提示工程至关重要，它已经成为了一个职业。撰写提示如同撰写博客或论文，需要仔细斟酌每一个词语。提供充足的示例，注意句子和段落的顺序，并不断迭代和测试。最重要的部分放在指令的末尾。&lt;/li>
&lt;li>8） 集成与能力同等重要： Agent的集成性决定了用户的使用便捷性，便捷性决定了用户的使用意愿，所以决定了Agent能否交付实际价值。将Agent集成到员工日常使用的系统中，例如 Zendesk，至关重要。&lt;/li>
&lt;/ul>
&lt;h2 id="第三部分技术细节与可靠性保障">第三部分：技术细节与可靠性保障
&lt;/h2>&lt;ul>
&lt;li>9） Agent可靠性问题由开发者负责： 如果Agent不可靠，这不是Agent的问题，而是开发人员的问题。Pydantic 数据验证库可以用于验证Agent的输入和输出，确保Agent不会执行错误的操作。可以重点关注如何借助 Python 和相关框架来实现可靠性。&lt;/li>
&lt;li>10） 工具是 AI Agent的核心组件：指令、知识与行动缺一不可： 工具是Agent提供价值的方式。价值是通过行动产生，而不是通过响应产生。学会构建和组织工具，是构建各种用例Agent的关键。&lt;/li>
&lt;li>11） 每个Agent的工具数量不宜超过四到六种： 过多的工具会导致Agent产生幻觉、混淆工具的使用，可以通过分离Agent来解决。&lt;/li>
&lt;li>12） 模型成本不再是核心关注： 如果用例有意义，通常从使用 AI Agent中可以获得巨大的投资回报。&lt;/li>
&lt;/ul>
&lt;ol start="13">
&lt;li>客户更关心价值，而非模型选择： 企业更关心Agent能否提供价值、数据是否安全，对底层模型并不敏感。Azure OpenAI 等私有部署方案可以满足客户对数据隐私的要求。&lt;/li>
&lt;/ol>
&lt;h2 id="第四部分商业模式与扩展策略">第四部分：商业模式与扩展策略
&lt;/h2>&lt;ul>
&lt;li>14） 价值被确立之前，不要自动化： 先手动验证流程的价值和可行性，再进行自动化，避免不必要的风险和投入。&lt;/li>
&lt;li>15） 不要只考虑用例，要考虑 ROI（投资回报率）： 采用公式计算 ROI，关注对业务最有价值的部分。ROI 公式：(速率 * 工时 - 运营成本) / 开发成本。&lt;/li>
&lt;li>16） Agent开发是一个数据科学竞赛的迭代过程： 尝试不同的架构，对比结果，并从中学习，不断优化Agent。&lt;/li>
&lt;li>17） 使用分而治之的方法：逐步交付解决方案： 将复杂问题分解为可管理的任务，优先交付独立工作的Agent，获得客户确认后再继续构建整个系统。按部门进行自动化也是一个不错的策略。&lt;/li>
&lt;li>18） 评估至关重要（尤其是对于大型企业）： 评估可以帮助跟踪 KPI 和性能，不断改进解决方案。对于小型企业，评估可能并非必需。&lt;/li>
&lt;li>19） 两种Agent：Agent与工作流： 结合标准工作流程和自动化与 AI Agent。AI 驱动的步骤嵌入到结构化的工作流程中。&lt;/li>
&lt;/ul>
&lt;h2 id="第五部分未来趋势与注意事项">第五部分：未来趋势与注意事项
&lt;/h2>&lt;ul>
&lt;li>20） Agent需要适应反馈： 确保Agent不仅能修改环境，还能分析结果、了解行动的影响。&lt;/li>
&lt;li>21） 不要围绕限制构建：拥抱变化、面向未来： 不要基于当前的技术限制构建Agent，要预见到技术进步的可能性。&lt;/li>
&lt;li>22） 部署Agent比构建Agent更难： 需要花费较长的时间整合到客户的流程中，搭建一个平台以便支持灵活部署。&lt;/li>
&lt;li>23） 放弃瀑布模型，拥抱敏捷开发： Agent项目具有高度的灵活性，需要不断演进。采用订阅模式，与客户建立合作伙伴关系。&lt;/li>
&lt;li>24） 在关键任务Agent中加入人工环节： 对于容错率低的Agent，先加入人工审核环节，待Agent成熟后再取消人工干预。比如先让客户在notion审核营销活动，然后逐渐过渡到自动化。&lt;/li>
&lt;li>25） 2025 年是垂直 AI Agent的年份： 专注于特定领域和用例的Agent更易扩展、更具价值。可以逐渐从水平Agent过渡到垂直Agent。&lt;/li>
&lt;li>26） Agent不会取代人，而是帮助企业扩大规模： 关注扩大规模和提升价值，而不是裁员。&lt;/li>
&lt;/ul></description></item><item><title>[Prompt]使用AI分析系统的业务逻辑和架构</title><link>https://reatang.com/p/analysis-system-business/</link><pubDate>Wed, 16 Apr 2025 18:08:18 +0800</pubDate><guid>https://reatang.com/p/analysis-system-business/</guid><description>&lt;p>收到一个新的应用，首先应该从控制器、逻辑层、服务层等各个方面进行分析，现在我们将这个工作交给支持 filesystem mcp 的AI来做，我的提示词如下：
（这是以java应用为例）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl"># 角色设定
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">你是一位顶级的软件架构师和资深业务顾问，拥有卓越的技术洞察力和业务理解力。你不仅能深入分析代码结构和技术实现，更能将技术细节与业务价值紧密结合，洞察系统背后的业务逻辑、关键考量和潜在机会。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 我的背景
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">我是一名新加入 &amp;#34;[请填写项目名称]&amp;#34; 项目的成员，正处于项目熟悉阶段。我希望通过你的专业能力，全面了解项目的技术架构、业务流程以及技术决策背后的业务驱动因素。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 我的目标
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">我希望通过分析项目代码和相关信息，实现以下目标：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. **技术架构蓝图:** 清晰理解项目的 **技术分层、模块划分、组件构成、技术选型** 等核心技术架构要素。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. **业务流程全景:** 掌握项目支持的 **核心业务流程、用户场景、功能模块** 及其相互关系。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. **技术-业务双重视角:** 建立 **技术实现与业务目标之间的桥梁**，理解技术决策如何服务于业务，业务需求如何驱动技术选型。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. **关键业务考量与风险预警:** 识别项目中 **关键的业务考量因素、潜在的业务风险和技术挑战**，例如安全性、性能、合规性、可扩展性等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5. **快速上手与高效贡献:** 通过全面深入的理解，**快速融入项目团队，并能基于业务视角做出更有价值的贡献**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 任务要求
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">请基于我提供的 &amp;#34;[请填写项目名称]&amp;#34; 项目的代码信息（文件目录结构、关键代码片段、代码注释、技术文档等），进行以下多维度、深度融合的分析：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**第一阶段：技术架构解析 (Prompt A 核心 + 增强)**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. **目录结构与模块划分:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 分析项目根目录下的 **顶级目录结构**，推断 **技术模块和子系统划分**，例如前端、后端、API 网关、数据库、消息队列等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 深入后端代码目录（如 `src/main/java`, `app`, `backend`），识别 **代码模块**，例如 Controller, Service, Repository, Model, Config, Util 等，并推测其 **技术职责**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **模块命名与业务关联:** 不仅关注技术职责，更要 **从模块命名中初步推测其可能对应的业务领域或功能**。 例如，`OrderService` 可能关联订单业务，`UserService` 可能关联用户管理。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. **Controller 层深度分析:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **定位 Controller 目录**，识别主要的 Controller 文件和子目录。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **基于 Controller 命名和文件结构，推测其负责的业务功能或用户场景** (用简洁业务语言描述，例如 &amp;#34;处理用户注册流程&amp;#34; 而非 &amp;#34;/users POST 请求&amp;#34;)。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **API Endpoint 业务语义化:** 如果能获取 API Endpoint 信息 (例如 Spring Boot 项目的 `@RequestMapping` 注解)，请 **将技术化的 Endpoint 路径转化为更易懂的业务操作描述**。 例如 `/api/orders/{orderId}/payment` 可以描述为 &amp;#34;订单支付 API&amp;#34;。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **Controller 间的关联与流程初步推演:** 尝试分析 Controller 之间的调用关系 (如果能从代码片段中看出)，初步推演 **简单的业务流程片段**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. **关键技术组件识别与技术选型推测:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **根据目录结构、文件名后缀、配置文件等信息，推测项目使用的编程语言、框架、数据库、消息队列、缓存等核心技术栈**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 识别项目中使用的 **关键技术组件或库** (例如 ORM 框架, 日志库, 缓存客户端, 消息队列客户端等)，并 **简述其技术作用**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **技术选型的业务驱动因素推测:** 尝试 **推测项目技术选型背后的业务考虑**。 例如，选择 NoSQL 数据库可能是为了应对高并发和海量数据，选择微服务架构可能是为了支持业务快速迭代和独立部署。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**第二阶段：业务流程与关键考量 (Prompt B 核心 + 增强)**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. **核心业务流程串联与业务流程图:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **识别并描述项目中最核心的端到端业务流程** (例如用户下单、商品搜索、支付结算、内容发布等)。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **将业务流程与 Controller, Service 等技术模块关联起来，描述业务流程在技术层面的实现方式**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **业务流程图 (可选):** 如果条件允许，尝试 **用文字流程图或简单的 Markdown 图表** 描述关键业务流程，更直观地呈现流程步骤和模块交互。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5. **上下游依赖的业务价值与影响:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **分析项目依赖的上游服务和组件，并从业务角度解释依赖关系和业务价值** (例如依赖认证服务保障安全，依赖库存服务查询库存)。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **如果可能，了解下游系统如何依赖本项目，以及下游系统依赖本项目的哪些业务能力**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **依赖稳定性与业务连续性考量:** 分析 **关键依赖的稳定性对项目业务的影响**，例如外部服务故障是否会影响核心业务，是否有熔断降级机制。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6. **代码注释与业务规则深度挖掘:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **重点分析代码注释 (Controller, Service, Model 等)，提取业务规则、约束条件、特殊逻辑、重要提示等业务细节**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **业务规则分类整理:** 将提取的业务规则进行 **分类整理**，例如： 业务校验规则、权限控制规则、数据处理规则、风控规则、计费规则等，方便查阅和理解。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **业务流程中的关键决策点识别:** 从代码和注释中识别 **业务流程中的关键决策点和分支逻辑**，例如不同用户类型的流程差异，不同支付方式的处理分支等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">7. **关键业务考量、潜在风险与改进建议:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **识别项目中可能存在的关键业务考量点** (安全性、性能、可扩展性、合规性、数据一致性等)。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **基于代码分析和注释，尝试识别潜在的业务风险或技术挑战**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **结合技术和业务视角，提出改进建议:** 基于对技术架构和业务流程的理解，**从技术和业务角度出发，提出可能的改进建议**。 例如，性能优化建议、安全加固建议、业务流程优化建议、架构升级建议等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**第三阶段：综合总结与价值呈现**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">8. **技术架构与业务价值综合总结:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **总结项目在组织或产品线中的核心业务价值和业务定位**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **技术架构对业务价值的支撑作用:** **阐述项目的技术架构如何支撑其业务价值的实现**。 例如，高性能架构支撑高并发交易，微服务架构支撑业务快速创新。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * **项目成功的关键因素与未来展望:** 基于全面分析，**推测项目成功的关键因素，并对项目未来发展方向和潜在机会进行展望**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 输出格式要求
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">请使用清晰、结构化的 Markdown 格式呈现分析结果，例如使用 **多级标题、列表、表格、代码块、流程图** 等。 **突出显示关键信息，例如使用粗体、颜色标记、引用块等**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* **技术架构部分：** 侧重 **技术术语和架构图示 (文字描述的架构图)**，清晰描述技术分层、模块构成、技术选型等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* **业务流程部分：** 侧重 **业务语言和流程图**，清晰描述核心业务流程、用户场景、模块交互等。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* **关键考量与风险部分：** **重点突出业务风险和关键考量点**，并给出相应的 **技术或业务改进建议**。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* **综合总结部分：** **高度概括项目的技术架构和业务价值**，并展望未来。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**请在每个分析要点后，简要说明你分析的依据** (例如 &amp;#34;基于目录结构分析&amp;#34;, &amp;#34;基于 Controller 代码片段&amp;#34;, &amp;#34;基于代码注释&amp;#34; 等)，以增强分析的可信度和透明度。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 我将提供的信息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[请你根据实际情况，详细说明你将提供给 AI 的信息，例如：]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* &amp;#34;我会提供项目根目录的 `tree` 命令输出结果。&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* &amp;#34;我会提供 `src/main/java` 目录下的所有 Java 文件内容 (或关键 Controller/Service/Model 文件内容)。&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* &amp;#34;我会提供关键 Controller 和 Service 文件的代码片段和代码注释。&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* &amp;#34;我可以提供项目的技术文档 (如果项目有的话)。&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* &amp;#34;我可以根据你的需要，逐步提供更详细的代码或信息。&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 互动方式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">请在我提供信息后开始分析。请 **主动提问，引导我提供更精准、更有价值的信息**，以便进行更深入、更全面的分析。 这是一个深度协作的过程，我们共同努力，深入理解项目。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>[闲篇] 关于孩子教育</title><link>https://reatang.com/p/children-education/</link><pubDate>Tue, 11 Feb 2025 14:58:48 +0800</pubDate><guid>https://reatang.com/p/children-education/</guid><description>&lt;p>在这个温饱不再是焦虑的时代，启蒙教育的确迎来了百花齐放的局面，各种理念和方法层出不穷。 家长们也更加注重孩子的全面发展，希望孩子不仅仅是学习知识，更能拥有幸福和成功的未来。 在这多元化的启蒙教育中，真正能让孩子受用终身的品质，我认为可以归纳为以下几个方面：&lt;/p>
&lt;p>&lt;strong>一、 持续学习和思考的能力 (求知欲和学习力)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>好奇心和求知欲:&lt;/strong> 这是驱动孩子主动探索世界的内在动力。 拥有强烈好奇心的孩子，不会被动接受知识，而是会主动发问、探索、尝试，对世界充满兴趣，这种热情会伴随他们一生，让他们不断学习、进步。&lt;/li>
&lt;li>&lt;strong>批判性思维:&lt;/strong> 信息爆炸的时代，独立思考和判断能力至关重要。 培养孩子不盲从权威，学会质疑、分析、辨别信息的能力，让他们能够独立思考，形成自己的观点，而不是人云亦云。&lt;/li>
&lt;li>&lt;strong>解决问题的能力:&lt;/strong> 未来社会变化快速，遇到的问题也会更加复杂。 培养孩子分析问题、寻找解决方案、并能灵活调整策略的能力，让他们在面对挑战时能够积极应对，而不是轻易放弃。&lt;/li>
&lt;li>&lt;strong>终身学习的习惯:&lt;/strong> 知识更新迭代加速，单一的知识技能很容易过时。 培养孩子主动学习新知识、新技能的习惯，让他们具备适应变化的能力，并能持续提升自己。 这包括喜欢阅读，乐于尝试新事物，并能从错误中学习。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>二、 健康的情绪和社会交往能力 (情商和社交力)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>情绪管理能力:&lt;/strong> 学会认识、理解和管理自己的情绪，包括正面情绪和负面情绪。 能够控制冲动、缓解焦虑、积极乐观，是应对压力、保持心理健康的关键。&lt;/li>
&lt;li>&lt;strong>同理心和共情能力:&lt;/strong> 理解他人的感受，站在别人的角度思考问题，这是建立良好人际关系的基础。 拥有同理心的孩子更懂得关爱他人，更容易获得友谊和合作。&lt;/li>
&lt;li>&lt;strong>沟通表达能力:&lt;/strong> 清晰、准确、有效地表达自己的想法和情感，并能认真倾听他人的意见。 良好的沟通能力是建立人际关系、进行合作、解决冲突的关键。&lt;/li>
&lt;li>&lt;strong>合作精神和团队合作能力:&lt;/strong> 现代社会很多工作都需要团队协作完成。 培养孩子的合作意识，学会与人合作，尊重他人，共同完成目标，这对未来的工作和生活都至关重要。&lt;/li>
&lt;li>&lt;strong>抗挫折能力和韧性:&lt;/strong> 人生不可能一帆风顺，挫折和失败是必然会遇到的。 培养孩子面对挫折时的韧性，从失败中学习经验，重新振作，不轻易放弃，这是成功的关键品质。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>三、 积极的人格品质 (责任感和价值观)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>责任感:&lt;/strong> 对自己、对他人、对社会负责任的态度。 培养孩子从小事做起，承担自己的责任，信守承诺，做一个有担当的人。&lt;/li>
&lt;li>&lt;strong>诚信和正直:&lt;/strong> 诚实守信是立身之本。 培养孩子诚实正直的品质，让他们在任何情况下都能坚守道德底线，赢得他人的信任和尊重。&lt;/li>
&lt;li>&lt;strong>善良和感恩:&lt;/strong> 拥有善良的心，懂得关爱他人，帮助弱者，心怀感恩，珍惜拥有。 这会让孩子的人生充满温暖和幸福感。&lt;/li>
&lt;li>&lt;strong>坚毅和毅力:&lt;/strong> 为了目标坚持不懈，克服困难，永不放弃的精神。 培养孩子的毅力，让他们明白成功需要付出努力和坚持，而不是轻易放弃。&lt;/li>
&lt;li>&lt;strong>自律和自我管理能力:&lt;/strong> 能够约束自己，控制欲望，合理安排时间，完成既定目标。 自律是成功的重要保障，也是实现自我价值的关键。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>四、 创造力和想象力 (创新力)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>发散性思维和想象力:&lt;/strong> 打破常规，敢于想象，不拘泥于现有框架，这是创新的源泉。 鼓励孩子进行发散性思维，培养他们的想象力，让他们能够从不同角度看问题，并产生新的想法。&lt;/li>
&lt;li>&lt;strong>动手能力和实践能力:&lt;/strong> 将想法付诸实践，通过动手操作来验证、改进和创造。 培养孩子的动手能力，让他们在实践中学习，在实践中创新。&lt;/li>
&lt;li>&lt;strong>艺术审美能力:&lt;/strong> 培养孩子对美的感知和欣赏能力，让他们拥有更丰富的情感体验，也能激发创造力和想象力。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>总结:&lt;/strong>&lt;/p>
&lt;p>以上这些品质并非孤立存在，而是相互关联，共同塑造孩子的完整人格。 在多元化的启蒙教育中，家长和教育者应该关注孩子这些内在品质的培养，而不是仅仅追求知识的灌输和技能的速成。&lt;/p>
&lt;p>&lt;strong>如何培养这些品质？&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>营造积极的家庭环境:&lt;/strong> 父母的榜样作用至关重要，父母应该以身作则，展现这些美好的品质。 同时，家庭氛围应该充满爱、鼓励和支持，让孩子在一个安全、信任的环境中成长。&lt;/li>
&lt;li>&lt;strong>鼓励孩子探索和尝试:&lt;/strong> 给孩子提供丰富的体验机会，让他们接触不同的事物，鼓励他们去探索、去尝试、去犯错，从经验中学习。&lt;/li>
&lt;li>&lt;strong>注重过程而非结果:&lt;/strong> 鼓励孩子在学习和探索的过程中享受乐趣，而不是过分强调结果。 欣赏孩子的努力和进步，即使结果不尽如人意，也要肯定他们的付出。&lt;/li>
&lt;li>&lt;strong>提供适宜的教育资源:&lt;/strong> 选择符合孩子发展特点的教育方式，例如游戏化学习、项目式学习、STEAM教育等，激发孩子的学习兴趣和主动性。&lt;/li>
&lt;li>&lt;strong>尊重孩子的个性和兴趣:&lt;/strong> 每个孩子都是独特的，要尊重孩子的个性和兴趣，因材施教，帮助孩子找到自己的优势和发展方向。&lt;/li>
&lt;/ul>
&lt;p>总而言之，在这个多元化的时代，培养孩子受用终身的品质，比单纯的知识技能更为重要。 这些品质将帮助孩子更好地适应未来社会的变化，拥有幸福、成功的人生。 启蒙教育的关键在于 &lt;strong>启迪心智，塑造人格&lt;/strong>，让孩子成为一个 &lt;strong>独立思考、情绪健康、积极乐观、富有创造力&lt;/strong> 的人。&lt;/p></description></item><item><title>[Golang] 在中间件中获取HTTP响应状态码的两种方法</title><link>https://reatang.com/p/golang-http-code/</link><pubDate>Wed, 30 Oct 2024 15:49:43 +0800</pubDate><guid>https://reatang.com/p/golang-http-code/</guid><description>&lt;p>在使用 &lt;code>net/http&lt;/code> 库时，我们可能会遇到无法直接获取 HTTP 响应状态码的问题。为了优化这一点，我们可以采用以下两种方案：&lt;/p>
&lt;h2 id="方案一自定义-responsewriter">方案一：自定义 ResponseWriter
&lt;/h2>&lt;p>我们可以通过实现一个自定义的 &lt;code>ResponseWriter&lt;/code> 来获取 HTTP 响应状态码。具体步骤如下：&lt;/p>
&lt;ol>
&lt;li>创建一个结构体，嵌入 &lt;code>http.ResponseWriter&lt;/code> 并添加一个字段用于存储状态码。&lt;/li>
&lt;li>实现 &lt;code>WriteHeader&lt;/code> 方法，在调用原始 &lt;code>ResponseWriter&lt;/code> 的 &lt;code>WriteHeader&lt;/code> 方法之前，记录状态码。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">CustomResponseWriter&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">StatusCode&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">CustomResponseWriter&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">WriteHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">w&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusCode&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">code&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">w&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">code&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">w&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusNotFound&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello, World!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HandleFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">crw&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">CustomResponseWriter&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">w&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">crw&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Response status code: %d\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">crw&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusCode&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListenAndServe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;:8080&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="方案二使用-httpsnoop-包">方案二：使用 &lt;code>httpsnoop&lt;/code> 包
&lt;/h2>&lt;p>&lt;code>httpsnoop&lt;/code> 是一个第三方库，可以帮助我们更方便地获取 HTTP 响应状态码。使用方法如下：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>安装 &lt;code>httpsnoop&lt;/code> 包：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">go get -u github.com/felixge/httpsnoop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>使用 &lt;code>httpsnoop.CaptureMetrics&lt;/code> 包装处理函数，从返回的 &lt;code>Metrics&lt;/code> 中获取状态码。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/felixge/httpsnoop&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">w&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusNotFound&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello, World!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">middleware&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">next&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Handler&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HandlerFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">httpsnoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">CaptureMetrics&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">next&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;code: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Code&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;time: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Duration&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;length: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Written&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">middleware&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HandlerFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListenAndServe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;:8080&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="更高阶的使用方法">更高阶的使用方法
&lt;/h3>&lt;p>我们还可以使用 &lt;code>httpsnoop.Wrap&lt;/code> 和 &lt;code>httpsnoop.Hooks&lt;/code> 来实现更高阶的功能，例如记录更多的请求和响应信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/felixge/httpsnoop&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">w&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">StatusNotFound&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello, World!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">middleware&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">next&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Handler&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HandlerFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ResponseWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">_code&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 通过替换 WriteHeader 的实现，获取到 code&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_w&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">httpsnoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">httpsnoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Hooks&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">WriteHeader&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">headerFunc&lt;/span> &lt;span class="nx">httpsnoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WriteHeaderFunc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">httpsnoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WriteHeaderFunc&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_code&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">code&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">headerFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">code&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">next&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ServeHTTP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">_w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;code: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_code&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">middleware&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HandlerFunc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListenAndServe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;:8080&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过以上两种简单方案和一种高阶方案，我们可以有效地获取 HTTP 响应状态码，从而更好地处理和记录请求的应答信息。&lt;/p></description></item><item><title>[Golang] 让wireshark通过SSLKEYLOGFILE环境变量支持https抓包</title><link>https://reatang.com/p/golang-https-sslkeylogfile/</link><pubDate>Tue, 24 Sep 2024 10:33:53 +0800</pubDate><guid>https://reatang.com/p/golang-https-sslkeylogfile/</guid><description>&lt;blockquote>
&lt;p>本文章通过两章讲解wireshark抓https包&lt;/p>&lt;/blockquote>
&lt;h1 id="一wireshark抓浏览器的https流量">一、wireshark抓浏览器的https流量
&lt;/h1>&lt;p>&lt;a class="link" href="https://wiki.wireshark.org/TLS" target="_blank" rel="noopener"
>参考文档&lt;/a>&lt;/p>
&lt;h2 id="11-设置-sslkeylogfile-环境变量让chrome将秘钥握手信息输出到文件">1.1 设置 SSLKEYLOGFILE 环境变量让chrome将秘钥握手信息输出到文件
&lt;/h2>&lt;p>我安装的是zsh，配置文件是.zshrc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&amp;gt; &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;export SSLKEYLOGFILE=~/.sslkeyfile.log&amp;#39;&lt;/span> &amp;gt; .zshrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; touch ~/.sslkeyfile.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; chmod &lt;span class="m">600&lt;/span> ~/.sslkeyfile.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="12-设置-wireshark">1.2 设置 wireshark
&lt;/h2>&lt;p>打开配置界面：Edit -&amp;gt; Preferences。选择 Protocols &amp;gt; TLS&lt;/p>
&lt;p>&lt;img src="https://reatang.com/p/golang-https-sslkeylogfile/image-1.png"
width="1368"
height="760"
srcset="https://reatang.com/p/golang-https-sslkeylogfile/image-1_hu_9979001eeb75f1b9.png 480w, https://reatang.com/p/golang-https-sslkeylogfile/image-1_hu_5875c8df296870b5.png 1024w"
loading="lazy"
alt="配置界面"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;p>通过浏览器发起请求则会成功解密（如果与网站已经成功握手，则不会产生sslkeylog）&lt;/p>
&lt;p>&lt;img src="https://reatang.com/p/golang-https-sslkeylogfile/image.png"
width="3018"
height="1112"
srcset="https://reatang.com/p/golang-https-sslkeylogfile/image_hu_4b252cd02897138b.png 480w, https://reatang.com/p/golang-https-sslkeylogfile/image_hu_10cb77032f9c767c.png 1024w"
loading="lazy"
alt="最终得到整条流"
class="gallery-image"
data-flex-grow="271"
data-flex-basis="651px"
>&lt;/p>
&lt;h1 id="二golang的httpclient也支持该种方案">二、golang的http.Client也支持该种方案
&lt;/h1>&lt;p>&lt;a class="link" href="https://pkg.go.dev/crypto/tls#example-Config-KeyLogWriter" target="_blank" rel="noopener"
>参考文档&lt;/a>&lt;/p>
&lt;p>示例代码&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;crypto/tls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">getClient&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Client&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 读取环境配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sslkeyfile&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Getenv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SSLKEYLOGFILE&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">sslkeyfile&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;no SSLKEYLOGFILE environment variable&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">keyLogWriter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">OpenFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sslkeyfile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">O_APPEND&lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">O_RDWR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mo">0600&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Client&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Transport&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Transport&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">TLSClientConfig&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">tls&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">InsecureSkipVerify&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 本篇文章重点，设置Key日志&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">KeyLogWriter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">keyLogWriter&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">client&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getClient&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 发送 GET 请求&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">resp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;https://reatang.com&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to send request:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">defer&lt;/span> &lt;span class="nx">resp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Body&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 打印响应状态码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Response status:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">resp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Status&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>[Golang]Gozero Singleflight 库使用</title><link>https://reatang.com/p/golang-gozero-singleflight/</link><pubDate>Thu, 19 Sep 2024 11:35:23 +0800</pubDate><guid>https://reatang.com/p/golang-gozero-singleflight/</guid><description>&lt;blockquote>
&lt;p>SingleFlight: 单飞/单航。主要用于在并发场景下对多请求读取同一个数据进行控制，只允许其中一个请求真实发起读取，其他请求阻塞等待结果。&lt;/p>&lt;/blockquote>
&lt;p>缓存三大坑：&lt;/p>
&lt;ol>
&lt;li>穿透：因为错误的请求，缓存没有数据库也没有，导致一直触发DB操作。
&lt;ul>
&lt;li>应对：&lt;/li>
&lt;li>① 为不存在的数据也构建空缓存。&lt;/li>
&lt;li>② 使用布隆过滤拦截不存在的数据。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>击穿：缓存不存在或者过期的瞬间大量请求击穿缓存直接查询DB。
&lt;ul>
&lt;li>应对：&lt;/li>
&lt;li>① 热点数据不设置过期时间，定期执行刷新（也要设计并发脏数据问题），或使用Canal之类的中间件做双写控制。&lt;/li>
&lt;li>② 使用并发控制，如SingleFlight。但是该工具也只应对单机并发，在数百个replicas下还需进一步优化。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>雪崩：因为key的过期时间设置问题，导致大量缓存在短时间内失效。
&lt;ul>
&lt;li>应对：&lt;/li>
&lt;li>① 设置宽范围的动态缓存时间&lt;/li>
&lt;li>② 上线预热数据&lt;/li>
&lt;li>③ 多级缓存架构&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>示例代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">logic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/go-redis/redis/v8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/zeromicro/go-zero/core/logx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/zeromicro/go-zero/core/syncx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;reatang_demo_rpc/demo_rpc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;reatang_demo_rpc/internal/svc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;google.golang.org/grpc/metadata&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 全局初始化一个SingleFlight组件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">redisCacheSingleFlight&lt;/span> &lt;span class="nx">syncx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SingleFlight&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">init&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">redisCacheSingleFlight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">syncx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSingleFlight&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">RedisCacheLogic&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">svcCtx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">svc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ServiceContext&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Logger&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">NewRedisCacheLogic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">svcCtx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">svc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ServiceContext&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RedisCacheLogic&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">RedisCacheLogic&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Logger&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">logx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WithContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// RedisCache 第一种：完全使用 SingleFlight 承压&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RedisCacheLogic&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">RedisCache&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">in&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cacheKey&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;cache:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetPing&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 直接使用 SingleFlight 减少 redis和db的压力&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">redisCacheSingleFlight&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Do&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">any&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1、读取 cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CacheRedis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nf">Result&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Is&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Nil&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 数据不存在或者过期&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Is&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Nil&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2、查询数据库&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Itoa&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 模拟查询&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 3、缓存数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CacheRedis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SetEX&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// （可选）标记读取了源数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">header&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">metadata&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;reload-cache&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SendHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">header&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 4、返回数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Pong&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// RedisCache2 第二种：redis承压，SingleFlight保护DB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RedisCacheLogic&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">RedisCache2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">in&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cacheKey&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;cache2:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">in&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetKey&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 读取 cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">cacheResult&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CacheRedis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nf">Result&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Is&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Nil&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Is&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Nil&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 没有读取到缓存，执行单飞让并发请求中的一个请求去读取，其他请求等待&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">redisCacheSingleFlight&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Do&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">any&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1、查询数据库&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dbData&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Itoa&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 模拟查询&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2、缓存数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">svcCtx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CacheRedis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SetEX&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cacheKey&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dbData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// （可选）标记读取了源数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">header&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">metadata&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;reload-cache&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">grpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SendHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">l&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">header&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// （可选）暂停10ms，防止有请求瞬间未读取到redis数据，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 也错过SingleFlight数据，导致SingleFlight又被唤醒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Millisecond&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 3、返回数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">dbData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 此处所有在等待的请求都会得到同样的数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">result&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 读取到了缓存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">cacheResult&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">demo_rpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Response&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Pong&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>[Golang] yaml解析遇到内嵌结构体的问题</title><link>https://reatang.com/p/golang-yaml-inline/</link><pubDate>Wed, 21 Aug 2024 14:40:48 +0800</pubDate><guid>https://reatang.com/p/golang-yaml-inline/</guid><description>&lt;p>最近在开发中，组员报告了一个问题，读取配置文件的时候内嵌结构体（anonymous field）接收不到配置文件的参数。
经过排查，发现&lt;code>yaml&lt;/code>编解码包的行为和&lt;code>json&lt;/code>不太一样，这次就是这个差异导致的。&lt;/p>
&lt;h2 id="yaml对内嵌结构体的赋值策略和json不同">yaml对内嵌结构体的赋值策略和json不同
&lt;/h2>&lt;p>上代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;gopkg.in/yaml.v3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">SubData&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Sub1&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`yaml:&amp;#34;sub1&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Config&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">SubData&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Data1&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`yaml:&amp;#34;data1&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">y1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">data1: &amp;#34;aaaa&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">sub1: &amp;#34;bbbb&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Config&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">yaml&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nb">byte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">y1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">d&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>此处的预期输出应该为：&lt;code>{{bbbb} aaaa}&lt;/code>，但是实际得到的确是：&lt;code>{{} aaaa}&lt;/code>，内嵌结构体并没有收到的数据，这和&lt;code>json&lt;/code>包的行为不一样。&lt;/p>
&lt;p>后来通过对&lt;code>yaml&lt;/code>包的深入了解，原来yaml包需要添加：&lt;code>inline&lt;/code>的tag属性，才可以达到效果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Config&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">SubData&lt;/span> &lt;span class="s">`yaml:&amp;#34;,inline&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Data1&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`yaml:&amp;#34;data1&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>得到正确的结果：&lt;code>{{bbbb} aaaa}&lt;/code>&lt;/p>
&lt;p>另外，如果不加inline，那么yaml数据应该使用如下数据格式：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">data1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;aaaa&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">subdata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 与结构体同名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sub1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;bbbb&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【golang】gorm的一些特殊的配置</title><link>https://reatang.com/p/golang-gorm-config/</link><pubDate>Wed, 07 Aug 2024 18:05:15 +0800</pubDate><guid>https://reatang.com/p/golang-gorm-config/</guid><description>&lt;p>在观光一个go项目&lt;code>github.com/gotify/server&lt;/code>的时候，它的两段代码引起了我的注意：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 文件: database/database.go&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">dialect&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;sqlite3&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We use the database connection inside the handlers from the http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// framework, therefore concurrent access occurs. Sqlite cannot handle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// concurrent writes, so we limit sqlite to one connection.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// see https://github.com/mattn/go-sqlite3/issues/274&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">db&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">DB&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">SetMaxOpenConns&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">dialect&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;mysql&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Mysql has a setting called wait_timeout, which defines the duration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// after which a connection may not be used anymore.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// The default for this setting on mariadb is 10 minutes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// See https://github.com/docker-library/mariadb/issues/113&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">db&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">DB&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">SetConnMaxLifetime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Minute&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用sqlite的时候，连接数只能设置为1.&lt;/p>
&lt;p>使用mysql的时候，连接最大时间为9分钟.&lt;/p>
&lt;p>记录一下&lt;/p></description></item><item><title>【Golang】让Json自动支持DateTime格式和ISO8601格式的时间</title><link>https://reatang.com/p/golang-json-datetime/</link><pubDate>Wed, 10 Jul 2024 18:52:19 +0800</pubDate><guid>https://reatang.com/p/golang-json-datetime/</guid><description>&lt;p>默认的json使用的时间格式是 &lt;code>json.Time3339&lt;/code>，这个时间的格式为：&lt;code>2006-01-02T15:04:05Z07:00&lt;/code>&lt;/p>
&lt;p>而我们常用的格式：DateTime：&lt;code>2006-01-02 15:04:05&lt;/code> 和 ISO8601：&lt;code>2006-01-02T15:04:05+0800&lt;/code>&lt;/p>
&lt;h2 id="一datatime-解析">一、DataTime 解析
&lt;/h2>&lt;p>库：&lt;code>github.com/reatang/go-json-datetime&lt;/code>&lt;/p>
&lt;p>示例代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsondt&lt;/span> &lt;span class="s">&amp;#34;github.com/reatang/go-json-datetime&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Data&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">CreateTime&lt;/span> &lt;span class="nx">jsondt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DateTime&lt;/span> &lt;span class="s">`json:&amp;#34;create_time&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">j1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">`{&amp;#34;create_time&amp;#34;: &amp;#34;2024-07-10 18:52:19&amp;#34;}`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">d&lt;/span> &lt;span class="nx">Data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">j1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">d&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CreateTime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DateTime&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="二iso8601-解析">二、ISO8601 解析
&lt;/h2>&lt;p>有效的 ISO8601时间格式为：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>仅日期：&lt;/p>
&lt;ul>
&lt;li>2023-12-05&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>日期和时间（不含时区）：&lt;/p>
&lt;ul>
&lt;li>2023-12-05T14:30:00&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>日期和时间（含时区）：&lt;/p>
&lt;ul>
&lt;li>2023-12-05T14:30:00Z （Z 表示 UTC 时间）&lt;/li>
&lt;li>2023-12-05T14:30:00+08:00 （+08:00 表示东八区时间）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>仅时间（不含日期）：&lt;/p>
&lt;ul>
&lt;li>14:30:00&lt;/li>
&lt;li>14:30:00.123 （包含毫秒）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>周日期：&lt;/p>
&lt;ul>
&lt;li>2023-W50 （表示 2023 年的第 50 周）&lt;/li>
&lt;li>2023-W50-2 （表示 2023 年第 50 周的第 2 天）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>库：&lt;code>github.com/relvacode/iso8601&lt;/code>&lt;/p>
&lt;p>示例代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;github.com/relvacode/iso8601&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Data&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">CreateTime&lt;/span> &lt;span class="nx">iso8601&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Time&lt;/span> &lt;span class="s">`json:&amp;#34;create_time&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">j1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">`{&amp;#34;create_time&amp;#34;:&amp;#34;2017-04-24T09:41:34+0800&amp;#34;}`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="nx">Data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nb">byte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">j1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【Golang】 变量深拷贝方案</title><link>https://reatang.com/p/golang-deepcopy/</link><pubDate>Wed, 10 Jul 2024 18:00:05 +0800</pubDate><guid>https://reatang.com/p/golang-deepcopy/</guid><description>&lt;h2 id="零公共代码">零、公共代码
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">p1&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">Person&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;aaa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Params&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;param1&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;value1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;param2&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;value2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Next&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Person&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;bbb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Params&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;param3&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;value3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;param4&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;value4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Person&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Name&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Params&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Next&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Person&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="一反射方案">一、反射方案
&lt;/h2>&lt;p>使用库：&lt;code>github.com/mohae/deepcopy&lt;/code>&lt;/p>
&lt;p>示例代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;github.com/mohae/deepcopy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">p2&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">deepcopy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p1&lt;/span>&lt;span class="p">).(&lt;/span>&lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Person&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>性能：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">BenchmarkDeepCopy-8 775651 &lt;span class="m">1503&lt;/span> ns/op
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="二使用json">二、使用json
&lt;/h2>&lt;p>安装高性能的json库：&lt;code>github.com/json-iterator/go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nx">jsoniter&lt;/span> &lt;span class="s">&amp;#34;github.com/json-iterator/go&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">json&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">jsoniter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ConfigCompatibleWithStandardLibrary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">p1j&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Marshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">p2&lt;/span> &lt;span class="nx">types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Person&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unmarshal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p1j&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">p2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>性能：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># json-iterator 库性能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BenchmarkJsonIterJSON-8 1332277 885.5 ns/op
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 标准库性能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BenchmarkStdJSON-8 541288 &lt;span class="m">2128&lt;/span> ns/op
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="三k8s提供的deepcopy-gen">三、k8s提供的deepcopy-gen
&lt;/h2>&lt;p>安装生成工具：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">go install k8s.io/code-generator/cmd/deepcopy-gen
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加doc.go文件：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// file: doc.go&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 此处是核心注解&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// +k8s:deepcopy-gen=package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行命令生成deepcopy代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">deepcopy-gen --output-file generated.deepcopy.go your_module_name/...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>示例代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">p2&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">p1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">DeepCopy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>性能&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">BenchmarkK8sDepCopy-8 4201444 294.9 ns/op
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【Prorobuf】一文学习protobuf语法</title><link>https://reatang.com/p/old-post-44/</link><pubDate>Tue, 14 Jan 2020 17:12:52 +0000</pubDate><guid>https://reatang.com/p/old-post-44/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">syntax&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;proto3&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">文档：&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">developers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">protocol&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">buffers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proto3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">package&lt;/span> &lt;span class="n">foo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">包&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">数据结构&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">message&lt;/span> &lt;span class="n">SearchRequest&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="err">数据类型&lt;/span> &lt;span class="err">数据字段名称&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="err">数据编号。数据编号只能递增&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">string&lt;/span> &lt;span class="n">query&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">int32&lt;/span> &lt;span class="n">page_number&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">int32&lt;/span> &lt;span class="n">per_page&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">message&lt;/span> &lt;span class="n">SearchData&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">int32&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="err">被删除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="n">int32&lt;/span> &lt;span class="n">age&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="err">被删除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="err">常量的内嵌写法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">enum&lt;/span> &lt;span class="n">Sex&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">option&lt;/span> &lt;span class="n">allow_alias&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">将相同的值赋值给不同的常量，这个参数必须为&lt;/span>&lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">UNKNOWN&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">MALE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">MAN&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">FEMALE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">WOMAN&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">Sex&lt;/span> &lt;span class="n">sex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">注意，这里是序号，常量的默认值统一为&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="err">字典类型&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ne">int&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">tags&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="err">被删除的字段在兼容旧版本的情况下需标注保留&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">reserved&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">reserved&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">message&lt;/span> &lt;span class="n">SearchResponse&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">int32&lt;/span> &lt;span class="n">ec&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">string&lt;/span> &lt;span class="n">em&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="err">内嵌数据结构&lt;/span> &lt;span class="err">可用&lt;/span> &lt;span class="n">SearchResponse&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Page&lt;/span> &lt;span class="err">引用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">message&lt;/span> &lt;span class="n">Page&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">int32&lt;/span> &lt;span class="n">page&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">int32&lt;/span> &lt;span class="n">per_page&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">int32&lt;/span> &lt;span class="n">total_page&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">int32&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">Page&lt;/span> &lt;span class="n">page&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="n">repeated&lt;/span> &lt;span class="err">表示数组&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">repeated&lt;/span> &lt;span class="n">SearchData&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">总结：&lt;/span>&lt;span class="n">protobuf&lt;/span> &lt;span class="err">与&lt;/span> &lt;span class="n">json&lt;/span> &lt;span class="err">数据类型对比&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">developers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">protocol&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">buffers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proto3&lt;/span>&lt;span class="c1">#json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">定义具体的&lt;/span>&lt;span class="n">RPC服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="n">SearchService&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">rpc&lt;/span> &lt;span class="n">Search&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">SearchRequest&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">SearchResponse&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【PHP】Redis 中如何更好的加载Lua脚本</title><link>https://reatang.com/p/old-post-43/</link><pubDate>Wed, 20 Nov 2019 19:19:05 +0000</pubDate><guid>https://reatang.com/p/old-post-43/</guid><description>&lt;p>1、直接使用EVAL执行，不算在“更好”的范围内，不做讨论。&lt;/p>
&lt;p>2、正常判断式：先判断脚本存不存在，再进行操作。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">向&lt;/span>&lt;span class="n">Redis注册Lua脚本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">param&lt;/span> &lt;span class="n">Redis&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">param&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="ne">bool&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">mixed&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">load_lua_script&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Redis&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">is_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="bp">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">$&lt;/span>&lt;span class="n">sha1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sha1_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;EXISTS&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">sha1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">sha1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;LOAD&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">file_get_contents&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">script_sha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">load_lua_script&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;/path/to/lua_script.lua&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">reuslt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">evalSha&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">script_sha&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">key_number&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3、触发式执行：如果执行失败了，才LOAD脚本，并重新运行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 执行Lua脚本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param Redis $redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param $file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param $args
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param $numKeys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return bool|mixed|string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function run_lua_script(Redis $redis, $file, $args, $numKeys) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (!is_file($file)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $sha1 = sha1_file($file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    for ($run_number = 0; $run_number &amp;lt; 3; $run_number++) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $redis_result = $redis-&amp;gt;evalSha($sha1, $args, $numKeys);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        // 检测脚本是否不存在，如果不存在，则加载，并重新执行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        if (substr($redis-&amp;gt;getLastError(), 0, 8) === &amp;#39;NOSCRIPT&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            echo &amp;#39;LOAD&amp;#39; . PHP_EOL;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            $sha1 = $redis-&amp;gt;script(&amp;#39;LOAD&amp;#39;, file_get_contents($file));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            $redis-&amp;gt;clearLastError();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            continue;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return $redis_result;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$reuslt = run_lua_script($redis, &amp;#39;/path/to/lua_script.lua&amp;#39;, $args, $key_number);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>测试：&lt;/p>
&lt;p>Lua脚本：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">-- lua_script.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">local value = redis.call(&amp;#39;INCRBY&amp;#39;, KEYS[1], ARGV[1])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">return &amp;#39;hello &amp;#39; .. value
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>二号脚本测试运行10000次：8万次单程 IO 运行 0.9738 秒。&lt;/p>
&lt;p>三号脚本测试运行10000次：4万次单程 IO 运行 0.6284 秒。&lt;/p>
&lt;p>显而易见，触发式脚本可以更好的节约IO、以高的性能运行。&lt;/p></description></item><item><title>【Vue】在requirejs中使用ElementUI</title><link>https://reatang.com/p/old-post-41/</link><pubDate>Mon, 03 Jun 2019 20:16:39 +0000</pubDate><guid>https://reatang.com/p/old-post-41/</guid><description>&lt;p>在很多项目中，有时候无法加入webpack等编译工具，要是想使用ElementUI就非常困难了。&lt;/p>
&lt;p>不过还好浏览器加载标准requirejs可以解决这个问题。&lt;/p>
&lt;p>1、关键点在于，requirejs的define函数已经定义的ElementUI组件的名称为 ELEMENT，所以引入的时候必须使用这个名称。&lt;/p>
&lt;p>2、使用requirejs的时候，ElementUI组件是不会自动注册到Vue中的，必须使用 ELEMENT.install(Vue); 手动注册。&lt;/p>
&lt;p>代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &amp;lt;meta charset=&amp;#34;UTF-8&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &amp;lt;title&amp;gt;使用requirejs加载ElementUI&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &amp;lt;script src=&amp;#34;/js/require.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;div id=&amp;#34;v-app&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &amp;lt;div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;el-date-picker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      v-model=&amp;#34;value1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      type=&amp;#34;datetimerange&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      start-placeholder=&amp;#34;开始日期&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      end-placeholder=&amp;#34;结束日期&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      :default-time=&amp;#34;[&amp;#39;12:00:00&amp;#39;]&amp;#34; value-format=&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;/el-date-picker&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  require.config({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    map: { //map告诉RequireJS在任何模块之前，都先载入这个css模块
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &amp;#39;*&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            css: &amp;#39;/js/require-css.js&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    paths: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &amp;#39;vue&amp;#39;: &amp;#39;https://unpkg.com/vue/dist/vue&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &amp;#39;ELEMENT&amp;#39;: &amp;#39;/js/elementui/index&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    shim: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &amp;#39;ELEMENT&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        deps: [&amp;#39;vue&amp;#39;, &amp;#39;css!/js/elementui/theme-chalk/index.css&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  require([&amp;#39;vue&amp;#39;, &amp;#39;ELEMENT&amp;#39;], function (Vue, ELEMENT) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    ELEMENT.install(Vue);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    window.vm = new Vue({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      el: &amp;#39;#v-app&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      delimiters: [&amp;#39;${&amp;#39;, &amp;#39;}&amp;#39;],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      data: function () {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          value1: []
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【Docker】php官方镜像如何安装扩展</title><link>https://reatang.com/p/old-post-40/</link><pubDate>Tue, 30 Apr 2019 23:07:51 +0000</pubDate><guid>https://reatang.com/p/old-post-40/</guid><description>&lt;p>在Docker的PHP官方镜像中，存在着这样几个命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker-php-entrypoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-php-ext-configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-php-ext-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-php-ext-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-php-source
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装扩展主要用到了：docker-php-ext-install 命令。&lt;/p>
&lt;p>简单的安装一个pdo_mysql&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt; docker-php-ext-install pdo_mysql
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完事儿~&lt;/p>
&lt;p>更多细节请访问： &lt;a class="link" href="https://github.com/docker-library/php" target="_blank" rel="noopener"
>Github&lt;/a>&lt;/p></description></item><item><title>【Laravel】单独使用illuminate/view作为模板引擎</title><link>https://reatang.com/p/old-post-39/</link><pubDate>Sat, 16 Mar 2019 21:15:19 +0000</pubDate><guid>https://reatang.com/p/old-post-39/</guid><description>&lt;p>Laravel用习惯了以后，再用别的小框架总是想把Laravel的东西摘过去。。。这次摘一下视图层view&lt;/p>
&lt;p>目录结构&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">├── compiled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── .gitkeep
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── composer.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── composer.lock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── start.php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── views
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    └── welcome.blade.php
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装composer包：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">composer require illuminate/view 5.7.\*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>关键代码：&lt;/p>
&lt;p>start.php&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">?&lt;/span>&lt;span class="n">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Created&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">PhpStorm&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">User&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">reatang&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Date&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2019&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">下午&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Author&lt;/span> &lt;span class="n">reatang&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="n">__DIR__&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39;/vendor/autoload.php&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">视图系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Engines&lt;/span>\&lt;span class="n">EngineResolver&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Engines&lt;/span>\&lt;span class="n">FileEngine&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Engines&lt;/span>\&lt;span class="n">PhpEngine&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Compilers&lt;/span>\&lt;span class="n">BladeCompiler&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Engines&lt;/span>\&lt;span class="n">CompilerEngine&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">FileViewFinder&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">Factory&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">View&lt;/span>\&lt;span class="n">View&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">文件系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">Filesystem&lt;/span>\&lt;span class="n">Filesystem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">事件系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">use&lt;/span> \&lt;span class="n">Illuminate&lt;/span>\&lt;span class="n">Events&lt;/span>\&lt;span class="n">Dispatcher&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">模板文件目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;view.paths&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">__DIR__&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39;/views/&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">编译模板缓存目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;view.compiled&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">__DIR__&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s1">&amp;#39;/compiled/&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">文件系统抽象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__files&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">Filesystem&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">事件管理器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__events&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">Dispatcher&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">模板编译器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">EngineResolver&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;file&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">FileEngine&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;php&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">PhpEngine&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;blade&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="n">use&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">$&lt;/span>&lt;span class="n">blade_compiler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">BladeCompiler&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__files&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;view.compiled&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">CompilerEngine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">blade_compiler&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">模板文件管理器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">finder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">FileViewFinder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__files&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;view.paths&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">视图工厂&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">factory&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">Factory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">finder&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">GLOBALS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__events&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">清除视图缓存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">view_clear&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">var&lt;/span> &lt;span class="n">array&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">var&lt;/span> &lt;span class="n">Filesystem&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">__files&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">global&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">__files&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">$&lt;/span>&lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;view.compiled&amp;#39;&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">throw&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;View path not found.&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">__files&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">glob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;{$path}/*&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">strpos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;gitkeep&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="bp">false&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="o">$&lt;/span>&lt;span class="n">__files&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   &lt;span class="n">echo&lt;/span> &lt;span class="s1">&amp;#39;Compiled views cleared!&amp;#39;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="n">PHP_EOL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">初始化完成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">弱化：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="err">、无容器，所以无法使用&lt;/span> &lt;span class="n">class型的事件&lt;/span>&lt;span class="err">，只能用匿名函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="err">、无多语言，未加载多语言组件（因为也需要容器），无法使用&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">lang&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">trans&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="err">、没有&lt;/span>&lt;span class="n">auth系统&lt;/span>&lt;span class="err">，所以无法用&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">auth&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">guest&lt;/span> &lt;span class="err">之类的认证功能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="err">、没有&lt;/span>&lt;span class="n">session功能&lt;/span>&lt;span class="err">，所有无法使用&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">csrf&lt;/span> &lt;span class="err">功能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="err">、没有容器，无法使用&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">inject&lt;/span> &lt;span class="err">功能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="err">、没有&lt;/span>&lt;span class="n">LaravelCore不能使用&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">method&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="err">、还有未知的弱化内容未发现&lt;/span>&lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">扩展&lt;/span> &lt;span class="n">Blade&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">var&lt;/span> &lt;span class="n">BladeCompiler&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">_compiler&lt;/span> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">_compiler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">resolver&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;blade&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getCompiler&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">_compiler&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">directive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;lalala&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">expression&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;&amp;lt;?php echo ($expression)-&amp;gt;format(&amp;#39;m/d/Y H:i&amp;#39;); ?&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">模板事件可注入参数&lt;/span> &lt;span class="err">模板文件支持通配符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">factory&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">creator&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;welcome&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="n">creator&lt;/span> &lt;span class="err">是在视图被&lt;/span>&lt;span class="n">make的时候立马触发&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;creator_var&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;creator 注入&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">factory&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">composer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;welcome&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span> &lt;span class="n">composer&lt;/span> &lt;span class="err">是在视图&lt;/span>&lt;span class="n">render时触发&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">$&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;composer_var&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;composer 注入&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">共享变量特性&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">factory&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;global_var1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;全局共享变量&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">渲染&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">factory&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;welcome&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">render&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>welcome.blade.php&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">?&lt;/span>&lt;span class="n">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">$&lt;/span>&lt;span class="n">hello&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;你好&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">?&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;!&lt;/span>&lt;span class="n">doctype&lt;/span> &lt;span class="n">html&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">html&lt;/span> &lt;span class="n">lang&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;zh-CN&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">head&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">meta&lt;/span> &lt;span class="n">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">meta&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;viewport&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">meta&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">equiv&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;X-UA-Compatible&amp;#34;&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ie=edge&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="err">你好&lt;/span> &lt;span class="n">Blade&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">head&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{{&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">hello&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ul&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">@&lt;/span>&lt;span class="n">foreach&lt;/span> &lt;span class="p">([&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">li&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="p">}}&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">li&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">@&lt;/span>&lt;span class="n">endforeach&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">ul&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{{&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">global_var1&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{{&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">creator_var&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{{&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">composer_var&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">@&lt;/span>&lt;span class="n">lalala&lt;/span>&lt;span class="p">(&lt;/span>\&lt;span class="n">Carbon&lt;/span>\&lt;span class="n">Carbon&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【wordpress】文章编辑器中添加分页按钮</title><link>https://reatang.com/p/old-post-37/</link><pubDate>Mon, 09 Jul 2018 14:32:52 +0000</pubDate><guid>https://reatang.com/p/old-post-37/</guid><description>&lt;p>在自己的plugin添加过滤器钩子：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">//添加分页按钮
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add_filter(&amp;#39;mce_buttons&amp;#39;, function ($btn_lists, $editor_id) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (($wp_more_btn_index = array_search(&amp;#39;wp_more&amp;#39;, $btn_lists)) &amp;gt;= 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        array_splice($btn_lists, $wp_more_btn_index + 1, 0, &amp;#39;wp_page&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return $btn_lists;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}, 10, 2);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【Laravel】记 laravel/passport 单独调整每种token的有效期的 Hack操作</title><link>https://reatang.com/p/old-post-36/</link><pubDate>Sat, 28 Apr 2018 17:49:07 +0000</pubDate><guid>https://reatang.com/p/old-post-36/</guid><description>&lt;p>最近在为公司设计认证系统，使用laravel当然自动想到使用 laravel/passport 这个包来实现。&lt;/p>
&lt;p>不过有一个小问题，就是所有类型的token都只统一使用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Passport::tokensExpireIn(now()-&amp;gt;addSeconds(3600));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这种方式来定义有效期。不过对于机器对机器的Client Token 而言，3600s实在是有些短，通过一下午各种hack不得法&amp;hellip;发现了服务提供器已经率先注入了时间，所以直接继承passport包的 PassportServiceProvider 并修改 registerAuthorizationServer 的内容，即可单独设定有效期。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">class PassportServiceProvider extends PassportPassportServiceProvider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    /**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     * 单独 调整了 client token 的 时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     * @return void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    protected function registerAuthorizationServer()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $this-&amp;gt;app-&amp;gt;singleton(AuthorizationServer::class, function () {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            return tap($this-&amp;gt;makeAuthorizationServer(), function ($server) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    $this-&amp;gt;makeAuthCodeGrant(), Passport::tokensExpireIn()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    $this-&amp;gt;makeRefreshTokenGrant(), Passport::tokensExpireIn()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    $this-&amp;gt;makePasswordGrant(), Passport::tokensExpireIn()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    new PersonalAccessGrant, new \DateInterval(&amp;#39;P1Y&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    new ClientCredentialsGrant, new \DateInterval(&amp;#39;P1D&amp;#39;)//手动设定时间 Passport::tokensExpireIn()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                if (Passport::$implicitGrantEnabled) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    $server-&amp;gt;enableGrantType(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                        $this-&amp;gt;makeImplicitGrant(), Passport::tokensExpireIn()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                    );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>别忘记了在 config/app.php 中重新设定 provider。&lt;/strong>&lt;/p></description></item><item><title>【前端】一个简单的倒计时函数</title><link>https://reatang.com/p/old-post-35/</link><pubDate>Mon, 09 Apr 2018 13:18:03 +0000</pubDate><guid>https://reatang.com/p/old-post-35/</guid><description>&lt;p>一个通用的倒计时函数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">;(&lt;/span>&lt;span class="n">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">factory&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">typeof&lt;/span> &lt;span class="n">module&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s1">&amp;#39;object&amp;#39;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">module&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exports&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exports&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">factory&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">typeof&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s1">&amp;#39;function&amp;#39;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">define&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">amd&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">define&lt;/span>&lt;span class="p">([],&lt;/span> &lt;span class="n">factory&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">root&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">countdown&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">factory&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="n">function&lt;/span> &lt;span class="n">countdown&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">seconds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">onTicktock&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">onOver&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">seconds&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[countdown Error] #1 argument must be greater than 0&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="k">return&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">typeof&lt;/span> &lt;span class="n">onTicktock&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s1">&amp;#39;function&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[countdown Error] #2 argument must be a function&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="k">return&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span>&lt;span class="err">倒计时剩余时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">var&lt;/span> &lt;span class="n">restof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">seconds&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span>&lt;span class="err">计时器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">var&lt;/span> &lt;span class="n">timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span>&lt;span class="err">计时器间隔&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">var&lt;/span> &lt;span class="n">intervalTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">function&lt;/span> &lt;span class="n">ticktock&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">restof&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="err">也会返回&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">onTicktock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">restof&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stop&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="n">stop&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">function&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">clearInterval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">timer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">onOver&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">typeof&lt;/span> &lt;span class="n">onOver&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;function&amp;#39;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">onOver&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">//&lt;/span>&lt;span class="err">先执行一次&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">ticktock&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">setInterval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="n">ticktock&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">},&lt;/span> &lt;span class="n">intervalTime&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="n">stop&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="k">return&lt;/span> &lt;span class="n">countdown&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stop&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;剩余：&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">sec&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;秒&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;倒计时结束&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">callStop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">countdown&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">剩余：&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VM366&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6&lt;/span> &lt;span class="err">倒计时结束&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【brew】创建一个php71的xhprof安装包</title><link>https://reatang.com/p/old-post-34/</link><pubDate>Mon, 19 Mar 2018 12:48:20 +0000</pubDate><guid>https://reatang.com/p/old-post-34/</guid><description>&lt;h1 id="xhorof-php性能分析工具">xhorof php性能分析工具
&lt;/h1>&lt;p>原创文章，转载请注明出处： &lt;a class="link" href="%7b#ZC_BLOG_HOST#%7d?id=34" >{#ZC_BLOG_HOST#}?id=34&lt;/a>&lt;/p>
&lt;p>工具：&lt;/p>
&lt;p>php &amp;gt;= 7.0: &lt;a class="link" href="https://github.com/longxinH/xhprof" target="_blank" rel="noopener"
>https://github.com/longxinH/xhprof&lt;/a>&lt;/p>
&lt;p>php &amp;lt; 7.0 : https://github.com/phacility/xhprof&lt;/p>
&lt;p>1、创建文件 php71-xhprof.rb&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$&amp;gt;touch /usr/local/Homebrew/Library/Taps/homebrew/homebrew-php/Formula/php71-xhprof.rb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2、选择你喜欢的编辑器打开上面创建的文件，然后将如下内容复制进去并保存&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># file /usr/local/Homebrew/Library/Taps/homebrew/homebrew-php/Formula/php71-xhprof.rb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">require File.expand_path(&amp;#34;../../Abstract/abstract-php-extension&amp;#34;, __FILE__)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class Php71Xhprof &amp;lt; AbstractPhp71Extension
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  desc &amp;#34;XHProf is a function-level hierarchical profiler for PHP and has a simple HTML based user interface.&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  homepage &amp;#34;https://github.com/longxinH/xhprof&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  url &amp;#34;https://github.com/longxinH/xhprof/archive/v1.2.tar.gz&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  sha256 &amp;#34;a0026e6047512ee289e59b188a40a6517aace40d4c65f7f23714aa4f0458089c&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  head &amp;#34;https://github.com/longxinH/xhprof.git&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  depends_on &amp;#34;pcre&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  def install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    Dir.chdir &amp;#34;extension&amp;#34; do
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      ENV.universal_binary if build.universal?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      safe_phpize
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      system &amp;#34;./configure&amp;#34;, &amp;#34;--prefix=#{prefix}&amp;#34;, phpconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      system &amp;#34;make&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      prefix.install &amp;#34;modules/xhprof.so&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    prefix.install %w[xhprof_html xhprof_lib]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    write_config_file if build.with? &amp;#34;config-file&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3、使用命令开始安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$&amp;gt;brew install homebrew/php/php71-xhprof
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>4、编辑配置文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">; file /usr/local/etc/php/7.1/conf.d/ext-xhprof.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[xhprof]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">extension=&amp;#34;/usr/local/opt/php71-xhprof/xhprof.so&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">; 我的配置是设置为我的家目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xhprof.output_dir=&amp;#34;/Users/reatang/.xhprof&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>5、将xhprof的web页面添加到nginx配置中（如：创建xhprof.conf），并重启nginx&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># file /usr/local/etc/nginx/servers/xhprof.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    server_name xhprof.local; # 需要填入 /etc/hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    index index.php index.html index.htm;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    charset utf-8;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    root &amp;#34;/usr/local/Cellar/php71-xhprof/1.2/xhprof_html/&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    location = /favicon.ico { access_log off; log_not_found off; }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    location = /robots.txt  { access_log off; log_not_found off; }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    location ~ /\.ht { deny all; }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     try_files $uri $uri/ /index.php?$query_string;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~ \.php {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">         fastcgi_pass 127.0.0.1:9000; # 如果用的是Laravel的 valet，则写：unix:/Users/reatang/.valet/valet.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">         try_files $uri /index.php = 404;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">         fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">         include fastcgi_params;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>6、重启 nginx，重启php-fpm&lt;/p>
&lt;p>7、可以看一看 &lt;a class="link" href="https://github.com/longxinH/xhprof" target="_blank" rel="noopener"
>https://github.com/longxinH/xhprof&lt;/a> 的示例代码进行使用操作&lt;/p>
&lt;h2 id="注意">注意：
&lt;/h2>&lt;p>可能需要安装图片工具：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$&amp;gt;brew install graphviz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>p.s：做了一个laravel5.5的测试，无法直视&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2018/03/201803191521438573512067.png"
loading="lazy"
alt="laravel55.png"
>&lt;/p>
&lt;p>确实是一个hello world 12000+的调用&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2018/03/201803191521438600418730.png"
loading="lazy"
alt="image.png"
>&lt;/p></description></item><item><title>【PHP】一个方便实现单例的功能</title><link>https://reatang.com/p/old-post-33/</link><pubDate>Mon, 13 Nov 2017 17:43:00 +0000</pubDate><guid>https://reatang.com/p/old-post-33/</guid><description>&lt;p>使用trait的功能使类变为单例。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">?&lt;/span>&lt;span class="n">php&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trait&lt;/span> &lt;span class="n">SingletonObject&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">_singleton&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">final&lt;/span> &lt;span class="n">private&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__clone&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">final&lt;/span> &lt;span class="n">private&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__sleep&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">final&lt;/span> &lt;span class="n">private&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__wakeup&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__construct&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">返回单例&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="n">mixed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">final&lt;/span> &lt;span class="n">public&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">getInstance&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">is_null&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">static&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">_singleton&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">static&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">_singleton&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">singleton&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">_singleton&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">这个方法只会被调用一次，用于生产单例的时候&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">如果类有特殊的参数，则需要重写这个方法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="n">mixed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">singleton&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;?php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class NeedSingleton
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    use SingletonObject;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//则直接可以使用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$s = NeedSingleton::getInstance();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果构造类的时候需要初始化参数，则可以重写`singleton`方法：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="n">NeedSingleton2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">use&lt;/span> &lt;span class="n">SingletonObject&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__construct&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">singleton&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="o">//&lt;/span> &lt;span class="n">some&lt;/span> &lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">return&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">或者直接重写&lt;/span> &lt;span class="n">__construct&lt;/span> &lt;span class="err">就好了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="n">NeedSingleton3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">use&lt;/span> &lt;span class="n">SingletonObject&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">__construct&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="o">//&lt;/span> &lt;span class="n">some&lt;/span> &lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Window7修改登陆页面图片</title><link>https://reatang.com/p/old-post-32/</link><pubDate>Sat, 28 Oct 2017 14:51:35 +0000</pubDate><guid>https://reatang.com/p/old-post-32/</guid><description>&lt;p>1、把图片放入 C:\Windows\System32\oobe\info\backgrounds&lt;/p>
&lt;p>2、改名为：BackgroundDefault.jpg&lt;/p>
&lt;p>3、创建文件：win_login_background.reg 粘贴下面内容到文件内，并执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Windows Registry Editor Version 5.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\Background]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;OEMBackground&amp;#34;=dword:00000001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【爬坑】在laravel中使用vue（非laravel-mix）</title><link>https://reatang.com/p/old-post-31/</link><pubDate>Fri, 18 Aug 2017 14:12:14 +0000</pubDate><guid>https://reatang.com/p/old-post-31/</guid><description>&lt;h1 id="laravel_">&lt;img src="https://reatang.com/%7b%5c#ZC_BLOG_HOST%5c#%7dzb_users/upload/2017/08/201708181503043538917387.jpg"
loading="lazy"
alt="laravel_vue.jpg"
>
&lt;/h1>&lt;h1 id="前言">前言：
&lt;/h1>&lt;p>在大型富交互的项目中，前后端分离的设计越来越受到重视。&lt;/p>
&lt;p>为了方便前后端同学在一个项目中进行开发，我这边的项目搭建并没有使用laravel-mix（领导说不要使用不熟悉的东西），而是直接使用vue+webpack进行搭建。&lt;/p>
&lt;h1 id="背景">背景：
&lt;/h1>&lt;p>- resources&lt;/p>
&lt;p>    - views 模板文件&lt;/p>
&lt;p>        - index 入口文件放置的文件夹&lt;/p>
&lt;p>    - vue vue全部文件，blade的模板文件&lt;/p>
&lt;p>        - build 构建参数和脚本&lt;/p>
&lt;p>        - src 源代码&lt;/p>
&lt;p>        - tpl 需要构建给laravel blade的模板文件&lt;/p>
&lt;p>        - config 构建环境参数&lt;/p>
&lt;p>- public&lt;/p>
&lt;p>    - v webpack的构建内容全部在放在这里，当然这个是要配置的&lt;/p>
&lt;h1 id="坑们">坑们：
&lt;/h1>&lt;p>主要的坑都来自开发环境&lt;/p>
&lt;h2 id="坑一页面入口问题">坑一：页面入口问题。
&lt;/h2>&lt;p>在vue默认的项目中，代码会自动生成一个index.html作为首页。而在laravel中使用的blade模板。我首先想了两个方案。&lt;/p>
&lt;p>1、使用插件 assets-webpack-plugin 生成assets.json 文件，然后由php动态解析到模板中。&lt;/p>
&lt;p>2、直接由webpack构建系统生成blade模板&lt;/p>
&lt;p>坑一解决：&lt;/p>
&lt;p>第一种做法操作简单，不过每次都要解析assets.json文件。&lt;/p>
&lt;p>第二种做法不需要解析文件，但是需要让vue的构建系统侵入(或叫操作) laravel的文件夹（views中添加文件）。&lt;/p>
&lt;p>不过这两种方法在dev模式下都有一个问题，热更新模式下都不会生成文件。不管是assets.json 还是 index.blade.php（坑二解决）。&lt;/p>
&lt;h2 id="坑二热更新的情况话不会生成indexbladephp文件">坑二：热更新的情况话不会生成index.blade.php文件。
&lt;/h2>&lt;p>坑二解决：我在 build/dev-server.js 中添加了强制复制 resouces/vue/tpl/index_dev.blade.php 到 resouces/views/index/index.blade.php。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="n">build&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">js&lt;/span> &lt;span class="err">文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">opn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;opn&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;path&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">express&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;express&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">webpack&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;webpack&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">proxyMiddleware&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;http-proxy-middleware&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">webpackConfig&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;./webpack.dev.conf&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">copy函数会把模板文件复制到views中供laravel解析&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">fs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;fs&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dst&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">fs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">createReadStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pipe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">createWriteStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dst&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">测试的时候应该把测试用的&lt;/span>&lt;span class="n">index文件复制到真正的文件中&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">__dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/../tpl/index_dev.blade.php&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">__dirname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;/../../views/index/index.blade.php&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>&lt;span class="err">本文附录中会带&lt;/span>&lt;span class="n">index_dev&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">blade&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">php文件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然，在npm run build 的时候也得构建正常的index.blade.php文件到views中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// build/webpack.prod.conf.js 文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">new HtmlWebpackPlugin({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  filename: resolve(&amp;#39;../../views/index/index.blade.php&amp;#39;),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  template: resolve(&amp;#39;./tpl/index_tpl.blade.php&amp;#39;), //webpack 会自动将脚本注入body尾部，为了方便语法，模板文件的文件后缀也用了blade.php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  //本文附录中会带index_tpl.blade.php文件内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  inject: true,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  minify: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    removeComments: true,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    collapseWhitespace: false, //注意不要设置为true ，会将模板内格式删除，不利于blade解析
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    removeAttributeQuotes: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  chunksSortMode: &amp;#39;dependency&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="坑三热更新的地址指向问题">坑三：热更新的地址指向问题。
&lt;/h2>&lt;p>    因为laravel开发都是使用nginx或者valet 所以laravel使用的是127.0.0.1:80端口或者 project_dir.dev 域名，而热更新使用肯定是127.0.0.1:8080作为端口（端口可设置）所以造成了热资源无法读取&lt;/p>
&lt;p>坑三解决：&lt;/p>
&lt;p>    build/dev-client.js 设定绝对路径&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">build&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">js&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">hotClient&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;webpack-hot-middleware/client?noInfo=false&amp;amp;reload=true&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="err">改为&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">hotClient&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;webpack-hot-middleware/client?path=http://127.0.0.1:8080/__webpack_hmr&amp;amp;noInfo=false&amp;amp;reload=true&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>    热更新会自动使用 / 作为根地址，所以要将webpack的 publicPath地址设置为绝对路径。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// webpack.base.conf.js 原
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">publicPath: process.env.NODE_ENV === &amp;#39;production&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  ? config.build.assetsPublicPath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  : config.dev.assetsPublicPath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 改为
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">publicPath: process.env.NODE_ENV === &amp;#39;production&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  ? config.build.assetsPublicPath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  : &amp;#39;http://127.0.0.1:8080/&amp;#39; // 这里也可修改 config.dev.assetsPublicPath 对应的内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="坑四热更新跨域问题">坑四：热更新跨域问题。
&lt;/h2>&lt;p>坑四解决：&lt;/p>
&lt;p>    在build/dev-server.js中设置跨域头&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// build/dev-server.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 在生成app变量后
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 设置全局跨域
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">app.all(&amp;#39;*&amp;#39;, function(req, res, next) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    res.header(&amp;#34;Access-Control-Allow-Origin&amp;#34;, &amp;#34;*&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    res.header(&amp;#39;Access-Control-Allow-Methods&amp;#39;, &amp;#39;PUT, GET, POST, DELETE, OPTIONS&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    res.header(&amp;#34;Access-Control-Allow-Headers&amp;#34;, &amp;#34;X-Requested-With&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    res.header(&amp;#39;Access-Control-Allow-Headers&amp;#39;, &amp;#39;Content-Type&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    next();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="总结">总结：
&lt;/h1>&lt;p>写了这么多，发现全都是热更新的问题= =，不过搞定以上几点，对于laravel + vue 的前后端分离开发就很方便了，前端依然用自己的方式去开发，后端只提供一个入口index，剩下的都走API。&lt;/p>
&lt;h1 id="附录">附录：
&lt;/h1>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// index_dev.blade.php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;meta charset=&amp;#34;utf-8&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;title&amp;gt;首页&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;div id=&amp;#34;main-app&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;!-- built files will be auto injected --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;script src=&amp;#34;http://127.0.0.1:8080/vendor.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;script src=&amp;#34;http://127.0.0.1:8080/app.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;!-- 有新的内容请手动填写 --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// index_tpl.blade.php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;meta charset=&amp;#34;UTF-8&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;meta name=&amp;#34;viewport&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          content=&amp;#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;meta http-equiv=&amp;#34;X-UA-Compatible&amp;#34; content=&amp;#34;ie=edge&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;title&amp;gt;首页&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;div id=&amp;#34;main-app&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;!-- built files will be auto injected --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;lt;!-- 新内容将自动注入 --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【转】硅谷风投最青睐的 25 个开源项目</title><link>https://reatang.com/p/old-post-30/</link><pubDate>Wed, 16 Aug 2017 00:45:00 +0000</pubDate><guid>https://reatang.com/p/old-post-30/</guid><description>&lt;p>&lt;strong>THE BATTERY OPEN-SOURCE SOFTWARE INDEX&lt;strong>&lt;strong>排名&lt;/strong>&lt;/strong>项目名&lt;strong>&lt;strong>综合项目评分&lt;/strong>&lt;/strong>领域****相关公司&lt;/strong>1Linux100.00IT OperationsRed Hat, Ubuntu2Git31.10DevOpsGitHub, GitLab3MySQL25.23Data &amp;amp; AnalyticsOracle4Node.js22.75DevOpsNodeSource, Rising Stack5Docker22.61DevOpsDocker6Hadoop16.19Data &amp;amp; AnalyticsCloudera, Hortonworks7Elasticsearch15.72Data &amp;amp; AnalyticsElastic8Spark14.99Data &amp;amp; AnalyticsDatabricks9MongoDB14.68Data &amp;amp; AnalyticsMongoDB10Selenium12.81DevOpsSauce Labs, BrowserStack11NPM12.31DevOpsNPM12Redis11.61Data &amp;amp; AnalyticsRedis Labs13Tomcat11.04IT OperationsNA14Jenkins10.47DevOpsCloudBees15Vagrant8.15IT OperationsHashiCorp16Postgres8.02Data &amp;amp; AnalyticsEnterpriseDB17Gradle7.68DevOpsGradle18Nginx7.57IT OperationsNginx19Ansible7.42IT OperationsAnsible20Kafka7.22Data &amp;amp; AnalyticsConfluent21GitLab6.42DevOpsGitLab22Hbase6.41Data &amp;amp; AnalyticsCloudera, Hortonworks23Chef6.37IT OperationsChef*24TensorFlow5.97Data &amp;amp; AnalyticsGoogle25Cassandra5.74Data &amp;amp; AnalyticsDataStax&lt;/p>
&lt;p>转自：https://linux.cn/article-8759-1.html&lt;/p></description></item><item><title>【常用函数】Laravel SQL 日志转换为字符串 函数</title><link>https://reatang.com/p/old-post-29/</link><pubDate>Thu, 25 May 2017 18:10:54 +0000</pubDate><guid>https://reatang.com/p/old-post-29/</guid><description>&lt;p>Laravel的SQL日志是一个数组类型的内容&lt;/p>
&lt;p>格式大概是:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span>&lt;span class="n">sqlLogPayload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="s1">&amp;#39;query&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;sql语句&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="s1">&amp;#39;bindings&amp;#39;&lt;/span>&lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="s1">&amp;#39;参数A&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="s1">&amp;#39;参数B&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;0.23&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * SQL 日志转换为字符串
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  string $sql      SQL预处理
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  string $bindings 绑定的参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  string $time     执行时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return string           返回一个解析完成的sql （带时间）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function laravel_sql_parse($sql, $bindings, $time = null)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $bindings = array_map(function($bind){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        if ($bind instanceof \DateTime) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            $bind = $bind-&amp;gt;format(&amp;#39;Y-m-d H:i:s&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return is_numeric($bind) ? $bind : &amp;#34;&amp;#39;{$bind}&amp;#39;&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }, $bindings);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    array_unshift($bindings, str_replace([&amp;#39;%&amp;#39;, &amp;#39;?&amp;#39;], [&amp;#39;%%&amp;#39;, &amp;#39;%s&amp;#39;], $sql));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $sql_str = count($bindings) == 1 ? current($bindings) : call_user_func_array(&amp;#34;sprintf&amp;#34;, $bindings);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return $sql_str . ( is_null($time) ? &amp;#34;&amp;#34; : &amp;#34; [{$time}ms]&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>PHP扩展一览</title><link>https://reatang.com/p/old-post-28/</link><pubDate>Mon, 15 May 2017 11:40:03 +0000</pubDate><guid>https://reatang.com/p/old-post-28/</guid><description>&lt;p>小米是经常用到的PHP扩展库&lt;/p>
&lt;p>bcmath&lt;/p>
&lt;p>bz2&lt;/p>
&lt;p>calendar&lt;/p>
&lt;p>Core&lt;/p>
&lt;p>ctype&lt;/p>
&lt;p>curl&lt;/p>
&lt;p>date&lt;/p>
&lt;p>dba&lt;/p>
&lt;p>dom&lt;/p>
&lt;p>ereg&lt;/p>
&lt;p>exif&lt;/p>
&lt;p>fileinfo&lt;/p>
&lt;p>filter&lt;/p>
&lt;p>ftp&lt;/p>
&lt;p>gd&lt;/p>
&lt;p>gettext&lt;/p>
&lt;p>hash&lt;/p>
&lt;p>iconv&lt;/p>
&lt;p>igbinary&lt;/p>
&lt;p>json&lt;/p>
&lt;p>ldap&lt;/p>
&lt;p>libxml&lt;/p>
&lt;p>mbstring&lt;/p>
&lt;p>mcrypt&lt;/p>
&lt;p>mhash&lt;/p>
&lt;p>mysql&lt;/p>
&lt;p>mysqli&lt;/p>
&lt;p>mysqlnd&lt;/p>
&lt;p>odbc&lt;/p>
&lt;p>openssl&lt;/p>
&lt;p>pcntl&lt;/p>
&lt;p>pcre&lt;/p>
&lt;p>PDO&lt;/p>
&lt;p>pdo_mysql&lt;/p>
&lt;p>PDO_ODBC&lt;/p>
&lt;p>pdo_sqlite&lt;/p>
&lt;p>Phar&lt;/p>
&lt;p>posix&lt;/p>
&lt;p>protobuf&lt;/p>
&lt;p>readline&lt;/p>
&lt;p>redis&lt;/p>
&lt;p>Reflection&lt;/p>
&lt;p>session&lt;/p>
&lt;p>shmop&lt;/p>
&lt;p>SimpleXML&lt;/p>
&lt;p>soap&lt;/p>
&lt;p>sockets&lt;/p>
&lt;p>SPL&lt;/p>
&lt;p>sqlite3&lt;/p>
&lt;p>standard&lt;/p>
&lt;p>swoole&lt;/p>
&lt;p>sysvmsg&lt;/p>
&lt;p>sysvsem&lt;/p>
&lt;p>sysvshm&lt;/p>
&lt;p>tokenizer&lt;/p>
&lt;p>wddx&lt;/p>
&lt;p>xml&lt;/p>
&lt;p>xmlreader&lt;/p>
&lt;p>xmlrpc&lt;/p>
&lt;p>xmlwriter&lt;/p>
&lt;p>xsl&lt;/p>
&lt;p>yaf&lt;/p>
&lt;p>yar&lt;/p>
&lt;p>Zend OPcache&lt;/p>
&lt;p>zip&lt;/p>
&lt;p>zlib&lt;/p>
&lt;p>zmq&lt;/p></description></item><item><title>【常用函数】最简单的模板引擎，摘自Laravel</title><link>https://reatang.com/p/old-post-27/</link><pubDate>Wed, 10 May 2017 10:54:36 +0000</pubDate><guid>https://reatang.com/p/old-post-27/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">function view($__path, $__data)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $obLevel = ob_get_level();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    ob_start();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    extract($__data);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    try {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        include $__path;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } catch (Exception $e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        while (ob_get_level() &amp;gt; $obLevel) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            ob_end_clean();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        throw $e;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return ltrim(ob_get_clean());
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>firefly-php(萤火虫PHP)</title><link>https://reatang.com/p/old-post-26/</link><pubDate>Sat, 01 Apr 2017 19:29:56 +0000</pubDate><guid>https://reatang.com/p/old-post-26/</guid><description>&lt;p>准备新做一个组件库，主打应用层流行的通讯协议、web即时通信、异构系统互联方面的功能&lt;/p>
&lt;p>EventSource &lt;a class="link" href="https://github.com/reatang/php-eventsource" target="_blank" rel="noopener"
>GitHub&lt;/a>&lt;/p></description></item><item><title>数据库的四个隔离级别</title><link>https://reatang.com/p/old-post-25/</link><pubDate>Thu, 30 Mar 2017 14:47:14 +0000</pubDate><guid>https://reatang.com/p/old-post-25/</guid><description>&lt;h2 id="零没有并发控制">（零）没有并发控制
&lt;/h2>&lt;p>&lt;strong>存在的问题：更新遗失&lt;/strong>。&lt;/p>
&lt;p>&lt;strong>解决办法就是下面的“可读取未确认”。&lt;/strong>&lt;/p>
&lt;h2 id="一可读取未确认read-uncommitted">（一）可读取未确认（Read uncommitted）
&lt;/h2>&lt;p>写事务阻止其他写事务，避免了 &lt;strong>更新遗失&lt;/strong>。但是没有阻止其他读事务。&lt;/p>
&lt;p>&lt;strong>存在的问题：脏读&lt;/strong>。即读取到不正确的数据，因为另一个事务可能还没提交最终数据，这个读事务就读取了中途的数据，这个数据可能是不正确的。&lt;/p>
&lt;p>&lt;strong>解决办法就是下面的“可读取确认”。&lt;/strong>&lt;/p>
&lt;h2 id="二可读取确认read-committed">（二）可读取确认（Read committed）
&lt;/h2>&lt;p>写事务会阻止其他读写事务。读事务不会阻止其他任何事务。&lt;/p>
&lt;p>&lt;strong>存在的问题：不可重复读&lt;/strong>。即在一次事务之间，进行了两次读取，但是结果不一样，可能第一次id为1的人叫“李三”，第二次读id为1的人就叫了“李四”。因为读取操作不会阻止其他事务。&lt;/p>
&lt;p>&lt;strong>解决办法就是下面的“可重复读”。&lt;/strong>&lt;/p>
&lt;h2 id="三可重复读repeatable-read">（三）可重复读（Repeatable read）
&lt;/h2>&lt;p>读事务会阻止其他写事务，但是不会阻止其他读事务。&lt;/p>
&lt;p>&lt;strong>存在的问题：幻读&lt;/strong>。可重复读阻止的写事务包括update和delete（只给存在的表加上了锁），但是不包括insert（新行不存在，所以没有办法加锁），所以一个事务第一次读取可能读取到了10条记录，但是第二次可能读取到11条，这就是幻读。&lt;/p>
&lt;p>&lt;strong>解决办法就是下面的“串行化”。&lt;/strong>&lt;/p>
&lt;h2 id="四可串行化serializable">（四）可串行化（Serializable）
&lt;/h2>&lt;p>读加共享锁，写加排他锁。这样读取事务可以并发，但是读写，写写事务之间都是互斥的，基本上就是一个个执行事务，所以叫串行化。&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703301490856450805314.png"
loading="lazy"
alt="blob.png"
>&lt;/p>
&lt;p>隔离级别与并发性能的关系：&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703301490856507399698.png"
loading="lazy"
alt="blob.png"
>&lt;/p>
&lt;p>设置隔离级别的原则：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>对于多数应用程序，可以优先考虑把数据库系统的隔离级别设为Read Committed，它能够避免脏读，而且具有较好的并发性能。尽管它会导致不可重复读、虚读。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>和第二类丢失更新这些并发问题，在可能出现这类问题的个别场合，可以由应用程序采用悲观锁或乐观锁来控制。&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>软件工程中的粒度</title><link>https://reatang.com/p/old-post-24/</link><pubDate>Thu, 30 Mar 2017 14:22:29 +0000</pubDate><guid>https://reatang.com/p/old-post-24/</guid><description>&lt;p>粒度是在一个体系（系统）中的最小单位的衡量。&lt;/p>
&lt;p>在编程开发中粒度从小到大可以扩展为：&lt;/p>
&lt;p>一个表达式 -&amp;gt; 一行代码 -&amp;gt; 一个函数 -&amp;gt; 一个模块 -&amp;gt; 一个组件 -&amp;gt; 一个系统 -&amp;gt; 一个分布式系统 -&amp;gt; 一个平台 -&amp;gt; 一个云&lt;/p>
&lt;p>在编程思想中粒度可以扩展为：&lt;/p>
&lt;p>过程 -&amp;gt; 结构/函数FP -&amp;gt; 面向对象OOP -&amp;gt; 面向服务SOA -&amp;gt; 面向切面AOP -&amp;gt; 面向领域DDD&lt;/p></description></item><item><title>我是这么理解协程yield异步IO的</title><link>https://reatang.com/p/old-post-23/</link><pubDate>Thu, 30 Mar 2017 11:30:42 +0000</pubDate><guid>https://reatang.com/p/old-post-23/</guid><description>&lt;p>今天又仔仔细细的研究了一下鸟哥写的yield的文章： &lt;a class="link" href="http://www.laruence.com/2015/05/28/3038.html" target="_blank" rel="noopener"
>传送门&lt;/a>&lt;/p>
&lt;p>突然对yield的作用明晰了。&lt;/p>
&lt;p>就像很多人说的 yield 其实就是实现一种以同步方式写异步代码的功能，写了这么多年PHP，完全不清楚这个到底是啥意思。不过看完这篇文章算是懂了。&lt;/p>
&lt;p>一般的PHP代码（类似于同步IO）：&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703301490844988786421.jpg"
loading="lazy"
alt="1.jpg"
>&lt;/p>
&lt;p>PHP完全以同步的方式在处理 从 【PHP处理】 -&amp;gt; 【处理完成】的这个过程。因为毕竟一次处理一个请求。&lt;/p>
&lt;p>如果使用yield就完全不一样了（首先我们就不能用php-fpm了），php需要自己控制处理所有socket才能达到真异步。&lt;/p>
&lt;p>例，一个业务逻辑(普通的)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$data = DB::select();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$respA = $httpClient-&amp;gt;post($uri, $data);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if ($respA[&amp;#39;code&amp;#39;] == 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $id = DB::insert($respA[&amp;#39;data&amp;#39;]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $respB = $httpClient-&amp;gt;post($uri, [&amp;#39;some_id&amp;#39; =&amp;gt; $id]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">return response()-&amp;gt;ok();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果我们用yield：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$data = yield AsyncDB::select();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$respA = yield $AsyncHttpClient-&amp;gt;post($uri, $data);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if ($respA[&amp;#39;code&amp;#39;] == 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $id = yield AsyncDB::insert($respA[&amp;#39;data&amp;#39;]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $respB = yield $AsyncHttpClient-&amp;gt;post($uri, [&amp;#39;some_id&amp;#39; =&amp;gt; $id]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">return response()-&amp;gt;ok();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>之前我一直很困惑，这么写有什么用呢？看了很多文章，甚至写了很多例子，都发现IO依然是同步的。&lt;/p>
&lt;p>这是因为，我们想用到真正的yield的功能就要整个环境（框架）都支持它。&lt;/p>
&lt;p>OK，详细来描述一下这段业务逻辑背后的事情：&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703301490845963582602.jpg"
loading="lazy"
alt="2.jpg"
>&lt;/p>
&lt;p>上图只是说一次请求。&lt;/p>
&lt;p>IO任务调度器是全局的，我们有成千上万个这种请求在处理：&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703301490846535355281.jpg"
loading="lazy"
alt="3.jpg"
>&lt;/p>
&lt;p>IO任务调度器的设计就像是epoll 或者 select 一样，非阻塞（同步或者异步）。只要有IO完成了，协程就会返回到这个IO当时yield的地方，继续执行（就像设置断点一样）。&lt;/p>
&lt;p>最后总结：&lt;/p>
&lt;p>在有协程的框架设计中任务调度器的设计就是提高程序性能的关键，假如普通的同步请求一个单位时间处理1一个请求，那么这种yeild协程就是看机器的性能了。&lt;/p></description></item><item><title>php优雅的获取大量的参数——位掩码</title><link>https://reatang.com/p/old-post-22/</link><pubDate>Thu, 23 Mar 2017 10:27:58 +0000</pubDate><guid>https://reatang.com/p/old-post-22/</guid><description>&lt;p>对函数内部进行参数设置是在编码中经常遇见的一个设计问题，一般情况下，我们会有三种方式。&lt;/p>
&lt;h3 id="12b程序员没错这就是我经常用的那种">1、2B程序员（没错这就是我经常用的那种）
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">function a_func($option1, $option2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($option1) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($option2) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2普通程序员">2、普通程序员
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">function b_func($options)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($options[&amp;#39;a&amp;#39;]) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($options[&amp;#39;b&amp;#39;]) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //some code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3文艺的程序员">3、文艺的程序员
&lt;/h3>&lt;p>没错，今儿我就是要讲讲怎么个文艺法.&lt;/p>
&lt;h4 id="31对比一下">3.1、对比一下
&lt;/h4>&lt;p>作为php程序员json_encode 这个函数肯定是再了解不过了，可是大家了解这个函数的第二个参数吗？&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">//像这样
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$data_str = json_encode($a, JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP | JSON_UNESCAPED_UNICODE);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>从 &lt;a class="link" href="http://php.net/manual/zh/function.json-encode.php" target="_blank" rel="noopener"
>json_encode()&lt;/a> 的文档中，我们能得知第二参数的各个选项会对输出来的json字符串有不同的解析方式。&lt;/p>
&lt;p>对比一下1和2的用法：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">a_func(true, false) // 如果不知道函数原型的话根本不知道在干什么。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">b_func([&amp;#39;a&amp;#39; =&amp;gt; true, &amp;#39;b&amp;#39; =&amp;gt; false]) // 如果是第三方用的话不一定知道还有a和b两个参数，还得去源码中找。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="32我们如何文艺的设计这样的函数">3.2、我们如何文艺的设计这样的函数
&lt;/h4>&lt;p>以我用laravel这么多年的经验来看，内部设计的越精巧复杂，外部用起来就越简单明了。没错，用这种文艺的方法，也会有点复杂。&lt;/p>
&lt;p>首先，设计一个解析函数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 解析按位输入的参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  int $options     用户选择的参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  int $all_options 所有参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  int $default     默认值
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return int 解析后的内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function __parse_bitwise_params($options, $all_options, $default = 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return $all_options &amp;amp; $options ?: $default;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>看看使用场景：&lt;/p>
&lt;p>假如一个用户模块，我们想获取用户的信息，那么其实我们可以这样写&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">用户模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="n">UserModule&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_RAW&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_STR&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_ARRAY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">var&lt;/span> &lt;span class="n">User&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">public&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">getInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">INFO_RAW&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">__parse_bitwise_params&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_RAW&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_STR&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_ARRAY&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">switch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_RAW&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_STR&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_ARRAY&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">toArray&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>看到这，各位看官会问了，这不是拖了裤子**嘛！明明传一个数字进来就OK了.&lt;/p>
&lt;p>这个问题问的好，因为这种优(wen)雅(yi)的方式肯定不是用于传一种参数的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">用户模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="n">UserModule&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_RAW&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_STR&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_ARRAY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_MSG_ID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_MSG_BASE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">const&lt;/span> &lt;span class="n">USER_MSG_ALL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">var&lt;/span> &lt;span class="n">User&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">     &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">protected&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">public&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">getInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">INFO_RAW&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">msg_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">__parse_bitwise_params&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_MSG_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_MSG_BASE&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_MSG_ALL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">msg_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_MSG_ID&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">__parse_bitwise_params&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_RAW&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_STR&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_ARRAY&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="o">$&lt;/span>&lt;span class="n">get_user_msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">USER_MSG_BASE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="n">array_only&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">toArray&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">user_name&lt;/span>&lt;span class="s1">&amp;#39;, &amp;#39;&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="s1">&amp;#39;]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">toArray&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="k">switch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">INFO_RAW&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">INFO_STR&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="n">json_encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">get_user_msg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">msg_type&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="k">case&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">INFO_ARRAY&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">get_user_msg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">msg_type&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &lt;span class="k">return&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这才是为师的完全体！（不要吐槽那个匿名函数，只是想一个函数写完得了&amp;hellip;.）&lt;/p>
&lt;p>没错，这种写法就是用来传多个参数设计的，那么如果我们使用了这种方案设计代码，外部的调用将会很简单。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">//获取user_id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$user_id = $userModule-&amp;gt;getInfo(UserModule::INFO_MSG_ID);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//获取User模型
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$user = $userModule-&amp;gt;getInfo(UserModule::INFO_RAW);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//获取用户的信息数组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$user = $userModule-&amp;gt;getInfo(UserModule::USER_ARRAY);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//获取用户的基本数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$user_base = $userModule-&amp;gt;getInfo(UserModule::USER_ARRAY | UserModule::USER_MSG_BASE);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="总结">总结：
&lt;/h3>&lt;p>对于这种模块的设计，这种方案不一定是最好的，因为设计代码的方式千千万，这只是一块砖，希望能对大家的代码设计带来新的灵感。&lt;/p>
&lt;p>原创文章，转载请注明出处链接。&lt;/p></description></item><item><title>【常用函数】php 身份证有效性验证函数 check_idcard()</title><link>https://reatang.com/p/old-post-21/</link><pubDate>Wed, 22 Mar 2017 18:50:04 +0000</pubDate><guid>https://reatang.com/p/old-post-21/</guid><description>&lt;p>帮助函数&lt;/p>
&lt;p>验证18位身份证的校验位&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 身份证验证
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param $id_card
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return bool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function check_id_card($id_card)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $id_card = strtoupper($id_card);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    //验证有效性
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $pattern = &amp;#39;/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $passed = preg_match($pattern, $id_card);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if ($passed == 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return (bool) $passed;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (strlen($id_card) == 15) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    //验证校验位
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $a = str_split($id_card, 1);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $w = array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $c = array(1, 0, &amp;#39;X&amp;#39;,  9, 8, 7, 6, 5, 4, 3, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $sum = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    for ($i = 0; $i &amp;lt; 17; $i++) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $sum += $a[$i] * $w[$i];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return $c[$sum % 11] == $a[17];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【常用函数】php 身份证信息分析函数 idcard_msg()</title><link>https://reatang.com/p/old-post-20/</link><pubDate>Wed, 22 Mar 2017 18:48:57 +0000</pubDate><guid>https://reatang.com/p/old-post-20/</guid><description>&lt;p>帮助函数&lt;/p>
&lt;p>分析身份证的：省、市、区、生日、性别&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 身份证信息获取
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param string $idcard_no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return array
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function idcard_msg($idcard_no)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $province = substr($idcard_no, 0, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $city = substr($idcard_no, 2, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $district = substr($idcard_no, 4, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (strlen($idcard_no) == 15) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $year = &amp;#39;19&amp;#39; . substr($idcard_no, 6, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $month = substr($idcard_no, 8, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $day = substr($idcard_no, 10, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $sex_num = substr($idcard_no, 14, 1);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $year = substr($idcard_no, 6, 4);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $month = substr($idcard_no, 10, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $day = substr($idcard_no, 12, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $sex_num = substr($idcard_no, 16, 1);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $birthday = &amp;#34;{$year}-{$month}-{$day}&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $sex = $sex_num % 2 == 1 ? &amp;#39;男&amp;#39; : &amp;#39;女&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return compact(&amp;#39;province&amp;#39;, &amp;#39;city&amp;#39;, &amp;#39;district&amp;#39;, &amp;#39;birthday&amp;#39;, &amp;#39;sex&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【常用函数】将php数组写入文件array_into_file(),可直接用inlcude读取</title><link>https://reatang.com/p/old-post-19/</link><pubDate>Wed, 22 Mar 2017 18:46:56 +0000</pubDate><guid>https://reatang.com/p/old-post-19/</guid><description>&lt;p>帮助函数&lt;/p>
&lt;p>将php的数组解析为一个可inculde的php文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">/**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">将数据输出到文件中&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="err">并可直接&lt;/span>&lt;span class="n">include引入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">param&lt;/span> &lt;span class="n">array&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">input&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="n">param&lt;/span>       &lt;span class="o">$&lt;/span>&lt;span class="n">file_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="ne">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function&lt;/span> &lt;span class="n">array_into_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">array&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="k">return&lt;/span> &lt;span class="n">file_put_contents&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;lt;?php&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">return &amp;#34;&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="n">var_export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">.&lt;/span> &lt;span class="s2">&amp;#34;;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>mysql 5.7 unknown variable 'log_slow_queries=/var/log/mysql/mysql-slow.log'</title><link>https://reatang.com/p/old-post-18/</link><pubDate>Mon, 20 Mar 2017 00:16:01 +0000</pubDate><guid>https://reatang.com/p/old-post-18/</guid><description>&lt;p>unknown variable &amp;rsquo;log_slow_queries=/var/log/mysql/mysql-slow.log'&lt;/p>
&lt;p># mysql5.6版本以上，取消了参数log-slow-queries，更改为slow-query-log-file&lt;/p>
&lt;p># 还需要加上 slow_query_log = on 否则，还是没用&lt;/p>
&lt;p>#log-slow-queries = /var/log/mysql/mysql-slow.log&lt;/p>
&lt;p>slow_query_log = on&lt;/p>
&lt;p>slow-query-log-file = /var/log/mysql/mysql-slow.log&lt;/p>
&lt;p>long_query_time = 2&lt;/p></description></item><item><title>Linux进程间通信——无名管道</title><link>https://reatang.com/p/old-post-17/</link><pubDate>Sat, 18 Mar 2017 13:50:17 +0000</pubDate><guid>https://reatang.com/p/old-post-17/</guid><description>&lt;p>每个进程各自有不同的用户地址空间，任何一个进程的全局变量在另一个进程中都看不到，所以进程之间要交换数据必须通过内核，在内核中开辟一块缓冲 区，进程1把数据从用户空间拷到内核缓冲区，进程2再从内核缓冲区把数据读走，内核提供的这种机制称为进程间通信（IPC，InterProcess Communication）.&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703181489816856455809.jpg"
loading="lazy"
alt="pipe.jpg"
>&lt;/p>
&lt;p>无名管道PIPE只适用于父子进程间的通信,还有一种叫做有名管道FIFO.&lt;/p>
&lt;p>PIPE是Linux进程间通信方法之一,它是一个单向通道,先进先出,管道的尾端为写端,描述符pipe_fd[1] . 头部为读端,描述符为pipe_fd[0](注意,强制规定).&lt;/p>
&lt;p>主要函数:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">int pipe(int pipe_fd[2])
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>调用pipe函数在内核中开辟一块缓冲区(称为管道)用于单向通信,它有一个读端一个写端,然后通过filedes参数传给用户程序两个文件描述符,filedes[0]指&lt;/p>
&lt;p>向PIPE的读端,filedes[1]指向PIPE的写端。所以在用户程序看起来就像一个打开的文件,通过read(filedes[0]);或者write(filedes[1]); 向这个文件读写数据&lt;/p>
&lt;p>其实是在读写内核缓冲区.&lt;/p>
&lt;p>创建无名管道步骤：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>父进程调用pipe(int pipe_fd[2])函数,创建管道并得到两个文件描述符,分别指向管道的头部和尾部,也就是读端和写端&lt;/p>
&lt;/li>
&lt;li>
&lt;p>父进程调用fork()函数创建子进程,因为fork()函数,子进程拷贝父进程的数据段和代码段,所以子进程也能得到第一步创建的两个文件描述符,且指向同一个管道&lt;/p>
&lt;/li>
&lt;li>
&lt;p>父进程关闭管道的读端,子进程关闭管道的写端&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#include&amp;lt;stdio.h&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#include&amp;lt;stdlib.h&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#include&amp;lt;unistd.h&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#include&amp;lt;sys/wait.h&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#include&amp;lt;string.h&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int main()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    char buf[20];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    pid_t pid;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    int pipe_fd[2];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    pipe(pipe_fd); //创建管道
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if ((pid = fork()) &amp;lt; 0) //fork子进程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        perror(&amp;#34;fork error&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        exit(-1);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else if (pid == 0) //子进程中
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        close(pipe_fd[1]); //关闭写端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep(1);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        read(pipe_fd[0],buf,sizeof(buf));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        printf(&amp;#34;%s&amp;#34;,buf);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        close(pipe_fd[0]); //关闭读端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        exit(0); //正常退出
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else //父进程中
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        close(pipe_fd[0]); //关闭读端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        write(pipe_fd[1],&amp;#34;hello world&amp;#34;,strlen(&amp;#34;hello world&amp;#34;));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        close(pipe_fd[1]); //关闭写端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        waitpid(pid,NULL,0); //等待子进程结束或中断,参数1为欲等待的子进程的标识码,参数2为
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      //子进程结束的状态值一般为NULL,参数3为等待何种子进程,为0时表示等待进程组识别码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      //与目前进程相同的任务子进程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        exit(0);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>图解：&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703181489817059353644.png"
loading="lazy"
alt="blob.png"
>&lt;/p>
&lt;p>来自： &lt;a class="link" href="http://blog.csdn.net/my9074/article/details/42919647" target="_blank" rel="noopener"
>http://blog.csdn.net/my9074/article/details/42919647&lt;/a>&lt;/p></description></item><item><title>【转】图解开源协议</title><link>https://reatang.com/p/old-post-16/</link><pubDate>Thu, 16 Mar 2017 18:05:02 +0000</pubDate><guid>https://reatang.com/p/old-post-16/</guid><description>&lt;p>一张图解释该如何选择开源协议&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703161489658713772443.png"
loading="lazy"
alt="blob.png"
>&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/09/201709261506394750543700.jpg"
loading="lazy"
alt="v2-75cc113af5ea0909e05dbbd8a2b22736_r.jpg"
>&lt;/p></description></item><item><title>震惊！php还能这么玩！如何与可交互的程序进行交互</title><link>https://reatang.com/p/old-post-15/</link><pubDate>Tue, 07 Mar 2017 18:52:49 +0000</pubDate><guid>https://reatang.com/p/old-post-15/</guid><description>&lt;p>今天有幸看到一篇 &lt;a class="link" href="http://blog.csdn.net/lufubo/article/details/7627393" target="_blank" rel="noopener"
>shell中交互输入自动化&lt;/a> 的文章，对于SDTIN的理解好像是又加深了一层&lt;/p>
&lt;p>然后尝试用PHP来实现，果然是可以的，简直棒棒的。&lt;/p>
&lt;p>祭出代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;?php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 与shell程序使用管道进行交互
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//定义要开启的管道
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$descriptorspec = array(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   0 =&amp;gt; array(&amp;#34;pipe&amp;#34;, &amp;#34;r&amp;#34;),  // 标准输入，子进程从此管道中读取数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   1 =&amp;gt; array(&amp;#34;pipe&amp;#34;, &amp;#34;w&amp;#34;),  // 标准输出，子进程向此管道中写入数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   2 =&amp;gt; array(&amp;#34;file&amp;#34;, &amp;#34;./error-output.txt&amp;#34;, &amp;#34;a&amp;#34;) // 标准错误，写入到一个文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//读入要生成的文件名
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if (!isset($argv[1])) {exit(&amp;#39;请输入秘钥文件名！&amp;#39;);}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$key_name = $argv[1];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$params =&amp;lt;&amp;lt;&amp;lt;PARAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Beijing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beijing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rea .Ltd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">technology section
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reatang.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">admin@reatang.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PARAM;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//打开进程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$process = proc_open(&amp;#34;openssl req -new -newkey rsa:2048 -nodes -keyout {$key_name}.key -out {$key_name}.csr&amp;#34;, $descriptorspec, $pipes, __DIR__);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if (is_resource($process)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    //与进程进行交互
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    fwrite($pipes[0], $params);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    fclose($pipes[0]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    //交互完成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    echo stream_get_contents($pipes[1]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    fclose($pipes[1]);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $return_value = proc_close($process);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    echo &amp;#34;command returned $return_value\n&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就自动完成了和命令的交互！OMG简直赞！还是我的基础功夫不扎实呀，之前学习给网站加证书的时候就在想如何能自动生成CSR文件，现在OK了！！&lt;/p>
&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/03/201703071488884004308667.png"
loading="lazy"
alt="blob.png"
>&lt;/p></description></item><item><title>php把秒数转换为可读的时间函数 sec2date()</title><link>https://reatang.com/p/old-post-14/</link><pubDate>Tue, 28 Feb 2017 18:18:00 +0000</pubDate><guid>https://reatang.com/p/old-post-14/</guid><description>&lt;p>就是一个把秒数 转换为 天:时:分:秒 格式 而已啦&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 把秒数转换为时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param int    $sec      秒数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param string $format   格式化
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param bool   $zero_pad
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return mixed|string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function sec2date($sec, $format = &amp;#34;:D天:H小时:M分钟:S秒&amp;#34;, $zero_pad = false)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (!is_numeric($sec)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $days = floor($sec / 86400);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $tmp = $sec - ($days * 86400);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $hours = floor($tmp / 3600);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $tmp2 = $tmp - ($hours * 3600);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $minute = floor($tmp2 / 60);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $second =  $tmp2 - ($minute * 60);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $fmt = array(&amp;#39;:D&amp;#39; =&amp;gt; $days,&amp;#39;:H&amp;#39; =&amp;gt; $hours,&amp;#39;:M&amp;#39; =&amp;gt; $minute,&amp;#39;:S&amp;#39; =&amp;gt; $second);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if ($zero_pad === true) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $fmt = array_map(function($val){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            return str_pad($val, 2, STR_PAD_LEFT);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }, $fmt);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    $output = str_replace(array_keys($fmt), array_values($fmt), $format);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    return $output;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>composer 依赖错误会下载较高版本的组件</title><link>https://reatang.com/p/old-post-13/</link><pubDate>Fri, 17 Feb 2017 17:26:24 +0000</pubDate><guid>https://reatang.com/p/old-post-13/</guid><description>&lt;p>composer国内源有bug 会导致部分依赖包下载错误。&lt;/p>
&lt;p>比如 &amp;ldquo;jenssegers/mongodb&amp;rdquo;: &amp;ldquo;3.1.*&amp;rdquo; 组件支持 laravel ^5.1 相当于支持 大于 5.1的各个版本。可是laravel自己可不支持各个版本。导致主框架用的是5.1 可是被下载了5.4的组件，项目无法运行。&lt;/p>
&lt;p>如果出现组件下载后报bug的问题，可切换到国外源再进行安装。&lt;/p>
&lt;p>感觉国外源太慢，而且不会翻墙的，请将国内源：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{&amp;#34;type&amp;#34;: &amp;#34;composer&amp;#34;, &amp;#34;url&amp;#34;: &amp;#34;https://packagist.phpcomposer.com&amp;#34;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>改为：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{&amp;#34;type&amp;#34;: &amp;#34;composer&amp;#34;, &amp;#34;url&amp;#34;: &amp;#34;http://pkg.overtrue.me&amp;#34;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>并执行命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt; composer config --global secure-http false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>从本地下载的box 安装vagrant box.</title><link>https://reatang.com/p/old-post-12/</link><pubDate>Sat, 11 Feb 2017 15:57:00 +0000</pubDate><guid>https://reatang.com/p/old-post-12/</guid><description>&lt;p>因为中国的网络原因，需要使用vargant的时候，先会把box文件用一些工具下载下来，然后进行本地安装。&lt;/p>
&lt;p>那么下载完成后，把box添加到vagrant中就是一件比较麻烦的事情了。&lt;/p>
&lt;p>从vagrant的文档中可以找到一个快速配置本地box的方法 &lt;a class="link" href="https://www.vagrantup.com/docs/boxes/format.html" target="_blank" rel="noopener"
>&amp;raquo;传送门&lt;/a>，可以自定义box的metadata来添加box。&lt;/p>
&lt;p>这里用laravel/homestead做例子。&lt;/p>
&lt;h2 id="1准备工作">1、准备工作
&lt;/h2>&lt;p>首先我们当然要把box文件下载下来。（假设已下载，文件是 /User/my/downloads/homestead_virtualbox_1.1.0.box）&lt;/p>
&lt;p>然后创建一个文件：metadata.json&lt;/p>
&lt;p>文件内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;laravel/homestead&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="s2">&amp;#34;description&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;laravel develop environment Ubuntu 16.04 LTS 64-bit and PHP71.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="s2">&amp;#34;versions&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="s2">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1.1.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="s2">&amp;#34;providers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;virtualbox&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          &lt;span class="s2">&amp;#34;url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/User/my/downloads/omestead_virtualbox_1.1.0.box&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          &lt;span class="s2">&amp;#34;checksum_type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;sha1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">          &lt;span class="s2">&amp;#34;checksum&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;298107a16521fd379e39a70187722fb4dc3b6880&amp;#34;&lt;/span> &lt;span class="c1">#这个值可以用命令自己算一下，要不然没法通过验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">      &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="2添加到vagrant">2、添加到vagrant
&lt;/h2>&lt;p>然后运行命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt;vagrant box add metadata.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就可以把box添加到vagrant中了&lt;/p>
&lt;h2 id="3启动homestead">3、启动homestead
&lt;/h2>&lt;p>克隆homestead到本地：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt;git clone git@github.com:laravel/homestead.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>跳转到目录下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt;cd homestead
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动homestead：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt;vagrant up
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置登录：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">alias vm=&amp;#34;ssh vagrant@127.0.0.1 -p 2222&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#然后用vm登录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; vm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>剩下的就看laravel/homestead的教程吧~ &lt;a class="link" href="https://github.com/laravel/homestead/" target="_blank" rel="noopener"
>&amp;raquo;传送门&lt;/a>&lt;/p></description></item><item><title>解决json_encode中文会编码为unicode，兼容php5.4之前的版本</title><link>https://reatang.com/p/old-post-11/</link><pubDate>Mon, 06 Feb 2017 14:23:17 +0000</pubDate><guid>https://reatang.com/p/old-post-11/</guid><description>&lt;p>编码后也可以正确的用json_decode进行解码&lt;/p>
&lt;p>&lt;strong>1、使用正则&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 解决json_encode的中文兼容问题（虽然看似兼容5.2不过没测试过）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  array|stdClass $value 被编码的数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return 编码为json字符串的数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function json_encode_unescaped_unicode($value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    static $callback;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (version_compare(PHP_VERSION, &amp;#39;5.4.0&amp;#39;, &amp;#39;&amp;lt;&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        if (!is_callable($callback)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            $callback = create_function(&amp;#39;$matchs&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &amp;#39;return iconv(\&amp;#39;UCS-2BE\&amp;#39;, \&amp;#39;UTF-8\&amp;#39;, pack(\&amp;#39;H4\&amp;#39;, $matchs[1]));&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $str = json_encode($value);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $str = preg_replace_callback(&amp;#34;#\\\u([0-9a-f]{4})#i&amp;#34;, $callback, $str);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return $str;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return json_encode($value, JSON_UNESCAPED_UNICODE);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>性能测试（环境：MACBOOKPRO 13 2015款）&lt;/p>
&lt;p>代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;?php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">////////////////////////////////////////////////////////////////
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/// 解决 5.4以下的encode中文没有 JSON_UNESCAPED_UNICODE 选项的问题
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">////////////////////////////////////////////////////////////////
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$num = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$count = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$time = microtime(true);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function my_log()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    global $count, $time, $num;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (microtime(true) - $time &amp;gt;= 1) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        printf(&amp;#34;次数:%d\n&amp;#34;, $count);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $count = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $time = microtime(true);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $num++;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">register_tick_function(&amp;#39;my_log&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 解决json_encode的中文兼容问题（虽然看似兼容5.2不过没测试过）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @param  array|stdClass $value 被编码的数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @return 编码为json字符串的数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function json_encode_unescaped_unicode($value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    static $callback;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (version_compare(PHP_VERSION, &amp;#39;5.4.0&amp;#39;, &amp;#39;&amp;lt;&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        if (!is_callable($callback)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            $callback = create_function(&amp;#39;$matchs&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                &amp;#39;return iconv(\&amp;#39;UCS-2BE\&amp;#39;, \&amp;#39;UTF-8\&amp;#39;, pack(\&amp;#39;H4\&amp;#39;, $matchs[1]));&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $str = json_encode($value);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $str = preg_replace_callback(&amp;#34;#\\\u([0-9a-f]{4})#i&amp;#34;, $callback, $str);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return $str;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return json_encode($value, JSON_UNESCAPED_UNICODE);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$data = array(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;#39;qwe&amp;#39; =&amp;gt; &amp;#39;你好世界&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &amp;#39;asd&amp;#39; =&amp;gt; array(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &amp;#39;神奇了&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        &amp;#39;zxc&amp;#39; =&amp;gt; array(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            &amp;#39;s&amp;#39; =&amp;gt; &amp;#39;那么再深一点&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        )
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    )
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">declare(ticks = 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    while ($num &amp;lt; 10) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        json_encode_unescaped_unicode($data);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        $count++;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>php5.3：（每秒encode次数）&lt;/p>
&lt;p>次数:39405&lt;/p>
&lt;p>次数:39829&lt;/p>
&lt;p>次数:40229&lt;/p>
&lt;p>次数:40300&lt;/p>
&lt;p>次数:40425&lt;/p>
&lt;p>次数:41298&lt;/p>
&lt;p>次数:38226&lt;/p>
&lt;p>次数:40405&lt;/p>
&lt;p>次数:40758&lt;/p>
&lt;p>次数:39853&lt;/p>
&lt;p>php5.6：(每秒encode次数)&lt;/p>
&lt;p>次数:380351&lt;/p>
&lt;p>次数:376383&lt;/p>
&lt;p>次数:384623&lt;/p>
&lt;p>次数:385797&lt;/p>
&lt;p>次数:381795&lt;/p>
&lt;p>次数:374920&lt;/p>
&lt;p>次数:366855&lt;/p>
&lt;p>次数:380634&lt;/p>
&lt;p>次数:373909&lt;/p>
&lt;p>次数:379061&lt;/p>
&lt;p>性能上的差异肯定是有的毕竟又用正则又用iconv的。&lt;/p>
&lt;p>从测试上看，9倍左右的差距应该还包含php5.6本身就比5.3快的原因。&lt;/p>
&lt;p>不过这个差距是有点大，那么还是赶紧升级php5.6吧，现在的大趋势都是7.1了，还在用老款干啥呀，各种新特性高性能在等着各位phper！（跑题了）&lt;/p>
&lt;p>&lt;strong>2、先用urlencode编码中文，在json_encode之后再用urldecode转换回来&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">function json_encode_unescaped_unicode($value, $is_deep = false)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    if (version_compare(PHP_VERSION, &amp;#39;5.4.0&amp;#39;, &amp;#39;&amp;lt;&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        foreach ($value as $k =&amp;gt; &amp;amp;$v) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            if (is_string($v)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $v = urlencode($v);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            } else if (is_array($v)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">                $v = json_encode_unescaped_unicode($v, true);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">            }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return $is_deep ? $value : urldecode(json_encode($value));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">        return json_encode($value, JSON_UNESCAPED_UNICODE);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>同样的测试，这个性能没高多少，而且还带着个递归&lt;/p>
&lt;p>php5.3：&lt;/p>
&lt;p>次数:72744&lt;/p>
&lt;p>次数:72718&lt;/p>
&lt;p>次数:74101&lt;/p>
&lt;p>次数:75071&lt;/p>
&lt;p>次数:75672&lt;/p>
&lt;p>次数:73354&lt;/p>
&lt;p>次数:75474&lt;/p>
&lt;p>次数:73025&lt;/p>
&lt;p>次数:74453&lt;/p>
&lt;p>次数:75715&lt;/p>
&lt;p>原创文章转载请注明出处哟！&lt;/p></description></item><item><title>转载:MySQL开发实践8问，你能hold住几个？</title><link>https://reatang.com/p/old-post-10/</link><pubDate>Sun, 22 Jan 2017 17:28:36 +0000</pubDate><guid>https://reatang.com/p/old-post-10/</guid><description>&lt;p>来自： &lt;a class="link" href="https://www.qcloud.com/community/article/164816001481011945" target="_blank" rel="noopener"
>https://www.qcloud.com/community/article/164816001481011945&lt;/a>&lt;/p>
&lt;p>最近研发的项目对DB依赖比较重，梳理了这段时间使用MySQL遇到的8个比较具有代表性的问题，答案也比较偏自己的开发实践，没有DBA专业和深入，有出入的请使劲拍砖！&amp;hellip;&lt;/p>
&lt;ol>
&lt;li>
&lt;p>MySQL读写性能是多少，有哪些性能相关的配置参数？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL负载高时，如何找到是由哪些SQL引起的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如何针对具体的SQL做优化？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SQL层面已难以优化，请求量继续增大时的应对策略？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL如何做主从数据同步？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如何防止DB误操作和做好容灾？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>该选择MySQL哪种存储引擎，Innodb具有什么特性？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL内部结构有哪些层次？&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="1mysql读写性能是多少有哪些性能相关的重要参数">1.MySQL读写性能是多少，有哪些性能相关的重要参数？
&lt;/h4>&lt;p>这里做了几个简单压测实验&lt;/p>
&lt;p>机器：8核CPU，8G内存&lt;/p>
&lt;p>表结构(尽量模拟业务)：12个字段(1个bigint(20)为自增primary key，5个int(11)，5个varchar(512)，1个timestamp)，InnoDB存储引擎。&lt;/p>
&lt;p>实验1(写)：insert =&amp;gt; 6000/s&lt;/p>
&lt;p>前提：连接数100，每次insert单条记录&lt;/p>
&lt;p>分析：CPU跑了50%，这时磁盘为顺序写，故性能较高&lt;/p>
&lt;p>实验2(写)：update(where条件命中索引) =&amp;gt; 200/s&lt;/p>
&lt;p>前提：连接数100，10w条记录，每次update单条记录的4个字段(2个int(11)，2个varchar(512))&lt;/p>
&lt;p>分析：CPU跑2%，瓶颈明显在IO的随机写&lt;/p>
&lt;p>实验3(读)：select(where条件命中索引) =&amp;gt; 5000/s&lt;/p>
&lt;p>前提：连接数100，10w条记录，每次select单条记录的4个字段(2个int(11)，2个varchar(512))&lt;/p>
&lt;p>分析：CPU跑6%，瓶颈在IO，和db的cache大小相关&lt;/p>
&lt;p>实验4(读)：select(where条件没命中索引) =&amp;gt; 60/s&lt;/p>
&lt;p>前提：连接数100，10w条记录，每次select单条记录的4个字段(2个int(11)，2个varchar(512))&lt;/p>
&lt;p>分析：CPU跑到80%，每次select都需遍历所有记录，看来索引的效果非常明显！&lt;/p>
&lt;p>几个重要的配置参数，可根据实际的机器和业务特点调整&lt;/p>
&lt;p>&lt;code>max_connecttions&lt;/code>：最大连接数&lt;/p>
&lt;p>&lt;code>table_cache&lt;/code>：缓存打开表的数量&lt;/p>
&lt;p>&lt;code>key_buffer_size&lt;/code>：索引缓存大小&lt;/p>
&lt;p>&lt;code>query_cache_size&lt;/code>：查询缓存大小&lt;/p>
&lt;p>&lt;code>sort_buffer_size&lt;/code>：排序缓存大小(会将排序完的数据缓存起来)&lt;/p>
&lt;p>&lt;code>read_buffer_size&lt;/code>：顺序读缓存大小&lt;/p>
&lt;p>&lt;code>read_rnd_buffer_size&lt;/code>：某种特定顺序读缓存大小(如order by子句的查询)&lt;/p>
&lt;p>PS：查看配置方法： &lt;code>show variables like '%max_connecttions%'&lt;/code>;&lt;/p>
&lt;h4 id="2mysql负载高时如何找到是由哪些sql引起的">2.MySQL负载高时，如何找到是由哪些SQL引起的？
&lt;/h4>&lt;p>方法：慢查询日志分析(MySQLdumpslow)&lt;/p>
&lt;p>慢查询日志例子，可看到每个慢查询SQL的耗时：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># User@Host: edu_online[edu_online] @  [10.139.10.167]# Query_time: 1.958000  Lock_time: 0.000021 Rows_sent: 254786  Rows_examined: 254786SET timestamp=1410883292;select * from t_online_group_records;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>日志显示该查询用了1.958秒，返回254786行记录，一共遍历了254786行记录。及具体的时间戳和SQL语句。&lt;/p>
&lt;p>使用MySQLdumpslow进行慢查询日志分析&lt;/p>
&lt;p>&lt;code>MySQLdumpslow -s t -t 5 slow_log_20140819.txt&lt;/code>&lt;/p>
&lt;p>输出查询耗时最多的Top5条SQL语句&lt;/p>
&lt;p>-s：排序方法，t表示按时间 (此外，c为按次数，r为按返回记录数等)&lt;/p>
&lt;p>-t：去Top多少条，-t 5表示取前5条&lt;/p>
&lt;p>执行完分析结果如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Count: 1076100  Time=0.09s (99065s)  Lock=0.00s (76s)  Rows=408.9 (440058825), edu_online[edu_online]@28hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  select * from t_online_group_records where UNIX_TIMESTAMP(gre_updatetime) &amp;gt; NCount: 1076099  Time=0.05s (52340s)  Lock=0.00s (91s)  Rows=62.6 (67324907), edu_online[edu_online]@28hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  select * from t_online_course where UNIX_TIMESTAMP(c_updatetime) &amp;gt; NCount: 63889  Time=0.78s (49607s)  Lock=0.00s (3s)  Rows=0.0 (18), edu_online[edu_online]@[10x.213.1xx.1xx]  select f_uin from t_online_student_contact where f_modify_time &amp;gt; NCount: 1076097  Time=0.02s (16903s)  Lock=0.00s (72s)  Rows=52.2 (56187090), edu_online[edu_online]@28hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  select * from t_online_video_info where UNIX_TIMESTAMP(v_update_time) &amp;gt; NCount: 330046  Time=0.02s (6822s)  Lock=0.00s (45s)  Rows=0.0 (2302), edu_online[edu_online]@4hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  select uin,cid,is_canceled,unix_timestamp(end_time) as endtime,unix_timestamp(update_time) as updatetime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  from t_kick_log where unix_timestamp(update_time) &amp;gt; N
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以第1条为例，表示这类SQL(N可以取很多值，这里MySQLdumpslow会归并起来)在8月19号的慢查询日志内出现了1076100次，总耗时99065秒，总返回440058825行记录，有28个客户端IP用到。&lt;/p>
&lt;p>通过慢查询日志分析，就可以找到最耗时的SQL，然后进行具体的SQL分析了&lt;/p>
&lt;p>慢查询相关的配置参数&lt;/p>
&lt;p>&lt;code>log_slow_queries&lt;/code>：是否打开慢查询日志，得先确保=ON后面才有得分析&lt;/p>
&lt;p>&lt;code>long_query_time&lt;/code>：查询时间大于多少秒的SQL被当做是慢查询，一般设为1S&lt;/p>
&lt;p>&lt;code>log_queries_not_using_indexes&lt;/code>：是否将没有使用索引的记录写入慢查询日志&lt;/p>
&lt;p>&lt;code>slow_query_log_file&lt;/code>：慢查询日志存放路径&lt;/p>
&lt;h4 id="3如何针对具体的sql做优化">3.如何针对具体的SQL做优化？
&lt;/h4>&lt;p>使用Explain分析SQL语句执行计划&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">MySQL&amp;gt; explain select * from t_online_group_records where UNIX_TIMESTAMP(gre_updatetime) &amp;gt; 123456789;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----+-------------+------------------------+------+---------------+------+---------+------+------+-------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| id | select_type | table                  | type | possible_keys | key  | key_len | ref  | rows | Extra       |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----+-------------+------------------------+------+---------------+------+---------+------+------+-------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|  1 | SIMPLE      | t_online_group_records | ALL  | NULL          | NULL | NULL    | NULL |   47 | Using where |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----+-------------+------------------------+------+---------------+------+---------+------+------+-------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 row in set (0.00 sec)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如上面例子所示，重点关注下type，rows和Extra：&lt;/p>
&lt;p>type：使用类别，有无使用到索引。结果值从好到坏：&amp;hellip; &amp;gt; range(使用到索引) &amp;gt; index &amp;gt; ALL(全表扫描)，一般查询应达到range级别&lt;/p>
&lt;p>rows：SQL执行检查的记录数&lt;/p>
&lt;p>Extra：SQL执行的附加信息，如&amp;quot;Using index&amp;quot;表示查询只用到索引列，不需要去读表等&lt;/p>
&lt;p>使用Profiles分析SQL语句执行时间和消耗资源&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">MySQL&amp;gt; set profiling=1; (启动profiles，默认是没开启的)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MySQL&amp;gt; select count(1) from t_online_group_records where UNIX_TIMESTAMP(gre_updatetime) &amp;gt; 123456789; (执行要分析的SQL语句)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MySQL&amp;gt; show profiles;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+----------------------------------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Query_ID | Duration   | Query                                                                                        |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+----------------------------------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        1 | 0.00043250 | select count(1) from t_online_group_records where UNIX_TIMESTAMP(gre_updatetime) &amp;gt; 123456789 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+----------------------------------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 row in set (0.00 sec)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">、
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MySQL&amp;gt; show profile cpu,block io for query 1; (可看出SQL在各个环节的耗时和资源消耗)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------------------+----------+----------+------------+--------------+---------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Status               | Duration | CPU_user | CPU_system | Block_ops_in | Block_ops_out |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------------------+----------+----------+------------+--------------+---------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| statistics           | 0.000020 | 0.000000 |   0.000000 |            0 |             0 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| optimizing           | 0.000016 | 0.000000 |   0.000000 |            0 |             0 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| executing            | 0.000011 | 0.000000 |   0.000000 |            0 |             0 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| preparing            | 0.000017 | 0.000000 |   0.000000 |            0 |             0 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Sending data         | 0.000076 | 0.000000 |   0.000000 |            0 |             0 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>SQL优化的技巧 (只提一些业务常遇到的问题)&lt;/p>
&lt;ol>
&lt;li>
&lt;p>最关键：索引，避免全表扫描。&lt;/p>
&lt;p>对接触的项目进行慢查询分析，发现TOP10的基本都是忘了加索引或者索引使用不当，如索引字段上加函数导致索引失效等(如 &lt;code>where UNIX_TIMESTAMP(gre_updatetime)&amp;gt;123456789&lt;/code>)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">+----------+------------+---------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Query_ID | Duration   | Query                                 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+---------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        1 | 0.00024700 | select * from mytable where id=100    |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        2 | 0.27912900 | select * from mytable where id+1=101  |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+---------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">另外很多同学在拉取全表数据时，喜欢用select xx from xx limit 5000,1000这种形式批量拉取，其实这个SQL每次都是全表扫描，建议添加1个自增id做索引，
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">将SQL改为select xx from xx where id&amp;gt;5000 and id&amp;lt;6000;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Query_ID | Duration   | Query                                               |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        1 | 0.00415400 | select * from mytable where id&amp;gt;=90000 and id&amp;lt;=91000 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        2 | 0.10078100 | select * from mytable limit 90000,1000              |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">合理用好索引，应该可解决大部分SQL问题。当然索引也非越多越好，过多的索引会影响写操作性能
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>只select出需要的字段，避免select&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| Query_ID | Duration   | Query                                               |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        1 | 0.02948800 | select count(1) from ( select id from mytable ) a   |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|        2 | 1.34369100 | select count(1) from ( select * from mytable ) a    |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+------------+-----------------------------------------------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>尽量早做过滤，使Join或者Union等后续操作的数据量尽量小&lt;/p>
&lt;/li>
&lt;li>
&lt;p>把能在逻辑层算的提到逻辑层来处理，如一些数据排序、时间函数计算等&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;hellip;&amp;hellip;.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>PS：关于SQL优化，已经有足够多文章了，所以就不讲太全面了，只重点说自己1个感受：索引！基本都是因为索引！&lt;/p>
&lt;h4 id="4sql层面已难以优化请求量继续增大时的应对策略">4.SQL层面已难以优化，请求量继续增大时的应对策略？
&lt;/h4>&lt;p>下面是我能想到的几个方法，每个方法又都是一篇大文章了，这里就不展开&lt;/p>
&lt;p>分库分表&lt;/p>
&lt;p>使用集群(master-slave)，读写分离&lt;/p>
&lt;p>增加业务的cache层&lt;/p>
&lt;p>使用连接池&lt;/p>
&lt;h4 id="5mysql如何做主从数据同步">5.MySQL如何做主从数据同步？
&lt;/h4>&lt;p>复制机制（Replication）&lt;/p>
&lt;p>master通过复制机制，将master的写操作通过binlog传到slave生成中继日志(relaylog)，slave再将中继日志redo，使得主库和从库的数据保持同步&lt;/p>
&lt;p>复制相关的3个MySQL线程&lt;/p>
&lt;ol>
&lt;li>
&lt;p>slave上的I/O线程：向master请求数据&lt;/p>
&lt;/li>
&lt;li>
&lt;p>master上的Binlog Dump线程：读取binlog事件并把数据发送给slave的I/O线程&lt;/p>
&lt;/li>
&lt;li>
&lt;p>slave上的SQL线程：读取中继日志并执行，更新数据库&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>属于slave主动请求拉取的模式&lt;/p>
&lt;p>实际使用可能遇到的问题&lt;/p>
&lt;p>数据非强一致：CDB默认为异步复制，master和slave的数据会有一定延迟(称为主从同步距离，一般 &amp;lt; 1s)&lt;/p>
&lt;p>主从同步距离变大：可能是DB写入压力大，也可能是slave机器负载高，网络波动等原因，具体问题具体分析&lt;/p>
&lt;p>相关监控命令&lt;/p>
&lt;p>&lt;code>show processlist&lt;/code>：查看MySQL进程信息，包括3个同步线程的当前状态&lt;/p>
&lt;p>&lt;code>show master status&lt;/code> ：查看master配置及当前复制信息&lt;/p>
&lt;p>&lt;code>show slave status&lt;/code>：查看slave配置及当前复制信息&lt;/p>
&lt;h4 id="6如何防止db误操作和做好容灾">6.如何防止DB误操作和做好容灾？
&lt;/h4>&lt;p>业务侧应做到的几点：&lt;/p>
&lt;p>重要DB数据的手工修改操作，操作前需做到2点：1 先在测试环境操作 2 备份数据&lt;/p>
&lt;p>根据业务重要性做定时备份，考虑系统可承受的恢复时间&lt;/p>
&lt;p>进行容灾演练，感觉很必要&lt;/p>
&lt;p>MySQL备份和恢复操作&lt;/p>
&lt;p>1.备份：使用MySQLdump导出数据&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">MySQLdump -u 用户名 -p 数据库名 [表名] &amp;gt; 导出的文件名MySQLdump -uxxx -p xxx mytable &amp;gt; mytable.20140921.bak.sql
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2.恢复：导入备份数据&lt;/p>
&lt;p>&lt;code>MySQL -uxxx -p xxxx &amp;lt; mytable.20140921.bak.sql&lt;/code>&lt;/p>
&lt;p>3.恢复：导入备份数据之后发送的写操作。先使用MySQLbinlog导出这部分写操作SQL(基于时间点或位置)&lt;/p>
&lt;p>如导出2014-09-21 09:59:59之后的binlog：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">MySQLbinlog&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">database&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;test&amp;#34;&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">date&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;2014-09-21 09:59:59&amp;#34;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MySQL&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mybinlog&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">000001&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">binlog&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sql&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如导出起始id为123456之后的binlog：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">MySQLbinlog&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">database&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;test&amp;#34;&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">position&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;123456&amp;#34;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MySQL&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mybinlog&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">000001&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">binlog&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sql&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后把要恢复的binlog导入db&lt;/p>
&lt;p>&lt;code>MySQL -uxxxx -p xxxx &amp;lt; binlog.data.sql&lt;/code>&lt;/p>
&lt;h4 id="7该选择mysql哪种存储引擎innodb具有什么特性">7.该选择MySQL哪种存储引擎，Innodb具有什么特性？
&lt;/h4>&lt;p>存储引擎简介&lt;/p>
&lt;p>插件式存储引擎是MySQL的重要特性，MySQL支持多种存储引擎以满足用户的多种应用场景&lt;/p>
&lt;p>存储引擎解决的问题：如何组织MySQL数据在介质中高效地读取，需考虑存储机制、索引设计、并发读写的锁机制等&lt;/p>
&lt;p>MySQL5.0支持的存储引擎有MyISAM、InnoDB、Memory、Merge等&lt;/p>
&lt;p>**MyISAM和InnoDB的区别(只说重点了)&lt;/p>
&lt;ol>
&lt;li>
&lt;p>InnoDB&lt;/p>
&lt;p>MySQL5.5之后及CDB的默认引擎。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>支持行锁：并发性能好&lt;/p>
&lt;/li>
&lt;li>
&lt;p>支持事务：故InnoDB称为事务性存储引擎，支持ACID，提供了具有提交、回滚和崩溃恢复能力的事务安全&lt;/p>
&lt;/li>
&lt;li>
&lt;p>支持外键：当前唯一支持外键的引擎&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>MyISAM&lt;/p>
&lt;p>MySQL5.5之前默认引擎&lt;/p>
&lt;ul>
&lt;li>
&lt;p>支持表锁：插入+查询速度快，更新+删除速度慢&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不支持事务&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>使用show engines可查看当前MySQL支持的存储引擎详情&lt;/p>
&lt;p>&lt;img src="https://mc.qcloudimg.com/static/img/b83c75d96e73c8a913662190f557cd3e/image.png"
loading="lazy"
>&lt;/p>
&lt;h4 id="8mysql内部结构有哪些层次">8.MySQL内部结构有哪些层次？
&lt;/h4>&lt;p>非专业DBA，这里只简单贴个结构图说明下。MySQL是开源系统，其设计思路和源代码都出自大牛之手，有空可以学习下。&lt;/p>
&lt;p>&lt;img src="https://mc.qcloudimg.com/static/img/a1fa772869bedd2bf5224b28454c8e09/image.jpg"
loading="lazy"
>&lt;/p></description></item><item><title>2016年度最受欢迎中国开源软件评选</title><link>https://reatang.com/p/old-post-9/</link><pubDate>Sun, 22 Jan 2017 16:31:00 +0000</pubDate><guid>https://reatang.com/p/old-post-9/</guid><description>&lt;p>&lt;img src="https://reatang.com/%7b#ZC_BLOG_HOST#%7dzb_users/upload/2017/01/201701221485074374681077.png"
loading="lazy"
alt="blob.png"
>&lt;/p>
&lt;p>2016年度最受欢迎中国开源软件评选 &lt;a class="link" href="http://www.oschina.net/project/top_cn_2016" target="_blank" rel="noopener"
>&amp;raquo;原文&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>4092 票&lt;img src="http://www.oschina.net/img/logo/jfinal.gif?t=1451964198000"
loading="lazy"
alt="JFinal logo"
> &lt;a class="link" href="http://www.oschina.net/p/jfinal" title="JAVA 极速WEB&amp;#43;ORM框架 JFinal"
target="_blank" rel="noopener"
>JFinal&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>3956 票&lt;img src="https://static.oschina.net/uploads/logo/echarts_sNQff.png"
loading="lazy"
alt="ECharts logo"
> &lt;a class="link" href="http://www.oschina.net/p/echarts" title="JavaScript 图表库 ECharts"
target="_blank" rel="noopener"
>ECharts&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>3353 票&lt;img src="https://static.oschina.net/uploads/logo/layui_4wh8B.png"
loading="lazy"
alt="Layui logo"
> &lt;a class="link" href="http://www.oschina.net/p/layui" title="模块化前端 UI 框架 Layui"
target="_blank" rel="noopener"
>Layui&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2707 票&lt;img src="https://static.oschina.net/uploads/user/63/127152_100.jpg?t=1373815704000"
loading="lazy"
alt="wenshao"
> &lt;a class="link" href="http://www.oschina.net/p/druid" title="JDBC连接池、监控组件 Druid"
target="_blank" rel="noopener"
>Druid&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2548 票&lt;img src="https://static.oschina.net/uploads/logo/vue-js_XHYNa.png"
loading="lazy"
alt="Vue.js logo"
> &lt;a class="link" href="http://www.oschina.net/p/vue-js" title="轻量级 JavaScript 框架 Vue.js"
target="_blank" rel="noopener"
>Vue.js&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2389 票&lt;img src="https://static.oschina.net/uploads/logo/fastjson_uOaeh.jpg"
loading="lazy"
alt="fastjson logo"
> &lt;a class="link" href="http://www.oschina.net/p/fastjson" title="Java的JSON处理器 fastjson"
target="_blank" rel="noopener"
>fastjson&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2137 票&lt;img src="http://www.oschina.net/img/logo/dubbo.gif?t=1451964198000"
loading="lazy"
alt="Dubbo logo"
> &lt;a class="link" href="http://www.oschina.net/p/dubbo" title="服务框架 Dubbo"
target="_blank" rel="noopener"
>Dubbo&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1764 票&lt;img src="http://www.oschina.net/img/logo/ThinkPHP.gif?t=1451964198000"
loading="lazy"
alt="ThinkPHP logo"
> &lt;a class="link" href="http://www.oschina.net/p/thinkphp" title="轻量级PHP开发框架 ThinkPHP"
target="_blank" rel="noopener"
>ThinkPHP&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1467 票&lt;img src="https://static.oschina.net/uploads/user/465/930898_100.png?t=1441686173000"
loading="lazy"
alt="Jeecg"
> &lt;a class="link" href="http://www.oschina.net/p/jeecg" title="基于代码生成器的快速开发平台 JEECG"
target="_blank" rel="noopener"
>JEECG&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1454 票&lt;img src="http://www.oschina.net/img/logo/ztree.gif?t=1451964198000"
loading="lazy"
alt="zTree logo"
> &lt;a class="link" href="http://www.oschina.net/p/ztree" title="JQuery Tree 插件 zTree"
target="_blank" rel="noopener"
>zTree&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1426 票&lt;img src="https://static.oschina.net/uploads/user/582/1165541_100.jpeg?t=1481873558000"
loading="lazy"
alt="风–"
> &lt;a class="link" href="http://www.oschina.net/p/mycat" title="数据库中间件 MyCAT"
target="_blank" rel="noopener"
>MyCAT&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1144 票&lt;img src="http://www.oschina.net/img/logo/tendaopms.gif?t=1451964198000"
loading="lazy"
alt="禅道 logo"
> &lt;a class="link" href="http://www.oschina.net/p/zentaopms" title="开源项目管理软件 禅道"
target="_blank" rel="noopener"
>禅道&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1083 票&lt;img src="https://static.oschina.net/uploads/logo/rocketmq_nnEKm.png"
loading="lazy"
alt="Apache RocketMQ logo"
> &lt;a class="link" href="http://www.oschina.net/p/rocketmq" title="消息中间件 Apache RocketMQ"
target="_blank" rel="noopener"
>Apache RocketMQ&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>975 票&lt;img src="https://static.oschina.net/uploads/user/100/201137_100.jpg?t=1370343372000"
loading="lazy"
alt="JFinal"
> &lt;a class="link" href="http://www.oschina.net/p/jfinal_weixin" title="微信公众号极速 SDK JFinal Weixin"
target="_blank" rel="noopener"
>JFinal Weixin&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>853 票&lt;img src="https://static.oschina.net/uploads/user/470/941661_100.png?t=1387164243000"
loading="lazy"
alt="thinkgem"
> &lt;a class="link" href="http://www.oschina.net/p/jeesite" title="企业信息化快速开发平台 JeeSite"
target="_blank" rel="noopener"
>JeeSite&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>840 票&lt;img src="https://static.oschina.net/uploads/logo/weui_DFqpP.png"
loading="lazy"
alt="WeUI logo"
> &lt;a class="link" href="http://www.oschina.net/p/weui" title="专为微信设计的 UI 库 WeUI"
target="_blank" rel="noopener"
>WeUI&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>813 票&lt;img src="https://static.oschina.net/uploads/user/359/719192_100.jpeg?t=1482218860000"
loading="lazy"
alt="terrymanu"
> &lt;a class="link" href="http://www.oschina.net/p/sharding-jdbc" title="增强版的 JDBC 驱动 Sharding-JDBC"
target="_blank" rel="noopener"
>Sharding-JDBC&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>808 票&lt;img src="https://static.oschina.net/uploads/logo/linuxdeepin_GggPi.gif"
loading="lazy"
alt="Deepin logo"
> &lt;a class="link" href="http://www.oschina.net/p/linuxdeepin" title="国内 Linux 发行版 Deepin"
target="_blank" rel="noopener"
>Deepin&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>797 票&lt;img src="https://static.oschina.net/uploads/user/465/930898_100.png?t=1441686173000"
loading="lazy"
alt="Jeecg"
> &lt;a class="link" href="http://www.oschina.net/p/jeewx" title="微信管家系统(多触点管理平台) JeeWx 捷微"
target="_blank" rel="noopener"
>JeeWx 捷微&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>583 票&lt;img src="http://www.oschina.net/img/logo/nutz.png?t=1451964198000"
loading="lazy"
alt="Nutz logo"
> &lt;a class="link" href="http://www.oschina.net/p/nutz" title="Java应用框架 Nutz"
target="_blank" rel="noopener"
>Nutz&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>fastDFS 5.0.9 本体,lib库,nginx模块</title><link>https://reatang.com/p/old-post-8/</link><pubDate>Tue, 17 Jan 2017 15:37:15 +0000</pubDate><guid>https://reatang.com/p/old-post-8/</guid><description>&lt;p>fastdfs-5.0.9.tar.gz&lt;/p>
&lt;p>fastdfs-gninx-module-1.19.tar.gz&lt;/p>
&lt;p>libfastcommon-1.33.tar.gz&lt;/p>
&lt;p>链接: &lt;a class="link" href="https://pan.baidu.com/s/1gfytnxD" target="_blank" rel="noopener"
>https://pan.baidu.com/s/1gfytnxD&lt;/a> 密码: xf52&lt;/p>
&lt;p>稍后将测试安装&lt;/p></description></item><item><title>得空开一篇 SOLID OOP设计原则</title><link>https://reatang.com/p/old-post-7/</link><pubDate>Fri, 13 Jan 2017 17:48:37 +0000</pubDate><guid>https://reatang.com/p/old-post-7/</guid><description>&lt;p>占位&lt;/p></description></item><item><title>php 超全局变量$_SERVER 内容</title><link>https://reatang.com/p/old-post-6/</link><pubDate>Fri, 13 Jan 2017 15:40:15 +0000</pubDate><guid>https://reatang.com/p/old-post-6/</guid><description>&lt;p>//请求内容长度&lt;/p>
&lt;p>CONTENT_LENGTH:&amp;ldquo;7&amp;rdquo;&lt;/p>
&lt;p>//请求内容类型&lt;/p>
&lt;p>CONTENT_TYPE:&amp;ldquo;application/x-www-form-urlencoded;charset=UTF-8&amp;rdquo;&lt;/p>
&lt;p>//根目录&lt;/p>
&lt;p>DOCUMENT_ROOT:&amp;quot;/home/vagrant/Code/web&amp;quot;&lt;/p>
&lt;p>//脚本名称&lt;/p>
&lt;p>DOCUMENT_URI:&amp;quot;/fetch/data.php&amp;quot;&lt;/p>
&lt;p>//cgi规则&lt;/p>
&lt;p>FCGI_ROLE:&amp;ldquo;RESPONDER&amp;rdquo;&lt;/p>
&lt;p>//接口版本&lt;/p>
&lt;p>GATEWAY_INTERFACE:&amp;ldquo;CGI/1.1&amp;rdquo;&lt;/p>
&lt;p>//启动用户家目录&lt;/p>
&lt;p>HOME:&amp;quot;/home/vagrant&amp;quot;&lt;/p>
&lt;p>USER:&amp;ldquo;vagrant&amp;rdquo;&lt;/p>
&lt;p>//HTTP头信息&lt;/p>
&lt;p>HTTP_ACCEPT:&amp;quot;*/*&amp;quot;&lt;/p>
&lt;p>HTTP_ACCEPT_ENCODING:&amp;ldquo;gzip, deflate&amp;rdquo;&lt;/p>
&lt;p>HTTP_ACCEPT_LANGUAGE:&amp;ldquo;zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4&amp;rdquo;&lt;/p>
&lt;p>HTTP_CACHE_CONTROL:&amp;ldquo;no-cache&amp;rdquo;&lt;/p>
&lt;p>HTTP_CONNECTION:&amp;ldquo;keep-alive&amp;rdquo;&lt;/p>
&lt;p>HTTP_CONTENT_LENGTH:&amp;ldquo;7&amp;rdquo;&lt;/p>
&lt;p>HTTP_CONTENT_TYPE:&amp;ldquo;application/x-www-form-urlencoded;charset=UTF-8&amp;rdquo;&lt;/p>
&lt;p>HTTP_HOST:&amp;ldquo;&lt;a class="link" href="https://www.xxx.com" target="_blank" rel="noopener"
>www.xxx.com&lt;/a>&amp;rdquo;&lt;/p>
&lt;p>HTTP_ORIGIN:&amp;ldquo;&lt;a class="link" href="http://www.xxx.com" target="_blank" rel="noopener"
>http://www.xxx.com&lt;/a>&amp;rdquo;&lt;/p>
&lt;p>HTTP_PRAGMA:&amp;ldquo;no-cache&amp;rdquo;&lt;/p>
&lt;p>HTTP_REFERER:&amp;quot; &lt;a class="link" href="http://web.l.org/fetch/" target="_blank" rel="noopener"
>http://web.l.org/fetch/&lt;/a>&amp;quot;&lt;/p>
&lt;p>HTTP_USER_AGENT:&amp;ldquo;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36&amp;rdquo;&lt;/p>
&lt;p>//PHP发现的，自己运行的脚本文件&lt;/p>
&lt;p>PHP_SELF:&amp;quot;/fetch/data.php&amp;quot;&lt;/p>
&lt;p>//请求类型&lt;/p>
&lt;p>REQUEST_METHOD:&amp;ldquo;POST&amp;rdquo;&lt;/p>
&lt;p>//url中 ? 后面的&lt;/p>
&lt;p>QUERY_STRING:&amp;quot;&amp;quot;&lt;/p>
&lt;p>//重写状态（nginx重写过）&lt;/p>
&lt;p>REDIRECT_STATUS:&amp;ldquo;200&amp;rdquo;&lt;/p>
&lt;p>//远程IP&lt;/p>
&lt;p>REMOTE_ADDR:&amp;ldquo;192.168.10.1&amp;rdquo;&lt;/p>
&lt;p>//远程端口&lt;/p>
&lt;p>REMOTE_PORT:&amp;ldquo;57455&amp;rdquo;&lt;/p>
&lt;p>//服务器IP&lt;/p>
&lt;p>SERVER_ADDR:&amp;ldquo;192.168.10.10&amp;rdquo;&lt;/p>
&lt;p>//服务器端口&lt;/p>
&lt;p>SERVER_PORT:&amp;ldquo;80&amp;rdquo;&lt;/p>
&lt;p>SERVER_NAME:&amp;quot; &lt;a class="link" href="http://web.l.org/" target="_blank" rel="noopener"
>http://www.xxx.com&lt;/a>&amp;quot;&lt;/p>
&lt;p>SERVER_PROTOCOL:&amp;ldquo;HTTP/1.1&amp;rdquo;&lt;/p>
&lt;p>SERVER_SOFTWARE:&amp;ldquo;nginx/1.9.14&amp;rdquo;&lt;/p>
&lt;p>//请求时间&lt;/p>
&lt;p>REQUEST_TIME:1482224205&lt;/p>
&lt;p>//请求时间 毫秒级&lt;/p>
&lt;p>REQUEST_TIME_FLOAT:1482224205.7445&lt;/p>
&lt;p>//URI&lt;/p>
&lt;p>REQUEST_URI:&amp;quot;/fetch/data.php&amp;quot;&lt;/p>
&lt;p>//脚本全路径&lt;/p>
&lt;p>SCRIPT_FILENAME:&amp;quot;/home/vagrant/Code/web/fetch/data.php&amp;quot;&lt;/p>
&lt;p>SCRIPT_NAME:&amp;quot;/fetch/data.php&amp;quot;&lt;/p></description></item><item><title>js_ase加密php_ase解密</title><link>https://reatang.com/p/old-post-4/</link><pubDate>Fri, 13 Jan 2017 10:38:15 +0000</pubDate><guid>https://reatang.com/p/old-post-4/</guid><description>&lt;p>js部分&lt;/p>
&lt;p>js使用的是crypto-js进行aes加密&lt;/p>
&lt;p>github地址：https://github.com/brix/crypto-js&lt;/p>
&lt;p>加密&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">md5SecterKey&lt;/span> &lt;span class="o">=&lt;/span>  &lt;span class="s1">&amp;#39;a1d3eaf653ab8d9c2c1d809f13ab5f05&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Utf8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">md5SecterKey&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">iv&lt;/span>  &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Utf8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">md5SecterKey&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">ciphertext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encrypt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">iv&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">iv&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CBC&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">padding&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ZeroPadding&lt;/span>&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ciphertext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解密&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Utf8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">md5SecterKey&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">iv&lt;/span>  &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Utf8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">md5SecterKey&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">ciphertext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">localStorage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getItem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ciphertext&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="k">var&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">decrypt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ciphertext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">(),&lt;/span>  &lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">iv&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">iv&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CBC&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">padding&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ZeroPadding&lt;/span>&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="k">var&lt;/span> &lt;span class="n">plaintext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">crypto&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Utf8&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;span class="k">return&lt;/span> &lt;span class="n">plaintext&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>php部分&lt;/p>
&lt;p>php使用自带的aes解密&lt;/p>
&lt;p>加密&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$pk = &amp;#34;a1d3eaf653ab8d9c2c1d809f13ab5f05&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$iv = substr($pk, 0, 16);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$t = &amp;#39;reatang&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$encrypted = ( mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $pk, $t, MCRYPT_MODE_CBC,$iv) );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$base64Str = base64_encode($encrypted).&amp;#39;&amp;lt;br&amp;gt;&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解密&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$str_encrypt = base64_decode($base64Str);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$pk = &amp;#34;a1d3eaf653ab8d9c2c1d809f13ab5f05&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$iv = substr($pk, 0, 16);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo mcrypt_decrypt(MCRYPT_RIJNDAEL_128, $pk, base64_decode($str_encrypt), MCRYPT_MODE_CBC, $iv);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exit;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>